{"version":3,"file":"index-BfW9Xqta.js","sources":["../../../src/renderer/WebGPURenderer.ts","../../../src/controls/ViewState.ts","../../../src/controls/InputHandler.ts","../../../src/types.ts","../../../src/bookmark/BookmarkManager.ts","../../../src/bookmark/famousLocations.ts","../../../src/renderer/Palettes.ts","../../../src/renderer/shaders/mandelbrot.wgsl?raw","../../../src/fractal/WebGPUFractalEngine.ts","../../../src/main.ts"],"sourcesContent":["/**\n * WebGPU Renderer - Manages WebGPU context and canvas with HDR support\n *\n * \"Finally, a graphics API worthy of my magnificence.\"\n * - Skippy the Magnificent\n */\n\nexport class WebGPURenderer {\n  public device!: GPUDevice;\n  public context!: GPUCanvasContext;\n  public readonly canvas: HTMLCanvasElement;\n  public format!: GPUTextureFormat;\n\n  private animationFrameId: number | null = null;\n  private renderCallback: (() => void) | null = null;\n\n  /** Whether HDR rendering is currently enabled and active. */\n  public hdrEnabled: boolean = false;\n  /** Whether the display currently reports HDR support. */\n  private _displaySupportsHDR: boolean = false;\n  /** Media query for dynamic range detection */\n  private hdrMediaQuery: MediaQueryList | null = null;\n  /** Callback for HDR status changes */\n  private onHdrChangeCallback: (() => void) | null = null;\n\n  private constructor(canvas: HTMLCanvasElement) {\n    this.canvas = canvas;\n    this._displaySupportsHDR = this.detectHDRDisplay();\n    this.setupHdrMediaQueryListener();\n  }\n\n  /**\n   * Whether the display currently supports HDR\n   */\n  get displaySupportsHDR(): boolean {\n    return this._displaySupportsHDR;\n  }\n\n  /**\n   * Create and initialize a WebGPU renderer.\n   * This is async because WebGPU initialization requires awaiting adapter/device.\n   */\n  static async create(canvas: HTMLCanvasElement): Promise<WebGPURenderer> {\n    const renderer = new WebGPURenderer(canvas);\n    await renderer.initialize();\n    return renderer;\n  }\n\n  /**\n   * Check if WebGPU is supported in this browser.\n   */\n  static isSupported(): boolean {\n    return 'gpu' in navigator;\n  }\n\n  private async initialize(): Promise<void> {\n    if (!navigator.gpu) {\n      throw new Error('WebGPU is not supported in this browser');\n    }\n\n    console.log('WebGPU HDR capability check:');\n    console.log('  - Display supports HDR:', this.displaySupportsHDR);\n    console.log('  - dynamic-range: high:', window.matchMedia?.('(dynamic-range: high)').matches);\n    console.log('  - color-gamut: p3:', window.matchMedia?.('(color-gamut: p3)').matches);\n\n    const adapter = await navigator.gpu.requestAdapter({\n      powerPreference: 'high-performance',\n    });\n\n    if (!adapter) {\n      throw new Error('Failed to get WebGPU adapter');\n    }\n\n    // Log adapter info (if available)\n    if ('info' in adapter) {\n      const info = (adapter as any).info;\n      console.log('  - Adapter:', info?.vendor, info?.architecture);\n    }\n\n    this.device = await adapter.requestDevice();\n\n    this.context = this.canvas.getContext('webgpu') as GPUCanvasContext;\n    if (!this.context) {\n      throw new Error('Failed to get WebGPU context');\n    }\n\n    // Configure for HDR if supported\n    this.configureContext();\n\n    console.log('WebGPU initialized successfully');\n    if (this.hdrEnabled) {\n      console.log('HDR mode enabled with rgba16float + extended tone mapping');\n    }\n  }\n\n  /**\n   * Configure the WebGPU context, optionally with HDR support.\n   */\n  private configureContext(): void {\n    // Determine format - use rgba16float for HDR, otherwise preferred format\n    const preferredFormat = navigator.gpu.getPreferredCanvasFormat();\n\n    if (this.displaySupportsHDR) {\n      // Try to configure with HDR\n      try {\n        this.format = 'rgba16float';\n        this.context.configure({\n          device: this.device,\n          format: this.format,\n          alphaMode: 'opaque',\n          toneMapping: { mode: 'extended' }, // This unlocks HDR range!\n        } as GPUCanvasConfiguration);\n        this.hdrEnabled = true;\n        console.log('  - Configured with rgba16float + extended tone mapping (HDR)');\n      } catch (e) {\n        console.log('  - HDR configuration failed, falling back to SDR:', e);\n        this.format = preferredFormat;\n        this.context.configure({\n          device: this.device,\n          format: this.format,\n          alphaMode: 'opaque',\n        });\n        this.hdrEnabled = false;\n      }\n    } else {\n      this.format = preferredFormat;\n      this.context.configure({\n        device: this.device,\n        format: this.format,\n        alphaMode: 'opaque',\n      });\n      this.hdrEnabled = false;\n      console.log('  - Configured with', this.format, '(SDR)');\n    }\n  }\n\n  /**\n   * Resize the canvas to match the given dimensions\n   */\n  resize(width: number, height: number): void {\n    const dpr = window.devicePixelRatio || 1;\n    this.canvas.width = width * dpr;\n    this.canvas.height = height * dpr;\n    this.canvas.style.width = `${width}px`;\n    this.canvas.style.height = `${height}px`;\n  }\n\n  /**\n   * Get the current render target texture\n   */\n  getCurrentTexture(): GPUTexture {\n    return this.context.getCurrentTexture();\n  }\n\n  /**\n   * Start the render loop\n   */\n  start(renderCallback: () => void): void {\n    if (this.animationFrameId !== null) {\n      return; // Already running\n    }\n\n    this.renderCallback = renderCallback;\n    const loop = () => {\n      if (this.renderCallback) {\n        this.renderCallback();\n      }\n      this.animationFrameId = requestAnimationFrame(loop);\n    };\n    this.animationFrameId = requestAnimationFrame(loop);\n  }\n\n  /**\n   * Stop the render loop\n   */\n  stop(): void {\n    if (this.animationFrameId !== null) {\n      cancelAnimationFrame(this.animationFrameId);\n      this.animationFrameId = null;\n    }\n    this.renderCallback = null;\n  }\n\n  /**\n   * Detect if the display supports HDR.\n   */\n  private detectHDRDisplay(): boolean {\n    if (window.matchMedia?.('(dynamic-range: high)').matches) {\n      return true;\n    }\n    // Note: color-gamut: p3 alone doesn't mean HDR, just wide gamut\n    // But we'll use it as a fallback hint\n    return false;\n  }\n\n  /**\n   * Set up listener for HDR display changes (e.g., user toggles HDR in display settings)\n   */\n  private setupHdrMediaQueryListener(): void {\n    if (!window.matchMedia) return;\n\n    this.hdrMediaQuery = window.matchMedia('(dynamic-range: high)');\n\n    const handleChange = () => {\n      const newHdrSupport = this.detectHDRDisplay();\n      if (newHdrSupport !== this._displaySupportsHDR) {\n        console.log(`HDR display support changed: ${this._displaySupportsHDR} -> ${newHdrSupport}`);\n        this._displaySupportsHDR = newHdrSupport;\n\n        // Reconfigure context if we have one\n        if (this.context && this.device) {\n          this.configureContext();\n        }\n\n        // Notify listener\n        this.onHdrChangeCallback?.();\n      }\n    };\n\n    // Use addEventListener for modern browsers\n    this.hdrMediaQuery.addEventListener?.('change', handleChange);\n  }\n\n  /**\n   * Set callback for when HDR status changes\n   */\n  setOnHdrChange(callback: () => void): void {\n    this.onHdrChangeCallback = callback;\n  }\n\n  /**\n   * Clean up resources\n   */\n  destroy(): void {\n    this.stop();\n    this.onHdrChangeCallback = null;\n    this.device?.destroy();\n  }\n}\n","/**\n * View State - Manages the current viewport (pan and zoom)\n *\n * \"Coordinate transformations. Because apparently you monkeys can't do math.\"\n * - Skippy the Magnificent\n */\n\nimport type { ViewState as IViewState } from '../types';\n\nexport class ViewState implements IViewState {\n  public centerX: number;\n  public centerY: number;\n  public zoom: number;\n\n  /**\n   * Create a new view state\n   * @param centerX Real component of center (-2.5 to 1.0 typical)\n   * @param centerY Imaginary component of center (-1.5 to 1.5 typical)\n   * @param zoom Zoom factor (1.0 = full set visible)\n   */\n  constructor(centerX: number = -0.5, centerY: number = 0.0, zoom: number = 0.4) {\n    this.centerX = centerX;\n    this.centerY = centerY;\n    this.zoom = zoom;\n  }\n\n  /**\n   * Pan the view by screen pixels\n   * @param deltaX Pixels to pan horizontally (positive = right)\n   * @param deltaY Pixels to pan vertically (positive = down)\n   * @param screenWidth Screen width in pixels\n   * @param screenHeight Screen height in pixels\n   */\n  pan(deltaX: number, deltaY: number, screenWidth: number, screenHeight: number): void {\n    // Convert screen pixel delta to fractal coordinate delta\n    const fractalDeltaX = -deltaX / (this.zoom * screenWidth);\n    const fractalDeltaY = deltaY / (this.zoom * screenHeight);\n    \n    this.centerX += fractalDeltaX;\n    this.centerY += fractalDeltaY;\n  }\n\n  /**\n   * Zoom centered on a specific screen point\n   * @param screenX Screen X coordinate (0 to screenWidth)\n   * @param screenY Screen Y coordinate (0 to screenHeight)\n   * @param factor Zoom factor (> 1 = zoom in, < 1 = zoom out)\n   * @param screenWidth Screen width in pixels\n   * @param screenHeight Screen height in pixels\n   */\n  zoomAt(\n    screenX: number,\n    screenY: number,\n    factor: number,\n    screenWidth: number,\n    screenHeight: number\n  ): void {\n    // Convert screen point to fractal coordinates before zoom\n    const fractalX = this.centerX + (screenX / screenWidth - 0.5) / this.zoom;\n    const fractalY = this.centerY - (screenY / screenHeight - 0.5) / this.zoom;\n    \n    // Apply zoom\n    this.zoom *= factor;\n    \n    // Clamp zoom to reasonable limits\n    this.zoom = Math.max(0.1, Math.min(this.zoom, 1e15));\n    \n    // Adjust center so the point under cursor stays fixed\n    const newFractalX = this.centerX + (screenX / screenWidth - 0.5) / this.zoom;\n    const newFractalY = this.centerY - (screenY / screenHeight - 0.5) / this.zoom;\n    \n    this.centerX += fractalX - newFractalX;\n    this.centerY += fractalY - newFractalY;\n  }\n\n  /**\n   * Convert screen coordinates to fractal coordinates\n   * @param screenX Screen X coordinate (0 to screenWidth)\n   * @param screenY Screen Y coordinate (0 to screenHeight)\n   * @param screenWidth Screen width in pixels\n   * @param screenHeight Screen height in pixels\n   */\n  toFractalCoords(screenX: number, screenY: number, screenWidth: number, screenHeight: number): [number, number] {\n    const aspect = screenWidth / screenHeight;\n    const uvX = (screenX / screenWidth - 0.5) * aspect;\n    const uvY = screenY / screenHeight - 0.5;\n    const fractalX = this.centerX + uvX / this.zoom;\n    const fractalY = this.centerY - uvY / this.zoom;\n    return [fractalX, fractalY];\n  }\n\n  /**\n   * Convert fractal coordinates to screen coordinates\n   * @param fractalX Fractal X coordinate\n   * @param fractalY Fractal Y coordinate\n   * @param screenWidth Screen width in pixels\n   * @param screenHeight Screen height in pixels\n   */\n  toScreenCoords(fractalX: number, fractalY: number, screenWidth: number, screenHeight: number): [number, number] {\n    const aspect = screenWidth / screenHeight;\n    const uvX = (fractalX - this.centerX) * this.zoom;\n    const uvY = (fractalY - this.centerY) * this.zoom;\n    const screenX = (uvX / aspect + 0.5) * screenWidth;\n    const screenY = (-uvY + 0.5) * screenHeight;\n    return [screenX, screenY];\n  }\n\n  /**\n   * Center on a screen point and then zoom in\n   * @param screenX Screen X coordinate (0 to screenWidth)\n   * @param screenY Screen Y coordinate (0 to screenHeight)\n   * @param factor Zoom factor (> 1 = zoom in, < 1 = zoom out)\n   * @param screenWidth Screen width in pixels\n   * @param screenHeight Screen height in pixels\n   */\n  zoomToPoint(\n    screenX: number,\n    screenY: number,\n    factor: number,\n    screenWidth: number,\n    screenHeight: number\n  ): void {\n    // Convert screen point to fractal coordinates and center on it\n    const [fractalX, fractalY] = this.toFractalCoords(screenX, screenY, screenWidth, screenHeight);\n    this.centerX = fractalX;\n    this.centerY = fractalY;\n\n    // Apply zoom\n    this.zoom *= factor;\n\n    // Clamp zoom to reasonable limits\n    this.zoom = Math.max(0.1, Math.min(this.zoom, 1e15));\n  }\n\n  /**\n   * Reset to initial view\n   */\n  reset(): void {\n    this.centerX = -0.5;\n    this.centerY = 0.0;\n    this.zoom = 0.4;\n  }\n}\n","/**\n * Input Handler - Translates browser events into view state changes\n *\n * \"Event handling. Because apparently you monkeys can't click things properly.\"\n * - Skippy the Magnificent\n */\n\nimport { ViewState } from './ViewState';\n\nexport type ViewStateChangeCallback = (viewState: ViewState) => void;\nexport type IterationAdjustCallback = (direction: 1 | -1) => void;\nexport type IterationResetCallback = () => void;\nexport type PaletteCycleCallback = (direction: 1 | -1) => void;\nexport type ColorOffsetCallback = (delta: number) => void;\nexport type ToggleCallback = () => void;\nexport type FractalCycleCallback = (direction: 1 | -1) => void;\nexport type JuliaPickCallback = (fractalX: number, fractalY: number) => void;\nexport type ShareCallback = () => void;\nexport type LocationCallback = (key: string) => void;\nexport type HelpToggleCallback = () => void;\nexport type ScreenshotModeCallback = () => void;\n\n/** Zoom sensitivity: 1 = full speed, 0.6 = 60% of current zoom deltas */\nconst ZOOM_SENSITIVITY = 0.6;\n\nfunction scaleZoomFactor(factor: number): number {\n  return 1 + (factor - 1) * ZOOM_SENSITIVITY;\n}\n\nexport class InputHandler {\n  private canvas: HTMLCanvasElement;\n  private viewState: ViewState;\n  private onChange: ViewStateChangeCallback;\n  private onIterationAdjust: IterationAdjustCallback | null = null;\n  private onIterationReset: IterationResetCallback | null = null;\n  private onPaletteCycle: PaletteCycleCallback | null = null;\n  private onColorOffset: ColorOffsetCallback | null = null;\n  private onColorOffsetReset: ToggleCallback | null = null;\n  private onToggleAA: ToggleCallback | null = null;\n  private onAdjustHdrBrightness: IterationAdjustCallback | null = null;\n  private onResetHdrBrightness: ToggleCallback | null = null;\n  private onFractalCycle: FractalCycleCallback | null = null;\n  private onToggleJuliaMode: ToggleCallback | null = null;\n  private onJuliaPick: JuliaPickCallback | null = null;\n  private onShare: ShareCallback | null = null;\n  private onLocationSelect: LocationCallback | null = null;\n  private onToggleHelp: HelpToggleCallback | null = null;\n  private onToggleScreenshotMode: ScreenshotModeCallback | null = null;\n\n  // Mouse/touch state\n  private isDragging = false;\n  private lastX = 0;\n  private lastY = 0;\n  private lastTouchDistance = 0;\n\n  // Julia picker mode state\n  private juliaPickerMode = false;\n\n  constructor(\n    canvas: HTMLCanvasElement,\n    viewState: ViewState,\n    onChange: ViewStateChangeCallback\n  ) {\n    this.canvas = canvas;\n    this.viewState = viewState;\n    this.onChange = onChange;\n\n    this.setupEventListeners();\n  }\n\n  /**\n   * Set callback for iteration adjustment (+/- keys)\n   */\n  setIterationAdjustCallback(callback: IterationAdjustCallback): void {\n    this.onIterationAdjust = callback;\n  }\n\n  /**\n   * Set callback for iteration reset (0 key)\n   */\n  setIterationResetCallback(callback: IterationResetCallback): void {\n    this.onIterationReset = callback;\n  }\n\n  /**\n   * Set callback for palette cycling (c/C keys)\n   */\n  setPaletteCycleCallback(callback: PaletteCycleCallback): void {\n    this.onPaletteCycle = callback;\n  }\n\n  /**\n   * Set callback for color offset adjustment ([/] keys)\n   */\n  setColorOffsetCallback(callback: ColorOffsetCallback): void {\n    this.onColorOffset = callback;\n  }\n\n  /**\n   * Set callback for color offset reset (r key)\n   */\n  setColorOffsetResetCallback(callback: ToggleCallback): void {\n    this.onColorOffsetReset = callback;\n  }\n\n  /**\n   * Set callback for AA toggle (a key)\n   */\n  setToggleAACallback(callback: ToggleCallback): void {\n    this.onToggleAA = callback;\n  }\n\n  /**\n   * Set callback for HDR toggle (no-op, HDR is auto-detected)\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  setToggleHDRCallback(_callback: ToggleCallback): void {\n    // HDR is now auto-detected based on display capabilities\n  }\n\n  /**\n   * Set callback for HDR brightness adjustment (b/B keys)\n   */\n  setAdjustHdrBrightnessCallback(callback: IterationAdjustCallback): void {\n    this.onAdjustHdrBrightness = callback;\n  }\n\n  /**\n   * Set callback for HDR brightness reset (Shift+R key)\n   */\n  setResetHdrBrightnessCallback(callback: ToggleCallback): void {\n    this.onResetHdrBrightness = callback;\n  }\n\n  /**\n   * Set callback for fractal type cycling (f/F keys)\n   */\n  setFractalCycleCallback(callback: FractalCycleCallback): void {\n    this.onFractalCycle = callback;\n  }\n\n  /**\n   * Set callback for Julia mode toggle (j key)\n   */\n  setToggleJuliaModeCallback(callback: ToggleCallback): void {\n    this.onToggleJuliaMode = callback;\n  }\n\n  /**\n   * Set callback for Julia constant selection (click in picker mode)\n   */\n  setJuliaPickCallback(callback: JuliaPickCallback): void {\n    this.onJuliaPick = callback;\n  }\n\n  /**\n   * Set callback for share/bookmark (s key)\n   */\n  setShareCallback(callback: ShareCallback): void {\n    this.onShare = callback;\n  }\n\n  /**\n   * Set callback for famous location selection (1-9 keys)\n   */\n  setLocationSelectCallback(callback: LocationCallback): void {\n    this.onLocationSelect = callback;\n  }\n\n  /**\n   * Set callback for help overlay toggle (h key)\n   */\n  setToggleHelpCallback(callback: HelpToggleCallback): void {\n    this.onToggleHelp = callback;\n  }\n\n  /**\n   * Set callback for screenshot mode toggle (space key)\n   */\n  setToggleScreenshotModeCallback(callback: ScreenshotModeCallback): void {\n    this.onToggleScreenshotMode = callback;\n  }\n\n  /**\n   * Enable or disable Julia picker mode\n   */\n  setJuliaPickerMode(enabled: boolean): void {\n    this.juliaPickerMode = enabled;\n    this.canvas.style.cursor = enabled ? 'crosshair' : 'grab';\n  }\n\n  /**\n   * Check if Julia picker mode is active\n   */\n  isJuliaPickerModeActive(): boolean {\n    return this.juliaPickerMode;\n  }\n\n  private setupEventListeners(): void {\n    // Mouse events\n    this.canvas.addEventListener('mousedown', this.handleMouseDown.bind(this));\n    this.canvas.addEventListener('mousemove', this.handleMouseMove.bind(this));\n    this.canvas.addEventListener('mouseup', this.handleMouseUp.bind(this));\n    this.canvas.addEventListener('mouseleave', this.handleMouseUp.bind(this));\n    this.canvas.addEventListener('wheel', this.handleWheel.bind(this), { passive: false });\n    this.canvas.addEventListener('dblclick', this.handleDoubleClick.bind(this));\n\n    // Touch events\n    this.canvas.addEventListener('touchstart', this.handleTouchStart.bind(this), { passive: false });\n    this.canvas.addEventListener('touchmove', this.handleTouchMove.bind(this), { passive: false });\n    this.canvas.addEventListener('touchend', this.handleTouchEnd.bind(this));\n    this.canvas.addEventListener('touchcancel', this.handleTouchEnd.bind(this));\n\n    // Prevent context menu on right click\n    this.canvas.addEventListener('contextmenu', (e) => e.preventDefault());\n\n    // Keyboard events (on window for global capture)\n    window.addEventListener('keydown', this.handleKeyDown.bind(this));\n  }\n\n  private getCanvasRect(): DOMRect {\n    return this.canvas.getBoundingClientRect();\n  }\n\n  private getScreenCoords(clientX: number, clientY: number): [number, number] {\n    const rect = this.getCanvasRect();\n    return [clientX - rect.left, clientY - rect.top];\n  }\n\n  private getCanvasSize(): [number, number] {\n    // Use CSS dimensions, not pixel dimensions (which include devicePixelRatio)\n    const rect = this.getCanvasRect();\n    return [rect.width, rect.height];\n  }\n\n  private notifyChange(): void {\n    this.onChange(this.viewState);\n  }\n\n  // Mouse handlers\n  private handleMouseDown(e: MouseEvent): void {\n    if (e.button !== 0) return; // Only left button\n\n    const [x, y] = this.getScreenCoords(e.clientX, e.clientY);\n\n    // Julia picker mode: pick a point instead of panning\n    if (this.juliaPickerMode && this.onJuliaPick) {\n      const [width, height] = this.getCanvasSize();\n      const [fractalX, fractalY] = this.viewState.toFractalCoords(x, y, width, height);\n      this.onJuliaPick(fractalX, fractalY);\n      return;\n    }\n\n    this.isDragging = true;\n    this.lastX = x;\n    this.lastY = y;\n    this.canvas.style.cursor = 'grabbing';\n  }\n\n  private handleMouseMove(e: MouseEvent): void {\n    if (!this.isDragging) return;\n\n    const [x, y] = this.getScreenCoords(e.clientX, e.clientY);\n    const deltaX = x - this.lastX;\n    const deltaY = y - this.lastY;\n\n    const [width, height] = this.getCanvasSize();\n    this.viewState.pan(deltaX, deltaY, width, height);\n    this.notifyChange();\n\n    this.lastX = x;\n    this.lastY = y;\n  }\n\n  private handleMouseUp(): void {\n    if (this.isDragging) {\n      this.isDragging = false;\n      this.canvas.style.cursor = 'grab';\n    }\n  }\n\n  private handleWheel(e: WheelEvent): void {\n    e.preventDefault();\n\n    const [x, y] = this.getScreenCoords(e.clientX, e.clientY);\n    const raw = e.deltaY > 0 ? 0.9 : 1.1;\n    const zoomFactor = scaleZoomFactor(raw);\n\n    const [width, height] = this.getCanvasSize();\n    this.viewState.zoomAt(x, y, zoomFactor, width, height);\n    this.notifyChange();\n  }\n\n  private handleDoubleClick(e: MouseEvent): void {\n    const [x, y] = this.getScreenCoords(e.clientX, e.clientY);\n    const [width, height] = this.getCanvasSize();\n    this.viewState.zoomToPoint(x, y, scaleZoomFactor(2.0), width, height);\n    this.notifyChange();\n  }\n\n  // Touch handlers\n  private getTouchDistance(touches: TouchList): number {\n    if (touches.length < 2) return 0;\n    const dx = touches[0].clientX - touches[1].clientX;\n    const dy = touches[0].clientY - touches[1].clientY;\n    return Math.sqrt(dx * dx + dy * dy);\n  }\n\n  private getTouchCenter(touches: TouchList): [number, number] {\n    if (touches.length === 0) return [0, 0];\n    if (touches.length === 1) {\n      return this.getScreenCoords(touches[0].clientX, touches[0].clientY);\n    }\n    const x = (touches[0].clientX + touches[1].clientX) / 2;\n    const y = (touches[0].clientY + touches[1].clientY) / 2;\n    return this.getScreenCoords(x, y);\n  }\n\n  private handleTouchStart(e: TouchEvent): void {\n    if (e.touches.length === 1) {\n      // Single touch - start pan\n      this.isDragging = true;\n      const [x, y] = this.getScreenCoords(e.touches[0].clientX, e.touches[0].clientY);\n      this.lastX = x;\n      this.lastY = y;\n    } else if (e.touches.length === 2) {\n      // Two touches - prepare for pinch zoom\n      this.isDragging = false;\n      this.lastTouchDistance = this.getTouchDistance(e.touches);\n    }\n  }\n\n  private handleTouchMove(e: TouchEvent): void {\n    e.preventDefault();\n\n    if (e.touches.length === 1 && this.isDragging) {\n      // Single touch pan\n      const [x, y] = this.getScreenCoords(e.touches[0].clientX, e.touches[0].clientY);\n      const deltaX = x - this.lastX;\n      const deltaY = y - this.lastY;\n\n      const [width, height] = this.getCanvasSize();\n    this.viewState.pan(deltaX, deltaY, width, height);\n      this.notifyChange();\n\n      this.lastX = x;\n      this.lastY = y;\n    } else if (e.touches.length === 2) {\n      // Pinch zoom\n      const distance = this.getTouchDistance(e.touches);\n      const center = this.getTouchCenter(e.touches);\n\n      if (this.lastTouchDistance > 0) {\n        const raw = distance / this.lastTouchDistance;\n        const zoomFactor = scaleZoomFactor(raw);\n        const [width, height] = this.getCanvasSize();\n        this.viewState.zoomAt(center[0], center[1], zoomFactor, width, height);\n        this.notifyChange();\n      }\n\n      this.lastTouchDistance = distance;\n    }\n  }\n\n  private handleTouchEnd(): void {\n    this.isDragging = false;\n    this.lastTouchDistance = 0;\n  }\n\n  // Keyboard handlers\n  private handleKeyDown(e: KeyboardEvent): void {\n    // Ignore if typing in an input field\n    if (e.target instanceof HTMLInputElement || e.target instanceof HTMLTextAreaElement) {\n      return;\n    }\n\n    switch (e.key) {\n      case '+':\n      case '=': // Allow unshifted + key\n        e.preventDefault();\n        this.onIterationAdjust?.(1);\n        break;\n      case '-':\n      case '_': // Allow shifted - key\n        e.preventDefault();\n        this.onIterationAdjust?.(-1);\n        break;\n      case '0':\n        e.preventDefault();\n        this.onIterationReset?.();\n        break;\n      case 'c':\n        e.preventDefault();\n        this.onPaletteCycle?.(1);\n        break;\n      case 'C':\n        e.preventDefault();\n        this.onPaletteCycle?.(-1);\n        break;\n      case '[':\n      case ',':\n        e.preventDefault();\n        this.onColorOffset?.(-0.1);\n        break;\n      case ']':\n      case '.':\n        e.preventDefault();\n        this.onColorOffset?.(0.1);\n        break;\n      case '{':\n      case '<':\n        e.preventDefault();\n        this.onColorOffset?.(-0.5);\n        break;\n      case '}':\n      case '>':\n        e.preventDefault();\n        this.onColorOffset?.(0.5);\n        break;\n      case 'r':\n      case 'R':\n        e.preventDefault();\n        this.onColorOffsetReset?.();\n        break;\n      case 'a':\n      case 'A':\n        e.preventDefault();\n        this.onToggleAA?.();\n        break;\n      case 'b':\n        // b: extend bright region (make more of image bright)\n        e.preventDefault();\n        this.onAdjustHdrBrightness?.(1);\n        break;\n      case 'B':\n        // Shift+B: contract bright region (make less of image bright)\n        e.preventDefault();\n        this.onAdjustHdrBrightness?.(-1);\n        break;\n      case 'd':\n        // d: reset HDR brightness bias\n        e.preventDefault();\n        this.onResetHdrBrightness?.();\n        break;\n      case 'f':\n        e.preventDefault();\n        this.onFractalCycle?.(1);\n        break;\n      case 'F':\n        e.preventDefault();\n        this.onFractalCycle?.(-1);\n        break;\n      case 'j':\n      case 'J':\n        e.preventDefault();\n        this.onToggleJuliaMode?.();\n        break;\n      case 's':\n      case 'S':\n        e.preventDefault();\n        this.onShare?.();\n        break;\n      case '1':\n      case '2':\n      case '3':\n      case '4':\n      case '5':\n      case '6':\n      case '7':\n      case '8':\n      case '9':\n        e.preventDefault();\n        this.onLocationSelect?.(e.key);\n        break;\n      case 'h':\n      case 'H':\n        e.preventDefault();\n        this.onToggleHelp?.();\n        break;\n      case ' ':\n        e.preventDefault();\n        this.onToggleScreenshotMode?.();\n        break;\n    }\n  }\n\n  /**\n   * Clean up event listeners\n   */\n  destroy(): void {\n    // Event listeners will be cleaned up when canvas is removed\n    // But we could explicitly remove them if needed\n  }\n}\n","/**\n * Type Definitions for Fractal Explorer\n *\n * \"Type safety. Because apparently you monkeys can't be trusted.\"\n * - Skippy the Magnificent\n */\n\n/**\n * Available fractal types.\n * Mandelbrot: z = z² + c\n * Burning Ship: z = (|Re(z)| + i|Im(z)|)² + c\n */\nexport enum FractalType {\n  Mandelbrot = 0,\n  BurningShip = 1,\n  Julia = 2,\n  BurningShipJulia = 3,\n}\n\nexport const FRACTAL_TYPE_NAMES: Record<FractalType, string> = {\n  [FractalType.Mandelbrot]: 'Mandelbrot',\n  [FractalType.BurningShip]: 'Burning Ship',\n  [FractalType.Julia]: 'Julia',\n  [FractalType.BurningShipJulia]: 'Burning Ship Julia',\n};\n\nexport type UniformValue =\n  | number\n  | [number, number]\n  | [number, number, number]\n  | [number, number, number, number];\n\nexport interface UniformMap {\n  [name: string]: UniformValue;\n}\n\nexport interface ViewState {\n  centerX: number; // Real component of center (-2.5 to 1.0 typical)\n  centerY: number; // Imaginary component of center (-1.5 to 1.5 typical)\n  zoom: number; // Zoom factor (1.0 = full set visible)\n}\n","/**\n * Bookmark Manager - URL-based state sharing\n *\n * \"Sharing fractals with the masses. How quaint.\"\n * - Skippy the Magnificent\n */\n\nimport { FractalType } from '../types';\n\n/**\n * Complete fractal state that can be bookmarked\n */\nexport interface BookmarkState {\n  fractalType: FractalType;\n  centerX: number;\n  centerY: number;\n  zoom: number;\n  paletteIndex: number;\n  colorOffset: number;\n  juliaC: [number, number];\n  maxIterationsOverride: number | null;\n  aaEnabled: boolean;\n}\n\n/**\n * URL parameter names (kept short for compact URLs)\n * t = type, x = centerX, y = centerY, z = zoom\n * p = palette, o = color offset\n * jr = julia real, ji = julia imaginary\n * i = iterations, aa = antialiasing\n */\nconst PARAM = {\n  TYPE: 't',\n  CENTER_X: 'x',\n  CENTER_Y: 'y',\n  ZOOM: 'z',\n  PALETTE: 'p',\n  COLOR_OFFSET: 'o',\n  JULIA_REAL: 'jr',\n  JULIA_IMAG: 'ji',\n  ITERATIONS: 'i',\n  AA: 'aa',\n} as const;\n\n/**\n * Encode a number with reasonable precision for URLs.\n * Uses exponential notation for very large/small numbers.\n */\nfunction encodeNumber(n: number, precision: number = 15): string {\n  if (n === 0) return '0';\n  if (Math.abs(n) < 1e-10 || Math.abs(n) > 1e10) {\n    return n.toExponential(precision);\n  }\n  // Trim trailing zeros\n  return parseFloat(n.toPrecision(precision)).toString();\n}\n\n/**\n * Decode a number from URL string\n */\nfunction decodeNumber(s: string | null): number | null {\n  if (s === null || s === '') return null;\n  const n = parseFloat(s);\n  return isNaN(n) ? null : n;\n}\n\n/**\n * Encode fractal state into URL hash parameters\n */\nexport function encodeBookmark(state: BookmarkState): string {\n  const params = new URLSearchParams();\n\n  params.set(PARAM.TYPE, state.fractalType.toString());\n  params.set(PARAM.CENTER_X, encodeNumber(state.centerX));\n  params.set(PARAM.CENTER_Y, encodeNumber(state.centerY));\n  params.set(PARAM.ZOOM, encodeNumber(state.zoom));\n  params.set(PARAM.PALETTE, state.paletteIndex.toString());\n\n  // Only include optional params if they have non-default values\n  if (Math.abs(state.colorOffset) > 0.001) {\n    params.set(PARAM.COLOR_OFFSET, encodeNumber(state.colorOffset, 4));\n  }\n\n  // Include Julia constant for Julia-type fractals\n  if (state.fractalType === FractalType.Julia || state.fractalType === FractalType.BurningShipJulia) {\n    params.set(PARAM.JULIA_REAL, encodeNumber(state.juliaC[0]));\n    params.set(PARAM.JULIA_IMAG, encodeNumber(state.juliaC[1]));\n  }\n\n  if (state.maxIterationsOverride !== null) {\n    params.set(PARAM.ITERATIONS, state.maxIterationsOverride.toString());\n  }\n\n  if (state.aaEnabled) {\n    params.set(PARAM.AA, '1');\n  }\n\n  return params.toString();\n}\n\n/**\n * Decode bookmark state from URL hash parameters.\n * Returns partial state - only includes values that were present in the URL.\n */\nexport function decodeBookmark(hash: string): Partial<BookmarkState> {\n  const params = new URLSearchParams(hash.replace(/^#/, ''));\n  const state: Partial<BookmarkState> = {};\n\n  const type = decodeNumber(params.get(PARAM.TYPE));\n  if (type !== null && type >= 0 && type <= 3) {\n    state.fractalType = type as FractalType;\n  }\n\n  const x = decodeNumber(params.get(PARAM.CENTER_X));\n  if (x !== null) state.centerX = x;\n\n  const y = decodeNumber(params.get(PARAM.CENTER_Y));\n  if (y !== null) state.centerY = y;\n\n  const z = decodeNumber(params.get(PARAM.ZOOM));\n  if (z !== null && z > 0) state.zoom = z;\n\n  const p = decodeNumber(params.get(PARAM.PALETTE));\n  if (p !== null && p >= 0 && p <= 11) state.paletteIndex = Math.floor(p);\n\n  const o = decodeNumber(params.get(PARAM.COLOR_OFFSET));\n  if (o !== null) state.colorOffset = o;\n\n  const jr = decodeNumber(params.get(PARAM.JULIA_REAL));\n  const ji = decodeNumber(params.get(PARAM.JULIA_IMAG));\n  if (jr !== null && ji !== null) {\n    state.juliaC = [jr, ji];\n  }\n\n  const i = decodeNumber(params.get(PARAM.ITERATIONS));\n  if (i !== null && i > 0) state.maxIterationsOverride = Math.floor(i);\n\n  if (params.get(PARAM.AA) === '1') {\n    state.aaEnabled = true;\n  }\n\n  return state;\n}\n\n/**\n * Get the full shareable URL for the current state\n */\nexport function getShareableUrl(state: BookmarkState): string {\n  const hash = encodeBookmark(state);\n  const url = new URL(window.location.href);\n  url.hash = hash;\n  return url.toString();\n}\n\n/**\n * Update the browser URL hash without triggering navigation\n */\nexport function updateUrlHash(state: BookmarkState): void {\n  const hash = encodeBookmark(state);\n  // Use replaceState to avoid cluttering browser history\n  window.history.replaceState(null, '', '#' + hash);\n}\n\n/**\n * Read bookmark state from current URL\n */\nexport function readUrlBookmark(): Partial<BookmarkState> {\n  return decodeBookmark(window.location.hash);\n}\n\n/**\n * Copy the shareable URL to clipboard\n * Returns true if successful\n */\nexport async function copyShareableUrl(state: BookmarkState): Promise<boolean> {\n  const url = getShareableUrl(state);\n  try {\n    await navigator.clipboard.writeText(url);\n    return true;\n  } catch {\n    // Fallback for older browsers\n    const textArea = document.createElement('textarea');\n    textArea.value = url;\n    textArea.style.position = 'fixed';\n    textArea.style.left = '-9999px';\n    document.body.appendChild(textArea);\n    textArea.select();\n    try {\n      document.execCommand('copy');\n      return true;\n    } catch {\n      return false;\n    } finally {\n      document.body.removeChild(textArea);\n    }\n  }\n}\n","/**\n * Famous Fractal Locations - Curated spots of mathematical beauty\n *\n * \"The greatest hits of chaos theory. You're welcome.\"\n * - Skippy the Magnificent\n */\n\nimport { FractalType } from '../types';\nimport { BookmarkState } from './BookmarkManager';\n\nexport interface FamousLocation {\n  name: string;\n  description: string;\n  key: string; // Keyboard shortcut (1-9)\n  state: BookmarkState;\n}\n\n/**\n * Famous locations in the Mandelbrot set and related fractals.\n * Navigate using number keys 1-9.\n */\nexport const FAMOUS_LOCATIONS: FamousLocation[] = [\n  // === MANDELBROT SET ===\n  {\n    name: 'Seahorse Valley',\n    description: 'The iconic seahorse-shaped spirals in the Mandelbrot set',\n    key: '1',\n    state: {\n      fractalType: FractalType.Mandelbrot,\n      centerX: -0.747,\n      centerY: 0.1,\n      zoom: 70,\n      paletteIndex: 4, // Fire\n      colorOffset: 0.1,\n      juliaC: [-0.7, 0.27015],\n      maxIterationsOverride: null,\n      aaEnabled: false,\n    },\n  },\n  {\n    name: 'Elephant Valley',\n    description: 'Elephant trunk-like spirals on the positive real side',\n    key: '2',\n    state: {\n      fractalType: FractalType.Mandelbrot,\n      centerX: 0.273897508880652,\n      centerY: 0.00596002252770864,\n      zoom: 180,\n      paletteIndex: 10, // Sunset\n      colorOffset: -0.1,\n      juliaC: [0.273897508880652, 0.00596002252770864],\n      maxIterationsOverride: null,\n      aaEnabled: false,\n    },\n  },\n  {\n    name: 'Double Spiral Valley',\n    description: 'Beautiful double spirals deep in the set',\n    key: '3',\n    state: {\n      fractalType: FractalType.Mandelbrot,\n      centerX: -0.743733589978665,\n      centerY: 0.130905227502858,\n      zoom: 350,\n      paletteIndex: 11,\n      colorOffset: 0.2,\n      juliaC: [-0.7, 0.27015],\n      maxIterationsOverride: null,\n      aaEnabled: false,\n    },\n  },\n  {\n    name: 'Spiral Galaxy',\n    description: 'Galactic spiral arms emerging from chaos',\n    key: '4',\n    state: {\n      fractalType: FractalType.Mandelbrot,\n      centerX: -0.761542947469557,\n      centerY: -0.0848063048239542,\n      zoom: 1300,\n      paletteIndex: 5,\n      colorOffset: -0.6,\n      juliaC: [-0.7, 0.27015],\n      maxIterationsOverride: null,\n      aaEnabled: false,\n    },\n  },\n\n  // === BURNING SHIP ===\n  {\n    name: 'The Armada',\n    description: 'Mini ships along the antenna of the Burning Ship fractal',\n    key: '5',\n    state: {\n      fractalType: FractalType.BurningShip,\n      centerX: -1.80173025652805,\n      centerY: 0.0153452534367207,\n      zoom: 9,\n      paletteIndex: 11, // Electric\n      colorOffset: 0.2,\n      juliaC: [-0.7, 0.27015],\n      maxIterationsOverride: null,\n      aaEnabled: false,\n    },\n  },\n\n  // === JULIA SETS ===\n  {\n    name: 'Douady Rabbit',\n    description: 'The famous rabbit-eared Julia set',\n    key: '6',\n    state: {\n      fractalType: FractalType.Julia,\n      centerX: 0,\n      centerY: 0,\n      zoom: 0.6,\n      paletteIndex: 11,\n      colorOffset: 0.2,\n      juliaC: [-0.123, 0.745],\n      maxIterationsOverride: null,\n      aaEnabled: false,\n    },\n  },\n  {\n    name: 'Dragon Julia',\n    description: 'Fierce dragon-like Julia set',\n    key: '7',\n    state: {\n      fractalType: FractalType.Julia,\n      centerX: 0,\n      centerY: 0,\n      zoom: 0.45,\n      paletteIndex: 10,\n      colorOffset: 0.5,\n      juliaC: [-0.8, 0.156],\n      maxIterationsOverride: null,\n      aaEnabled: false,\n    },\n  },\n  {\n    name: 'Lightning Julia',\n    description: 'Electric, lightning-like patterns',\n    key: '8',\n    state: {\n      fractalType: FractalType.Julia,\n      centerX: 0,\n      centerY: 0,\n      zoom: 0.45,\n      paletteIndex: 11, // Electric\n      colorOffset: 0.2,\n      juliaC: [-0.7269, 0.1889],\n      maxIterationsOverride: 1000, // Needs more iterations to resolve fine filaments\n      aaEnabled: false,\n    },\n  },\n\n  // === BURNING SHIP JULIA ===\n  {\n    name: 'Burning Ship Julia',\n    description: 'The Burning Ship transformed into Julia form',\n    key: '9',\n    state: {\n      fractalType: FractalType.BurningShipJulia,\n      centerX: 0.0531593112628493,\n      centerY: -0.00735797965780141,\n      zoom: 4,\n      paletteIndex: 4,\n      colorOffset: 0.1,\n      juliaC: [-1.59537659751621, 0.00014862028243811],\n      maxIterationsOverride: null,\n      aaEnabled: false,\n    },\n  },\n];\n\n/**\n * Get a famous location by its keyboard shortcut\n */\nexport function getLocationByKey(key: string): FamousLocation | undefined {\n  return FAMOUS_LOCATIONS.find(loc => loc.key === key);\n}\n","/**\n * Color Palettes - Defined in TypeScript, passed to GPU as parameters\n *\n * \"Colors managed properly, not scattered across shader code like confetti.\"\n * - Skippy the Magnificent\n */\n\nexport type Vec3 = [number, number, number];\n\nexport interface CosinePaletteParams {\n  type: 'cosine';\n  // color = a + b * cos(2π * (c * t + d))\n  a: Vec3;\n  b: Vec3;\n  c: Vec3;\n  d: Vec3;\n}\n\nexport interface GradientPaletteParams {\n  type: 'gradient';\n  // 5 color stops\n  c1: Vec3;\n  c2: Vec3;\n  c3: Vec3;\n  c4: Vec3;\n  c5: Vec3;\n}\n\nexport type PaletteParams = CosinePaletteParams | GradientPaletteParams;\n\nexport interface Palette {\n  name: string;\n  isMonotonic: boolean;\n  params: PaletteParams;\n  // Optional HDR-specific params (for monotonic palettes that need brighter colors)\n  hdrParams?: GradientPaletteParams;\n}\n\n// ============================================\n// All Palettes\n// Cosine palettes work the same for SDR/HDR\n// Gradient palettes can have HDR overrides for brighter base colors\n// ============================================\n\nconst PALETTES: Palette[] = [\n  {\n    name: 'Rainbow',\n    isMonotonic: false,\n    params: {\n      type: 'cosine',\n      a: [0.5, 0.5, 0.5],\n      b: [0.5, 0.5, 0.5],\n      c: [1.0, 1.0, 1.0],\n      d: [0.0, 0.33, 0.67],\n    },\n  },\n  {\n    name: 'Blue',\n    isMonotonic: true,\n    params: {\n      type: 'gradient',\n      c1: [0.02, 0.01, 0.08],\n      c2: [0.05, 0.15, 0.25],\n      c3: [0.1, 0.4, 0.5],\n      c4: [0.3, 0.6, 0.8],\n      c5: [0.7, 0.9, 1.0],\n    },\n    hdrParams: {\n      type: 'gradient',\n      c1: [0.2, 0.4, 1.0],\n      c2: [0.3, 0.6, 1.0],\n      c3: [0.4, 0.8, 1.0],\n      c4: [0.6, 0.9, 1.0],\n      c5: [0.85, 1.0, 1.0],\n    },\n  },\n  {\n    name: 'Gold',\n    isMonotonic: true,\n    params: {\n      type: 'gradient',\n      c1: [0.04, 0.02, 0.01],\n      c2: [0.2, 0.08, 0.02],\n      c3: [0.5, 0.25, 0.05],\n      c4: [0.85, 0.6, 0.2],\n      c5: [1.0, 0.95, 0.7],\n    },\n    hdrParams: {\n      type: 'gradient',\n      c1: [1.0, 0.5, 0.1],\n      c2: [1.0, 0.65, 0.2],\n      c3: [1.0, 0.8, 0.3],\n      c4: [1.0, 0.9, 0.5],\n      c5: [1.0, 1.0, 0.8],\n    },\n  },\n  {\n    name: 'Grayscale',\n    isMonotonic: true,\n    params: {\n      type: 'gradient',\n      c1: [0.01, 0.01, 0.03],\n      c2: [0.15, 0.15, 0.17],\n      c3: [0.45, 0.45, 0.45],\n      c4: [0.75, 0.74, 0.72],\n      c5: [1.0, 0.98, 0.95],\n    },\n    hdrParams: {\n      type: 'gradient',\n      c1: [1.0, 1.0, 1.0],\n      c2: [1.0, 1.0, 1.0],\n      c3: [1.0, 1.0, 1.0],\n      c4: [1.0, 1.0, 1.0],\n      c5: [1.0, 1.0, 1.0],\n    },\n  },\n  {\n    name: 'Fire',\n    isMonotonic: false,\n    params: {\n      type: 'cosine',\n      a: [0.5, 0.5, 0.5],\n      b: [0.5, 0.5, 0.5],\n      c: [1.0, 1.0, 0.5],\n      d: [0.0, 0.1, 0.2],\n    },\n  },\n  {\n    name: 'Ice',\n    isMonotonic: false,\n    params: {\n      type: 'cosine',\n      a: [0.5, 0.5, 0.5],\n      b: [0.5, 0.5, 0.5],\n      c: [1.0, 0.7, 0.4],\n      d: [0.0, 0.15, 0.20],\n    },\n  },\n  {\n    name: 'Sepia',\n    isMonotonic: true,\n    params: {\n      type: 'gradient',\n      c1: [0.03, 0.02, 0.01],\n      c2: [0.15, 0.08, 0.03],\n      c3: [0.4, 0.25, 0.12],\n      c4: [0.7, 0.55, 0.35],\n      c5: [1.0, 0.95, 0.85],\n    },\n    hdrParams: {\n      type: 'gradient',\n      c1: [1.0, 0.7, 0.4],\n      c2: [1.0, 0.8, 0.55],\n      c3: [1.0, 0.88, 0.7],\n      c4: [1.0, 0.95, 0.85],\n      c5: [1.0, 1.0, 0.95],\n    },\n  },\n  {\n    name: 'Ocean',\n    isMonotonic: true,\n    params: {\n      type: 'gradient',\n      c1: [0.0, 0.02, 0.05],\n      c2: [0.02, 0.08, 0.2],\n      c3: [0.05, 0.3, 0.4],\n      c4: [0.2, 0.6, 0.6],\n      c5: [0.6, 0.95, 0.9],\n    },\n    hdrParams: {\n      type: 'gradient',\n      c1: [0.1, 0.8, 0.8],\n      c2: [0.2, 0.9, 0.85],\n      c3: [0.4, 0.95, 0.9],\n      c4: [0.65, 1.0, 0.95],\n      c5: [0.85, 1.0, 1.0],\n    },\n  },\n  {\n    name: 'Purple',\n    isMonotonic: true,\n    params: {\n      type: 'gradient',\n      c1: [0.03, 0.01, 0.06],\n      c2: [0.15, 0.05, 0.25],\n      c3: [0.4, 0.15, 0.5],\n      c4: [0.7, 0.4, 0.75],\n      c5: [0.95, 0.8, 1.0],\n    },\n    hdrParams: {\n      type: 'gradient',\n      c1: [0.8, 0.2, 1.0],\n      c2: [0.85, 0.4, 1.0],\n      c3: [0.9, 0.6, 1.0],\n      c4: [0.95, 0.8, 1.0],\n      c5: [1.0, 0.95, 1.0],\n    },\n  },\n  {\n    name: 'Forest',\n    isMonotonic: true,\n    params: {\n      type: 'gradient',\n      c1: [0.02, 0.03, 0.01],\n      c2: [0.05, 0.12, 0.04],\n      c3: [0.1, 0.35, 0.15],\n      c4: [0.3, 0.65, 0.3],\n      c5: [0.7, 0.95, 0.6],\n    },\n    hdrParams: {\n      type: 'gradient',\n      c1: [0.3, 1.0, 0.2],\n      c2: [0.5, 1.0, 0.4],\n      c3: [0.7, 1.0, 0.55],\n      c4: [0.85, 1.0, 0.75],\n      c5: [0.95, 1.0, 0.9],\n    },\n  },\n  {\n    name: 'Sunset',\n    isMonotonic: false,\n    params: {\n      type: 'cosine',\n      a: [0.5, 0.3, 0.2],\n      b: [0.5, 0.4, 0.3],\n      c: [1.0, 1.0, 0.5],\n      d: [0.0, 0.1, 0.2],\n    },\n  },\n  {\n    name: 'Electric',\n    isMonotonic: false,\n    params: {\n      type: 'cosine',\n      a: [0.5, 0.5, 0.5],\n      b: [0.6, 0.6, 0.6],\n      c: [1.0, 1.0, 1.0],\n      d: [0.3, 0.2, 0.2],\n    },\n  },\n];\n\nexport const PALETTE_COUNT = PALETTES.length;\n\n/**\n * Get palette parameters for rendering\n * @param index Palette index\n * @param hdr Whether to use HDR-specific params (if available)\n */\nexport function getPaletteParams(index: number, hdr: boolean): PaletteParams {\n  const palette = PALETTES[index % PALETTES.length];\n  // Use HDR params if available and HDR is enabled\n  if (hdr && palette.hdrParams) {\n    return palette.hdrParams;\n  }\n  return palette.params;\n}\n\n/**\n * Get full palette info\n */\nexport function getPalette(index: number): Palette {\n  return PALETTES[index % PALETTES.length];\n}\n\nexport function getPaletteName(index: number): string {\n  return PALETTES[index % PALETTES.length].name;\n}\n\n","export default \"// WebGPU Shader for Mandelbrot Set with HDR support\\n// Version 2: Palette parameters passed from TypeScript (no branching)\\n\\nstruct Uniforms {\\n  resolution: vec2f,\\n  center: vec2f,\\n  zoom: f32,\\n  maxIterations: i32,\\n  time: f32,\\n  colorOffset: f32,\\n  fractalType: i32,\\n  juliaC: vec2f,\\n  hdrEnabled: i32,\\n  hdrBrightnessBias: f32, // -1 to +1: shifts which iteration ranges are bright\\n  // Palette parameters\\n  paletteType: i32,      // 0 = cosine, 1 = gradient\\n  isMonotonic: i32,      // 0 = cycling, 1 = monotonic\\n  // Cosine palette: color = a + b * cos(2π * (c * t + d))\\n  paletteA: vec3f,\\n  _pad1: f32,\\n  paletteB: vec3f,\\n  _pad2: f32,\\n  paletteC: vec3f,\\n  _pad3: f32,\\n  paletteD: vec3f,\\n  _pad4: f32,\\n  // Gradient palette: 5 color stops\\n  gradientC1: vec3f,\\n  _pad5: f32,\\n  gradientC2: vec3f,\\n  _pad6: f32,\\n  gradientC3: vec3f,\\n  _pad7: f32,\\n  gradientC4: vec3f,\\n  _pad8: f32,\\n  gradientC5: vec3f,\\n  _pad9: f32,\\n}\\n\\n@group(0) @binding(0) var<uniform> u: Uniforms;\\n\\nstruct VertexOutput {\\n  @builtin(position) position: vec4f,\\n  @location(0) uv: vec2f,\\n}\\n\\n@vertex\\nfn vertexMain(@builtin(vertex_index) vertexIndex: u32) -> VertexOutput {\\n  var pos = array<vec2f, 3>(\\n    vec2f(-1.0, -1.0),\\n    vec2f(3.0, -1.0),\\n    vec2f(-1.0, 3.0)\\n  );\\n  var output: VertexOutput;\\n  output.position = vec4f(pos[vertexIndex], 0.0, 1.0);\\n  output.uv = (pos[vertexIndex] + 1.0) * 0.5;\\n  return output;\\n}\\n\\n// Cosine palette formula\\nfn cosineColor(t: f32, a: vec3f, b: vec3f, c: vec3f, d: vec3f) -> vec3f {\\n  return a + b * cos(6.28318 * (c * t + d));\\n}\\n\\n// 5-stop gradient\\nfn gradientColor(t: f32, c1: vec3f, c2: vec3f, c3: vec3f, c4: vec3f, c5: vec3f) -> vec3f {\\n  if (t < 0.25) { return mix(c1, c2, t * 4.0); }\\n  else if (t < 0.5) { return mix(c2, c3, (t - 0.25) * 4.0); }\\n  else if (t < 0.75) { return mix(c3, c4, (t - 0.5) * 4.0); }\\n  else { return mix(c4, c5, (t - 0.75) * 4.0); }\\n}\\n\\n// Get color based on palette type\\nfn getColor(t_in: f32, isCycling: bool) -> vec3f {\\n  var t = t_in;\\n  if (isCycling) {\\n    t = fract(t);\\n  } else {\\n    t = clamp(t, 0.0, 1.0);\\n  }\\n\\n  if (u.paletteType == 0) {\\n    return cosineColor(t, u.paletteA, u.paletteB, u.paletteC, u.paletteD);\\n  } else {\\n    return gradientColor(t, u.gradientC1, u.gradientC2, u.gradientC3, u.gradientC4, u.gradientC5);\\n  }\\n}\\n\\n// HDR brightness curve for MONOTONIC palettes\\n// bias: -1 to +1, shifts the bright region earlier (positive) or later (negative)\\nfn hdrBrightnessCurveMonotonic(normalized: f32, bias: f32) -> f32 {\\n  // Shift the normalized value by bias to move bright regions\\n  // bias > 0: more of the image becomes bright (bright region starts earlier)\\n  // bias < 0: less of the image is bright (bright region starts later)\\n  let shifted = clamp(normalized + bias * 0.4, 0.0, 1.0);\\n\\n  let LOW_END = 0.05;\\n  let MID_START = 0.30;\\n  let HIGH_START = 0.60;\\n  let PEAK = 10.0; // Fixed peak multiplier for HDR\\n\\n  if (shifted < LOW_END) {\\n    let t = shifted / LOW_END;\\n    return mix(0.0, 0.15, sqrt(t));\\n  } else if (shifted < MID_START) {\\n    let t = (shifted - LOW_END) / (MID_START - LOW_END);\\n    return mix(0.15, 0.5, t);\\n  } else if (shifted < HIGH_START) {\\n    let t = (shifted - MID_START) / (HIGH_START - MID_START);\\n    return mix(0.5, 1.0, t);\\n  } else {\\n    let t = (shifted - HIGH_START) / (1.0 - HIGH_START);\\n    let eased = pow(t, 1.1);\\n    return mix(1.0, PEAK, eased);\\n  }\\n}\\n\\n// HDR brightness curve for CYCLING palettes\\n// bias: -1 to +1, shifts the HDR highlight region\\nfn hdrBrightnessCurveCycling(normalized: f32, bias: f32) -> f32 {\\n  // Shift where the HDR boost kicks in\\n  // bias > 0: HDR highlights appear earlier (more of image gets boost)\\n  // bias < 0: HDR highlights appear later (only near-boundary gets boost)\\n  let HIGH_START = clamp(0.70 - bias * 0.25, 0.3, 0.95);\\n  let PEAK = 10.0; // Fixed peak multiplier for HDR\\n\\n  if (normalized < HIGH_START) {\\n    let t = normalized / HIGH_START;\\n    return mix(0.85, 1.0, t);\\n  } else {\\n    let t = (normalized - HIGH_START) / (1.0 - HIGH_START);\\n    let eased = pow(t, 1.2);\\n    return mix(1.0, PEAK, eased);\\n  }\\n}\\n\\n@fragment\\nfn fragmentMain(input: VertexOutput) -> @location(0) vec4f {\\n  let aspect = u.resolution.x / u.resolution.y;\\n  var uv = input.uv - 0.5;\\n  uv.x *= aspect;\\n  let pos = u.center + uv / u.zoom;\\n\\n  var z: vec2f;\\n  var c: vec2f;\\n  let isJulia = (u.fractalType == 2 || u.fractalType == 3);\\n  let isBurningShip = (u.fractalType == 1 || u.fractalType == 3);\\n\\n  if (isJulia) {\\n    z = pos;\\n    c = u.juliaC;\\n  } else {\\n    z = vec2f(0.0);\\n    c = pos;\\n  }\\n\\n  var iterations = 0;\\n  let maxIter = u.maxIterations;\\n\\n  for (var i = 0; i < 65536; i++) {\\n    if (i >= maxIter) { break; }\\n    let zMagSq = dot(z, z);\\n    if (zMagSq > 4.0) { break; }\\n\\n    if (isBurningShip) {\\n      z = vec2f(abs(z.x), -abs(z.y));\\n    }\\n    z = vec2f(z.x * z.x - z.y * z.y + c.x, 2.0 * z.x * z.y + c.y);\\n    iterations++;\\n  }\\n\\n  if (iterations >= maxIter) {\\n    return vec4f(0.0, 0.0, 0.0, 1.0);\\n  }\\n\\n  let smoothIter = f32(iterations) + 1.0 - log2(log2(max(dot(z, z), 4.0)));\\n  let normalized = smoothIter / f32(maxIter);\\n\\n  let isMonotonic = u.isMonotonic != 0;\\n  let isCycling = !isMonotonic;\\n\\n  var t: f32;\\n  if (isMonotonic) {\\n    t = normalized + u.colorOffset;\\n  } else {\\n    let numCycles = 8.0;\\n    t = normalized * numCycles + u.colorOffset;\\n  }\\n\\n  var color = getColor(t, isCycling);\\n\\n  if (u.hdrEnabled != 0) {\\n    var brightnessMult: f32;\\n\\n    if (isMonotonic) {\\n      brightnessMult = hdrBrightnessCurveMonotonic(normalized, u.hdrBrightnessBias);\\n    } else {\\n      brightnessMult = hdrBrightnessCurveCycling(normalized, u.hdrBrightnessBias);\\n    }\\n\\n    color = color * brightnessMult;\\n    return vec4f(color, 1.0);\\n  } else {\\n    let edgeFactor = 1.0 - f32(iterations) / f32(maxIter);\\n    let glow = pow(edgeFactor, 0.5) * 0.3;\\n    color = color * (1.0 + glow);\\n    return vec4f(min(color, vec3f(1.0)), 1.0);\\n  }\\n}\\n\"","/**\n * WebGPU Fractal Engine - HDR-capable fractal renderer\n *\n * \"WebGPU: Finally, graphics done right.\"\n * - Skippy the Magnificent\n */\n\nimport { WebGPURenderer } from '../renderer/WebGPURenderer';\nimport { ViewState } from '../controls/ViewState';\nimport { InputHandler } from '../controls/InputHandler';\nimport { FractalType, FRACTAL_TYPE_NAMES } from '../types';\nimport {\n  BookmarkState,\n  readUrlBookmark,\n  updateUrlHash,\n  copyShareableUrl,\n} from '../bookmark/BookmarkManager';\nimport { getLocationByKey } from '../bookmark/famousLocations';\nimport { getPalette, getPaletteParams, getPaletteName, PALETTE_COUNT } from '../renderer/Palettes';\n\nimport shaderSource from '../renderer/shaders/mandelbrot.wgsl?raw';\n\n/** Base iterations at zoom 1 */\nconst MAX_ITERATIONS_BASE = 256;\nconst MAX_ITERATIONS_BASE_JULIA = 512;\nconst MAX_ITERATIONS_AUTO_CAP = 4096;\nconst MAX_ITERATIONS_LOG_SCALE = 640;\nconst MAX_ITERATIONS_LOG_POWER = 1.65;\nconst ITERATION_ADJUST_RATIO = 1.5;\n\nfunction maxIterationsForZoom(zoom: number, isJulia: boolean = false): number {\n  const z = Math.max(1, zoom);\n  const L = Math.log10(z);\n  const base = isJulia ? MAX_ITERATIONS_BASE_JULIA : MAX_ITERATIONS_BASE;\n  const n = base + MAX_ITERATIONS_LOG_SCALE * Math.pow(L, MAX_ITERATIONS_LOG_POWER);\n  return Math.round(Math.max(base, Math.min(MAX_ITERATIONS_AUTO_CAP, n)));\n}\n\n// Uniform buffer structure (must match WGSL)\n// Base uniforms: 64 bytes\n// Palette params: ~160 bytes (vec3s with padding)\n// Total: 256 bytes (nice round number)\nconst UNIFORM_BUFFER_SIZE = 256;\n\nexport class WebGPUFractalEngine {\n  private renderer: WebGPURenderer;\n  private viewState: ViewState;\n  private inputHandler: InputHandler;\n\n  private pipeline!: GPURenderPipeline;\n  private uniformBuffer!: GPUBuffer;\n  private bindGroup!: GPUBindGroup;\n\n  private maxIterationsOverride: number | null = null;\n  private fractalType: FractalType = FractalType.Mandelbrot;\n  private juliaC: [number, number] = [-0.7, 0.27015];\n  private juliaPickerMode = false;\n  private savedViewState: { centerX: number; centerY: number; zoom: number } | null = null;\n  private savedFractalType: FractalType | null = null;\n\n  private paletteIndex = 4; // Fire\n  private colorOffset = 0.0;\n\n  /** HDR brightness bias: -1 to +1, shifts which regions appear bright */\n  private hdrBrightnessBias = 0.0;\n\n  private debugOverlay: HTMLElement | null = null;\n  private shareNotification: HTMLElement | null = null;\n  private helpOverlay: HTMLElement | null = null;\n  private helpVisible = false;\n  private screenshotMode = false;\n\n  private constructor(renderer: WebGPURenderer, canvas: HTMLCanvasElement) {\n    this.renderer = renderer;\n    this.viewState = new ViewState();\n\n    this.inputHandler = new InputHandler(canvas, this.viewState, () => {\n      this.render();\n    });\n\n    this.setupInputCallbacks();\n    this.setupOverlays(canvas);\n  }\n\n  static async create(canvas: HTMLCanvasElement): Promise<WebGPUFractalEngine> {\n    const renderer = await WebGPURenderer.create(canvas);\n    const engine = new WebGPUFractalEngine(renderer, canvas);\n    await engine.initializePipeline();\n\n    // Listen for HDR display changes\n    renderer.setOnHdrChange(() => {\n      console.log('HDR status changed, re-rendering...');\n      engine.render();\n    });\n\n    window.addEventListener('resize', engine.handleResize);\n    window.addEventListener('hashchange', engine.handleHashChange);\n\n    engine.loadBookmark();\n    engine.handleResize();\n\n    return engine;\n  }\n\n  private async initializePipeline(): Promise<void> {\n    const device = this.renderer.device;\n\n    // Create shader module\n    const shaderModule = device.createShaderModule({\n      label: 'Mandelbrot Shader',\n      code: shaderSource,\n    });\n\n    // Create uniform buffer\n    this.uniformBuffer = device.createBuffer({\n      label: 'Uniforms',\n      size: UNIFORM_BUFFER_SIZE,\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\n    });\n\n    // Create bind group layout\n    const bindGroupLayout = device.createBindGroupLayout({\n      label: 'Bind Group Layout',\n      entries: [{\n        binding: 0,\n        visibility: GPUShaderStage.VERTEX | GPUShaderStage.FRAGMENT,\n        buffer: { type: 'uniform' },\n      }],\n    });\n\n    // Create bind group\n    this.bindGroup = device.createBindGroup({\n      label: 'Bind Group',\n      layout: bindGroupLayout,\n      entries: [{\n        binding: 0,\n        resource: { buffer: this.uniformBuffer },\n      }],\n    });\n\n    // Create pipeline layout\n    const pipelineLayout = device.createPipelineLayout({\n      label: 'Pipeline Layout',\n      bindGroupLayouts: [bindGroupLayout],\n    });\n\n    // Create render pipeline\n    this.pipeline = device.createRenderPipeline({\n      label: 'Mandelbrot Pipeline',\n      layout: pipelineLayout,\n      vertex: {\n        module: shaderModule,\n        entryPoint: 'vertexMain',\n      },\n      fragment: {\n        module: shaderModule,\n        entryPoint: 'fragmentMain',\n        targets: [{\n          format: this.renderer.format,\n        }],\n      },\n      primitive: {\n        topology: 'triangle-list',\n      },\n    });\n\n    console.log('WebGPU pipeline initialized');\n  }\n\n  private setupInputCallbacks(): void {\n    this.inputHandler.setIterationAdjustCallback((direction) => {\n      this.adjustMaxIterations(direction);\n    });\n    this.inputHandler.setIterationResetCallback(() => {\n      this.clearMaxIterationsOverride();\n    });\n    this.inputHandler.setPaletteCycleCallback((direction) => {\n      this.cyclePalette(direction);\n    });\n    this.inputHandler.setColorOffsetCallback((delta) => {\n      this.adjustColorOffset(delta);\n    });\n    this.inputHandler.setColorOffsetResetCallback(() => {\n      this.resetColorOffset();\n    });\n    this.inputHandler.setToggleAACallback(() => {\n      // AA not supported in WebGPU version (HDR is always on)\n      console.log('AA not available in WebGPU HDR mode');\n    });\n    this.inputHandler.setToggleHDRCallback(() => {\n      this.toggleHDR();\n    });\n    this.inputHandler.setAdjustHdrBrightnessCallback((direction) => {\n      this.adjustHdrBrightness(direction);\n    });\n    this.inputHandler.setResetHdrBrightnessCallback(() => {\n      this.resetHdrBrightness();\n    });\n    this.inputHandler.setFractalCycleCallback((direction) => {\n      this.cycleFractalType(direction);\n    });\n    this.inputHandler.setToggleJuliaModeCallback(() => {\n      this.toggleJuliaPickerMode();\n    });\n    this.inputHandler.setJuliaPickCallback((x, y) => {\n      this.pickJuliaConstant(x, y);\n    });\n    this.inputHandler.setShareCallback(() => {\n      this.shareBookmark();\n    });\n    this.inputHandler.setLocationSelectCallback((key) => {\n      this.goToLocation(key);\n    });\n    this.inputHandler.setToggleHelpCallback(() => {\n      this.toggleHelp();\n    });\n    this.inputHandler.setToggleScreenshotModeCallback(() => {\n      this.toggleScreenshotMode();\n    });\n  }\n\n  private setupOverlays(canvas: HTMLCanvasElement): void {\n    const parent = canvas.parentElement;\n    if (!parent) return;\n\n    this.debugOverlay = document.createElement('div');\n    this.debugOverlay.id = 'zoom-debug';\n    parent.appendChild(this.debugOverlay);\n\n    this.shareNotification = document.createElement('div');\n    this.shareNotification.id = 'share-notification';\n    this.shareNotification.style.cssText = `\n      position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);\n      background: rgba(0, 0, 0, 0.85); color: #4ade80; padding: 16px 32px;\n      border-radius: 8px; font-family: system-ui, sans-serif; font-size: 16px;\n      z-index: 1000; opacity: 0; transition: opacity 0.3s ease; pointer-events: none;\n    `;\n    parent.appendChild(this.shareNotification);\n\n    this.helpOverlay = document.createElement('div');\n    this.helpOverlay.id = 'help-overlay';\n    this.helpOverlay.innerHTML = this.createHelpContent();\n    this.helpOverlay.style.cssText = `\n      position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);\n      background: rgba(0, 0, 0, 0.92); color: #e5e5e5; padding: 24px 32px;\n      border-radius: 12px; font-family: system-ui, -apple-system, sans-serif;\n      font-size: 14px; z-index: 1001; opacity: 0; transition: opacity 0.2s ease;\n      pointer-events: none; max-width: 90vw; max-height: 90vh; overflow-y: auto;\n      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5); border: 1px solid rgba(255, 255, 255, 0.1);\n    `;\n    parent.appendChild(this.helpOverlay);\n  }\n\n  private handleResize = (): void => {\n    this.renderer.resize(window.innerWidth, window.innerHeight);\n    this.render();\n  };\n\n  private handleHashChange = (): void => {\n    this.loadBookmark();\n  };\n\n  private render(): void {\n    const device = this.renderer.device;\n    const canvas = this.renderer.canvas;\n\n    const isJulia = this.fractalType === FractalType.Julia ||\n                    this.fractalType === FractalType.BurningShipJulia;\n    const maxIter = this.maxIterationsOverride ??\n                    maxIterationsForZoom(this.viewState.zoom, isJulia);\n\n    // Update debug overlay\n    if (this.debugOverlay && !this.screenshotMode) {\n      const z = this.viewState.zoom;\n      const zoomStr = z >= 1e6 ? z.toExponential(2) : z < 1 ? z.toPrecision(4) : String(Math.round(z));\n      const iterSuffix = this.maxIterationsOverride !== null ? ' (manual)' : '';\n      const paletteName = getPaletteName(this.paletteIndex);\n      const fractalName = FRACTAL_TYPE_NAMES[this.fractalType];\n      const hdrStatus = this.renderer.hdrEnabled\n        ? (Math.abs(this.hdrBrightnessBias) > 0.01\n            ? `HDR (${this.hdrBrightnessBias > 0 ? '+' : ''}${this.hdrBrightnessBias.toFixed(2)})`\n            : 'HDR')\n        : (this.renderer.displaySupportsHDR ? 'HDR available' : 'SDR');\n      const juliaStatus = this.juliaPickerMode ? '🎯 Pick Julia point' : '';\n      const juliaCoords = isJulia ? `c=(${this.juliaC[0].toFixed(4)}, ${this.juliaC[1].toFixed(4)})` : '';\n      const colorOffsetStr = Math.abs(this.colorOffset) > 0.001 ? `offset ${this.colorOffset.toFixed(1)}` : '';\n\n      const statusParts = [fractalName, `zoom ${zoomStr}`, `iterations ${maxIter}${iterSuffix}`, paletteName];\n      if (colorOffsetStr) statusParts.push(colorOffsetStr);\n      if (juliaCoords) statusParts.push(juliaCoords);\n      statusParts.push(hdrStatus);\n      if (juliaStatus) statusParts.push(juliaStatus);\n      statusParts.push('H = help');\n      this.debugOverlay.textContent = statusParts.join('  ·  ');\n    }\n\n    // Update uniforms\n    const uniformData = new ArrayBuffer(UNIFORM_BUFFER_SIZE);\n    const floatView = new Float32Array(uniformData);\n    const intView = new Int32Array(uniformData);\n\n    // Get current palette info and params\n    const palette = getPalette(this.paletteIndex);\n    const paletteParams = getPaletteParams(this.paletteIndex, this.renderer.hdrEnabled);\n\n    // Pack base uniforms (must match WGSL struct layout with padding)\n    floatView[0] = canvas.width;                    // resolution.x\n    floatView[1] = canvas.height;                   // resolution.y\n    floatView[2] = this.viewState.centerX;          // center.x\n    floatView[3] = this.viewState.centerY;          // center.y\n    floatView[4] = this.viewState.zoom;             // zoom\n    intView[5] = maxIter;                           // maxIterations\n    floatView[6] = performance.now() * 0.001;       // time\n    floatView[7] = this.colorOffset;                // colorOffset\n    intView[8] = this.fractalType;                  // fractalType\n    // padding at 9\n    floatView[10] = this.juliaC[0];                 // juliaC.x\n    floatView[11] = this.juliaC[1];                 // juliaC.y\n    intView[12] = this.renderer.hdrEnabled ? 1 : 0; // hdrEnabled\n    floatView[13] = this.hdrBrightnessBias;         // hdrBrightnessBias\n    intView[14] = paletteParams.type === 'cosine' ? 0 : 1; // paletteType\n    intView[15] = palette.isMonotonic ? 1 : 0;       // isMonotonic\n\n    // Pack palette parameters (offset 16 = 64 bytes)\n    if (paletteParams.type === 'cosine') {\n      // paletteA (vec3 + padding)\n      floatView[16] = paletteParams.a[0];\n      floatView[17] = paletteParams.a[1];\n      floatView[18] = paletteParams.a[2];\n      // padding at 19\n      // paletteB\n      floatView[20] = paletteParams.b[0];\n      floatView[21] = paletteParams.b[1];\n      floatView[22] = paletteParams.b[2];\n      // padding at 23\n      // paletteC\n      floatView[24] = paletteParams.c[0];\n      floatView[25] = paletteParams.c[1];\n      floatView[26] = paletteParams.c[2];\n      // padding at 27\n      // paletteD\n      floatView[28] = paletteParams.d[0];\n      floatView[29] = paletteParams.d[1];\n      floatView[30] = paletteParams.d[2];\n      // padding at 31\n    }\n\n    // Gradient colors start at offset 32 (128 bytes)\n    if (paletteParams.type === 'gradient') {\n      // gradientC1\n      floatView[32] = paletteParams.c1[0];\n      floatView[33] = paletteParams.c1[1];\n      floatView[34] = paletteParams.c1[2];\n      // padding at 35\n      // gradientC2\n      floatView[36] = paletteParams.c2[0];\n      floatView[37] = paletteParams.c2[1];\n      floatView[38] = paletteParams.c2[2];\n      // padding at 39\n      // gradientC3\n      floatView[40] = paletteParams.c3[0];\n      floatView[41] = paletteParams.c3[1];\n      floatView[42] = paletteParams.c3[2];\n      // padding at 43\n      // gradientC4\n      floatView[44] = paletteParams.c4[0];\n      floatView[45] = paletteParams.c4[1];\n      floatView[46] = paletteParams.c4[2];\n      // padding at 47\n      // gradientC5\n      floatView[48] = paletteParams.c5[0];\n      floatView[49] = paletteParams.c5[1];\n      floatView[50] = paletteParams.c5[2];\n      // padding at 51\n    }\n\n    device.queue.writeBuffer(this.uniformBuffer, 0, uniformData);\n\n    // Render\n    const commandEncoder = device.createCommandEncoder();\n    const textureView = this.renderer.getCurrentTexture().createView();\n\n    const renderPass = commandEncoder.beginRenderPass({\n      colorAttachments: [{\n        view: textureView,\n        clearValue: { r: 0, g: 0, b: 0, a: 1 },\n        loadOp: 'clear',\n        storeOp: 'store',\n      }],\n    });\n\n    renderPass.setPipeline(this.pipeline);\n    renderPass.setBindGroup(0, this.bindGroup);\n    renderPass.draw(3); // Fullscreen triangle\n    renderPass.end();\n\n    device.queue.submit([commandEncoder.finish()]);\n  }\n\n  start(): void {\n    this.renderer.start(() => this.render());\n  }\n\n  stop(): void {\n    this.renderer.stop();\n  }\n\n  // --- Iteration controls ---\n\n  private adjustMaxIterations(direction: 1 | -1): void {\n    const isJulia = this.fractalType === FractalType.Julia ||\n                    this.fractalType === FractalType.BurningShipJulia;\n    const currentIter = this.maxIterationsOverride ??\n                        maxIterationsForZoom(this.viewState.zoom, isJulia);\n    const newIter = direction > 0\n      ? currentIter * ITERATION_ADJUST_RATIO\n      : currentIter / ITERATION_ADJUST_RATIO;\n    this.maxIterationsOverride = Math.round(Math.max(1, newIter));\n    this.render();\n  }\n\n  private clearMaxIterationsOverride(): void {\n    this.maxIterationsOverride = null;\n    this.render();\n  }\n\n  // --- HDR controls ---\n\n  private toggleHDR(): void {\n    // HDR is controlled by the renderer, we just adjust brightness bias\n    console.log(`HDR is ${this.renderer.hdrEnabled ? 'enabled' : 'not available'}`);\n    this.render();\n  }\n\n  /**\n   * Adjust HDR brightness bias.\n   * @param direction 1 for brighter (more of image is bright), -1 for dimmer\n   */\n  private adjustHdrBrightness(direction: 1 | -1): void {\n    if (!this.renderer.hdrEnabled) return;\n    // Adjust by 0.1 each step, clamped to -1 to +1\n    // Positive direction = increase bias = brighter\n    this.hdrBrightnessBias = Math.max(-1, Math.min(1, this.hdrBrightnessBias + direction * 0.1));\n    this.render();\n  }\n\n  /**\n   * Reset HDR brightness bias to default (0)\n   */\n  private resetHdrBrightness(): void {\n    this.hdrBrightnessBias = 0;\n    this.render();\n  }\n\n  // --- Palette controls ---\n\n  private cyclePalette(direction: 1 | -1): void {\n    this.paletteIndex = (this.paletteIndex + direction + PALETTE_COUNT) % PALETTE_COUNT;\n    this.render();\n  }\n\n  private adjustColorOffset(delta: number): void {\n    this.colorOffset += delta;\n    this.render();\n  }\n\n  private resetColorOffset(): void {\n    this.colorOffset = 0;\n    this.render();\n  }\n\n  // --- Fractal type controls ---\n\n  private cycleFractalType(direction: 1 | -1 = 1): void {\n    if (this.fractalType === FractalType.Julia) {\n      this.fractalType = FractalType.Mandelbrot;\n    } else if (this.fractalType === FractalType.BurningShipJulia) {\n      this.fractalType = FractalType.BurningShip;\n    }\n    this.fractalType = (this.fractalType + direction + 2) % 2;\n    if (this.juliaPickerMode) {\n      this.juliaPickerMode = false;\n      this.inputHandler.setJuliaPickerMode(false);\n    }\n    this.render();\n  }\n\n  private toggleJuliaPickerMode(): void {\n    if (this.fractalType === FractalType.Julia ||\n        this.fractalType === FractalType.BurningShipJulia) {\n      this.exitJuliaMode();\n      return;\n    }\n    this.juliaPickerMode = !this.juliaPickerMode;\n    this.inputHandler.setJuliaPickerMode(this.juliaPickerMode);\n    this.render();\n  }\n\n  private pickJuliaConstant(fractalX: number, fractalY: number): void {\n    if (!this.juliaPickerMode) return;\n\n    this.savedViewState = {\n      centerX: this.viewState.centerX,\n      centerY: this.viewState.centerY,\n      zoom: this.viewState.zoom,\n    };\n    this.savedFractalType = this.fractalType;\n\n    this.juliaC = [fractalX, fractalY];\n    this.fractalType = this.fractalType === FractalType.BurningShip\n      ? FractalType.BurningShipJulia\n      : FractalType.Julia;\n\n    this.viewState.centerX = 0;\n    this.viewState.centerY = 0;\n    this.viewState.zoom = 0.5;\n\n    this.juliaPickerMode = false;\n    this.inputHandler.setJuliaPickerMode(false);\n    this.render();\n  }\n\n  private exitJuliaMode(): void {\n    if (this.savedViewState) {\n      this.viewState.centerX = this.savedViewState.centerX;\n      this.viewState.centerY = this.savedViewState.centerY;\n      this.viewState.zoom = this.savedViewState.zoom;\n      this.savedViewState = null;\n    }\n    if (this.savedFractalType !== null) {\n      this.fractalType = this.savedFractalType;\n      this.savedFractalType = null;\n    } else {\n      this.fractalType = this.fractalType === FractalType.BurningShipJulia\n        ? FractalType.BurningShip\n        : FractalType.Mandelbrot;\n    }\n    this.juliaPickerMode = false;\n    this.inputHandler.setJuliaPickerMode(false);\n    this.render();\n  }\n\n  // --- Bookmarks ---\n\n  private getBookmarkState(): BookmarkState {\n    return {\n      fractalType: this.fractalType,\n      centerX: this.viewState.centerX,\n      centerY: this.viewState.centerY,\n      zoom: this.viewState.zoom,\n      paletteIndex: this.paletteIndex,\n      colorOffset: this.colorOffset,\n      juliaC: this.juliaC,\n      maxIterationsOverride: this.maxIterationsOverride,\n      aaEnabled: false, // AA not supported in WebGPU version\n    };\n  }\n\n  private loadBookmark(): void {\n    const bookmark = readUrlBookmark();\n    if (!bookmark) return;\n\n    if (bookmark.centerX !== undefined) this.viewState.centerX = bookmark.centerX;\n    if (bookmark.centerY !== undefined) this.viewState.centerY = bookmark.centerY;\n    if (bookmark.zoom !== undefined) this.viewState.zoom = bookmark.zoom;\n    if (bookmark.maxIterationsOverride !== undefined) {\n      this.maxIterationsOverride = bookmark.maxIterationsOverride;\n    }\n    if (bookmark.paletteIndex !== undefined) {\n      this.paletteIndex = bookmark.paletteIndex % PALETTE_COUNT;\n    }\n    if (bookmark.colorOffset !== undefined) {\n      this.colorOffset = bookmark.colorOffset;\n    }\n    if (bookmark.fractalType !== undefined) {\n      this.fractalType = bookmark.fractalType;\n    }\n    if (bookmark.juliaC !== undefined) {\n      this.juliaC = bookmark.juliaC;\n    }\n\n    this.render();\n  }\n\n  private goToLocation(key: string): void {\n    const location = getLocationByKey(key);\n    if (!location) return;\n\n    const state = location.state;\n    this.viewState.centerX = state.centerX;\n    this.viewState.centerY = state.centerY;\n    this.viewState.zoom = state.zoom;\n    this.maxIterationsOverride = state.maxIterationsOverride;\n    this.fractalType = state.fractalType;\n    this.juliaC = state.juliaC;\n    this.paletteIndex = state.paletteIndex;\n    this.colorOffset = state.colorOffset;\n\n    this.updateUrlBookmark();\n    this.render();\n  }\n\n  private updateUrlBookmark(): void {\n    updateUrlHash(this.getBookmarkState());\n  }\n\n  async shareBookmark(): Promise<void> {\n    const success = await copyShareableUrl(this.getBookmarkState());\n    this.showShareNotification(success);\n    if (success) {\n      this.updateUrlBookmark();\n    }\n  }\n\n  private showShareNotification(success: boolean): void {\n    if (!this.shareNotification) return;\n    this.shareNotification.textContent = success\n      ? '📋 Link copied to clipboard!'\n      : '❌ Failed to copy link';\n    this.shareNotification.style.color = success ? '#4ade80' : '#f87171';\n    this.shareNotification.style.opacity = '1';\n    setTimeout(() => {\n      if (this.shareNotification) {\n        this.shareNotification.style.opacity = '0';\n      }\n    }, 2000);\n  }\n\n  // --- UI toggles ---\n\n  private toggleHelp(): void {\n    this.helpVisible = !this.helpVisible;\n    if (this.helpOverlay) {\n      this.helpOverlay.style.opacity = this.helpVisible ? '1' : '0';\n      this.helpOverlay.style.pointerEvents = this.helpVisible ? 'auto' : 'none';\n    }\n  }\n\n  private toggleScreenshotMode(): void {\n    this.screenshotMode = !this.screenshotMode;\n    if (this.screenshotMode && this.helpVisible) {\n      this.helpVisible = false;\n      if (this.helpOverlay) {\n        this.helpOverlay.style.opacity = '0';\n        this.helpOverlay.style.pointerEvents = 'none';\n      }\n    }\n    if (this.debugOverlay) {\n      this.debugOverlay.style.display = this.screenshotMode ? 'none' : 'block';\n    }\n    if (this.shareNotification) {\n      this.shareNotification.textContent = this.screenshotMode\n        ? '📷 Screenshot mode (Space to exit)'\n        : '📷 UI restored';\n      this.shareNotification.style.color = '#60a5fa';\n      this.shareNotification.style.opacity = '1';\n      setTimeout(() => {\n        if (this.shareNotification) {\n          this.shareNotification.style.opacity = '0';\n        }\n      }, 1000);\n    }\n  }\n\n  private createHelpContent(): string {\n    return `\n      <h2 style=\"margin: 0 0 16px 0; color: #60a5fa; font-size: 20px; font-weight: 600;\">\n        🌀 Fractal Explorer (WebGPU HDR) - Keyboard Shortcuts\n      </h2>\n      <div style=\"display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px 32px;\">\n        <div style=\"margin-bottom: 12px;\">\n          <h3 style=\"margin: 0 0 8px 0; color: #a78bfa; font-size: 13px; text-transform: uppercase;\">Navigation</h3>\n          <div style=\"display: grid; gap: 4px;\">\n            ${this.helpRow('Drag', 'Pan view')}\n            ${this.helpRow('Scroll', 'Zoom in/out')}\n            ${this.helpRow('Double-click', 'Zoom in at point')}\n            ${this.helpRow('1-9', 'Famous locations')}\n          </div>\n        </div>\n        <div style=\"margin-bottom: 12px;\">\n          <h3 style=\"margin: 0 0 8px 0; color: #a78bfa; font-size: 13px; text-transform: uppercase;\">Iterations</h3>\n          <div style=\"display: grid; gap: 4px;\">\n            ${this.helpRow('+/-', 'Adjust iterations')}\n            ${this.helpRow('0', 'Reset to auto')}\n          </div>\n        </div>\n        <div style=\"margin-bottom: 12px;\">\n          <h3 style=\"margin: 0 0 8px 0; color: #a78bfa; font-size: 13px; text-transform: uppercase;\">Colors</h3>\n          <div style=\"display: grid; gap: 4px;\">\n            ${this.helpRow('C / Shift+C', 'Cycle palettes')}\n            ${this.helpRow(', / .', 'Shift colors (fine)')}\n            ${this.helpRow('< / >', 'Shift colors (coarse)')}\n            ${this.helpRow('R', 'Reset color offset')}\n          </div>\n        </div>\n        <div style=\"margin-bottom: 12px;\">\n          <h3 style=\"margin: 0 0 8px 0; color: #a78bfa; font-size: 13px; text-transform: uppercase;\">Fractal Type</h3>\n          <div style=\"display: grid; gap: 4px;\">\n            ${this.helpRow('F / Shift+F', 'Cycle fractals')}\n            ${this.helpRow('J', 'Julia picker mode')}\n          </div>\n        </div>\n        <div style=\"margin-bottom: 12px;\">\n          <h3 style=\"margin: 0 0 8px 0; color: #a78bfa; font-size: 13px; text-transform: uppercase;\">HDR Brightness</h3>\n          <div style=\"display: grid; gap: 4px;\">\n            ${this.helpRow('B', 'More bright (extend)')}\n            ${this.helpRow('Shift+B', 'Less bright (contract)')}\n            ${this.helpRow('D', 'Reset brightness')}\n          </div>\n        </div>\n        <div style=\"margin-bottom: 12px;\">\n          <h3 style=\"margin: 0 0 8px 0; color: #a78bfa; font-size: 13px; text-transform: uppercase;\">UI</h3>\n          <div style=\"display: grid; gap: 4px;\">\n            ${this.helpRow('H', 'Toggle this help')}\n            ${this.helpRow('Space', 'Screenshot mode')}\n          </div>\n        </div>\n        <div style=\"margin-bottom: 12px;\">\n          <h3 style=\"margin: 0 0 8px 0; color: #a78bfa; font-size: 13px; text-transform: uppercase;\">Share</h3>\n          <div style=\"display: grid; gap: 4px;\">\n            ${this.helpRow('S', 'Copy bookmark URL')}\n          </div>\n        </div>\n      </div>\n      <div style=\"margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.1); color: #888; font-size: 12px; text-align: center;\">\n        Press <kbd style=\"background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px;\">H</kbd> to close\n      </div>\n    `;\n  }\n\n  private helpRow(key: string, description: string): string {\n    return `\n      <div style=\"display: flex; align-items: baseline; gap: 8px;\">\n        <kbd style=\"background: rgba(255,255,255,0.1); color: #f0f0f0; padding: 2px 8px; border-radius: 4px; font-family: ui-monospace, monospace; font-size: 12px; min-width: 60px; text-align: center;\">${key}</kbd>\n        <span style=\"color: #ccc;\">${description}</span>\n      </div>\n    `;\n  }\n\n  destroy(): void {\n    this.stop();\n    window.removeEventListener('resize', this.handleResize);\n    window.removeEventListener('hashchange', this.handleHashChange);\n    this.debugOverlay?.remove();\n    this.shareNotification?.remove();\n    this.helpOverlay?.remove();\n    this.inputHandler.destroy();\n    this.renderer.destroy();\n  }\n}\n","/**\n * Fractal Explorer - Main Entry Point\n *\n * \"This is where the magic begins. You're welcome.\"\n * - Skippy the Magnificent\n */\n\nimport { WebGPUFractalEngine } from './fractal/WebGPUFractalEngine';\nimport { WebGPURenderer } from './renderer/WebGPURenderer';\n\nconsole.log('Fractal Explorer - Initializing...');\n\nlet engine: WebGPUFractalEngine | null = null;\n\nasync function init(): Promise<void> {\n  const app = document.getElementById('app');\n  if (!app) {\n    console.error('Could not find #app element');\n    return;\n  }\n\n  // Check WebGPU support\n  if (!WebGPURenderer.isSupported()) {\n    app.innerHTML = `\n      <div style=\"color: white; text-align: center; padding: 40px; font-family: system-ui, sans-serif;\">\n        <h1>WebGPU Not Supported</h1>\n        <p>This application requires WebGPU, which is not available in your browser.</p>\n        <p style=\"margin-top: 20px; color: #888;\">\n          Please use a modern browser with WebGPU support:<br>\n          Chrome 113+, Edge 113+, or Firefox Nightly with WebGPU enabled.\n        </p>\n      </div>\n    `;\n    return;\n  }\n\n  // Create canvas element\n  const canvas = document.createElement('canvas');\n  canvas.id = 'fractal-canvas';\n  app.appendChild(canvas);\n\n  try {\n    engine = await WebGPUFractalEngine.create(canvas);\n    engine.start();\n\n    console.log('Fractal Explorer initialized successfully');\n    console.log('Controls:');\n    console.log('  - Drag to pan');\n    console.log('  - Scroll to zoom');\n    console.log('  - Double-click to zoom in');\n    console.log('  - Touch drag to pan (mobile)');\n    console.log('  - Pinch to zoom (mobile)');\n    console.log('  - + / - to adjust max iterations');\n    console.log('  - 0 to reset iterations to auto-scaling');\n    console.log('  - c / C to cycle color palettes (forward/backward)');\n    console.log('  - , / . to shift colors (fine)');\n    console.log('  - < / > to shift colors (coarse)');\n    console.log('  - b / B to adjust HDR brightness');\n    console.log('  - d to reset HDR brightness');\n    console.log('  - s to share/copy bookmark URL');\n    console.log('  - 1-9 to visit famous locations');\n    console.log('  - h to toggle help overlay');\n    console.log('  - Space to toggle screenshot mode');\n  } catch (error) {\n    console.error('Failed to initialize Fractal Explorer:', error);\n    app.innerHTML = `\n      <div style=\"color: white; text-align: center; padding: 20px; font-family: system-ui, sans-serif;\">\n        <h1>Initialization Error</h1>\n        <p>Failed to initialize the application.</p>\n        <pre style=\"text-align: left; margin-top: 20px; color: #ff6b6b;\">${error instanceof Error ? error.message : String(error)}</pre>\n      </div>\n    `;\n  }\n}\n\n// Initialize when DOM is ready\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', () => init());\n} else {\n  init();\n}\n\n// Cleanup on page unload\nwindow.addEventListener('beforeunload', () => {\n  if (engine) {\n    engine.destroy();\n  }\n});\n"],"names":["WebGPURenderer","canvas","__publicField","renderer","adapter","info","preferredFormat","e","width","height","dpr","renderCallback","loop","handleChange","newHdrSupport","callback","ViewState","centerX","centerY","zoom","deltaX","deltaY","screenWidth","screenHeight","fractalDeltaX","fractalDeltaY","screenX","screenY","factor","fractalX","fractalY","newFractalX","newFractalY","aspect","uvX","uvY","ZOOM_SENSITIVITY","scaleZoomFactor","InputHandler","viewState","onChange","_callback","enabled","clientX","clientY","rect","x","y","raw","zoomFactor","touches","dx","dy","distance","center","FractalType","FRACTAL_TYPE_NAMES","PARAM","encodeNumber","precision","decodeNumber","s","n","encodeBookmark","state","params","decodeBookmark","hash","type","z","p","o","jr","ji","i","getShareableUrl","url","updateUrlHash","readUrlBookmark","copyShareableUrl","textArea","FAMOUS_LOCATIONS","getLocationByKey","key","loc","PALETTES","PALETTE_COUNT","getPaletteParams","index","hdr","palette","getPalette","getPaletteName","shaderSource","MAX_ITERATIONS_BASE","MAX_ITERATIONS_BASE_JULIA","MAX_ITERATIONS_AUTO_CAP","MAX_ITERATIONS_LOG_SCALE","MAX_ITERATIONS_LOG_POWER","ITERATION_ADJUST_RATIO","maxIterationsForZoom","isJulia","L","base","UNIFORM_BUFFER_SIZE","WebGPUFractalEngine","engine","device","shaderModule","bindGroupLayout","pipelineLayout","direction","delta","parent","maxIter","zoomStr","iterSuffix","paletteName","fractalName","hdrStatus","juliaStatus","juliaCoords","colorOffsetStr","statusParts","uniformData","floatView","intView","paletteParams","commandEncoder","textureView","renderPass","currentIter","newIter","bookmark","location","success","description","init","app","error"],"mappings":"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"}