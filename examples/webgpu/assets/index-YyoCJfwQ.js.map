{"version":3,"file":"index-YyoCJfwQ.js","sources":["../../../src/renderer/WebGPURenderer.ts","../../../src/controls/ViewState.ts","../../../src/controls/InputHandler.ts","../../../src/types.ts","../../../src/bookmark/BookmarkManager.ts","../../../src/bookmark/famousLocations.ts","../../../src/renderer/Palettes.ts","../../../src/renderer/shaders/mandelbrot.wgsl?raw","../../../src/fractal/WebGPUFractalEngine.ts","../../../src/main.ts"],"sourcesContent":["/**\n * WebGPU Renderer - Manages WebGPU context and canvas with HDR support\n *\n * \"Finally, a graphics API worthy of my magnificence.\"\n * - Skippy the Magnificent\n */\n\nexport class WebGPURenderer {\n  public device!: GPUDevice;\n  public context!: GPUCanvasContext;\n  public readonly canvas: HTMLCanvasElement;\n  public format!: GPUTextureFormat;\n\n  private animationFrameId: number | null = null;\n  private renderCallback: (() => void) | null = null;\n\n  /** Whether HDR rendering is currently enabled and active. */\n  public hdrEnabled: boolean = false;\n  /** Whether the display currently reports HDR support. */\n  private _displaySupportsHDR: boolean = false;\n  /** Media query for dynamic range detection */\n  private hdrMediaQuery: MediaQueryList | null = null;\n  /** Callback for HDR status changes */\n  private onHdrChangeCallback: (() => void) | null = null;\n\n  private constructor(canvas: HTMLCanvasElement) {\n    this.canvas = canvas;\n    this._displaySupportsHDR = this.detectHDRDisplay();\n    this.setupHdrMediaQueryListener();\n  }\n\n  /**\n   * Whether the display currently supports HDR\n   */\n  get displaySupportsHDR(): boolean {\n    return this._displaySupportsHDR;\n  }\n\n  /**\n   * Create and initialize a WebGPU renderer.\n   * This is async because WebGPU initialization requires awaiting adapter/device.\n   */\n  static async create(canvas: HTMLCanvasElement): Promise<WebGPURenderer> {\n    const renderer = new WebGPURenderer(canvas);\n    await renderer.initialize();\n    return renderer;\n  }\n\n  /**\n   * Check if WebGPU is supported in this browser.\n   */\n  static isSupported(): boolean {\n    return 'gpu' in navigator;\n  }\n\n  private async initialize(): Promise<void> {\n    if (!navigator.gpu) {\n      throw new Error('WebGPU is not supported in this browser');\n    }\n\n    console.log('WebGPU HDR capability check:');\n    console.log('  - Display supports HDR:', this.displaySupportsHDR);\n    console.log('  - dynamic-range: high:', window.matchMedia?.('(dynamic-range: high)').matches);\n    console.log('  - color-gamut: p3:', window.matchMedia?.('(color-gamut: p3)').matches);\n\n    const adapter = await navigator.gpu.requestAdapter({\n      powerPreference: 'high-performance',\n    });\n\n    if (!adapter) {\n      throw new Error('Failed to get WebGPU adapter');\n    }\n\n    // Log adapter info (if available)\n    if ('info' in adapter) {\n      const info = (adapter as any).info;\n      console.log('  - Adapter:', info?.vendor, info?.architecture);\n    }\n\n    this.device = await adapter.requestDevice();\n\n    this.context = this.canvas.getContext('webgpu') as GPUCanvasContext;\n    if (!this.context) {\n      throw new Error('Failed to get WebGPU context');\n    }\n\n    // Configure for HDR if supported\n    this.configureContext();\n\n    console.log('WebGPU initialized successfully');\n    if (this.hdrEnabled) {\n      console.log('HDR mode enabled with rgba16float + extended tone mapping');\n    }\n  }\n\n  /**\n   * Configure the WebGPU context, optionally with HDR support.\n   */\n  private configureContext(): void {\n    // Determine format - use rgba16float for HDR, otherwise preferred format\n    const preferredFormat = navigator.gpu.getPreferredCanvasFormat();\n\n    if (this.displaySupportsHDR) {\n      // Try to configure with HDR\n      try {\n        this.format = 'rgba16float';\n        this.context.configure({\n          device: this.device,\n          format: this.format,\n          alphaMode: 'opaque',\n          toneMapping: { mode: 'extended' }, // This unlocks HDR range!\n        } as GPUCanvasConfiguration);\n        this.hdrEnabled = true;\n        console.log('  - Configured with rgba16float + extended tone mapping (HDR)');\n      } catch (e) {\n        console.log('  - HDR configuration failed, falling back to SDR:', e);\n        this.format = preferredFormat;\n        this.context.configure({\n          device: this.device,\n          format: this.format,\n          alphaMode: 'opaque',\n        });\n        this.hdrEnabled = false;\n      }\n    } else {\n      this.format = preferredFormat;\n      this.context.configure({\n        device: this.device,\n        format: this.format,\n        alphaMode: 'opaque',\n      });\n      this.hdrEnabled = false;\n      console.log('  - Configured with', this.format, '(SDR)');\n    }\n  }\n\n  /**\n   * Resize the canvas to match the given dimensions\n   */\n  resize(width: number, height: number): void {\n    const dpr = window.devicePixelRatio || 1;\n    this.canvas.width = width * dpr;\n    this.canvas.height = height * dpr;\n    this.canvas.style.width = `${width}px`;\n    this.canvas.style.height = `${height}px`;\n  }\n\n  /**\n   * Get the current render target texture\n   */\n  getCurrentTexture(): GPUTexture {\n    return this.context.getCurrentTexture();\n  }\n\n  /**\n   * Start the render loop\n   */\n  start(renderCallback: () => void): void {\n    if (this.animationFrameId !== null) {\n      return; // Already running\n    }\n\n    this.renderCallback = renderCallback;\n    const loop = () => {\n      if (this.renderCallback) {\n        this.renderCallback();\n      }\n      this.animationFrameId = requestAnimationFrame(loop);\n    };\n    this.animationFrameId = requestAnimationFrame(loop);\n  }\n\n  /**\n   * Stop the render loop\n   */\n  stop(): void {\n    if (this.animationFrameId !== null) {\n      cancelAnimationFrame(this.animationFrameId);\n      this.animationFrameId = null;\n    }\n    this.renderCallback = null;\n  }\n\n  /**\n   * Detect if the display supports HDR.\n   */\n  private detectHDRDisplay(): boolean {\n    if (window.matchMedia?.('(dynamic-range: high)').matches) {\n      return true;\n    }\n    // Note: color-gamut: p3 alone doesn't mean HDR, just wide gamut\n    // But we'll use it as a fallback hint\n    return false;\n  }\n\n  /**\n   * Set up listener for HDR display changes (e.g., user toggles HDR in display settings)\n   */\n  private setupHdrMediaQueryListener(): void {\n    if (!window.matchMedia) return;\n\n    this.hdrMediaQuery = window.matchMedia('(dynamic-range: high)');\n\n    const handleChange = () => {\n      const newHdrSupport = this.detectHDRDisplay();\n      if (newHdrSupport !== this._displaySupportsHDR) {\n        console.log(`HDR display support changed: ${this._displaySupportsHDR} -> ${newHdrSupport}`);\n        this._displaySupportsHDR = newHdrSupport;\n\n        // Reconfigure context if we have one\n        if (this.context && this.device) {\n          this.configureContext();\n        }\n\n        // Notify listener\n        this.onHdrChangeCallback?.();\n      }\n    };\n\n    // Use addEventListener for modern browsers\n    this.hdrMediaQuery.addEventListener?.('change', handleChange);\n  }\n\n  /**\n   * Set callback for when HDR status changes\n   */\n  setOnHdrChange(callback: () => void): void {\n    this.onHdrChangeCallback = callback;\n  }\n\n  /**\n   * Clean up resources\n   */\n  destroy(): void {\n    this.stop();\n    this.onHdrChangeCallback = null;\n    this.device?.destroy();\n  }\n}\n","/**\n * View State - Manages the current viewport (pan and zoom)\n *\n * \"Coordinate transformations. Because apparently you monkeys can't do math.\"\n * - Skippy the Magnificent\n */\n\nimport type { ViewState as IViewState } from '../types';\n\nexport class ViewState implements IViewState {\n  public centerX: number;\n  public centerY: number;\n  public zoom: number;\n\n  /**\n   * Create a new view state\n   * @param centerX Real component of center (-2.5 to 1.0 typical)\n   * @param centerY Imaginary component of center (-1.5 to 1.5 typical)\n   * @param zoom Zoom factor (1.0 = full set visible)\n   */\n  constructor(centerX: number = -0.5, centerY: number = 0.0, zoom: number = 0.4) {\n    this.centerX = centerX;\n    this.centerY = centerY;\n    this.zoom = zoom;\n  }\n\n  /**\n   * Pan the view by screen pixels\n   * @param deltaX Pixels to pan horizontally (positive = right)\n   * @param deltaY Pixels to pan vertically (positive = down)\n   * @param screenWidth Screen width in pixels\n   * @param screenHeight Screen height in pixels\n   */\n  pan(deltaX: number, deltaY: number, screenWidth: number, screenHeight: number): void {\n    // Convert screen pixel delta to fractal coordinate delta\n    const fractalDeltaX = -deltaX / (this.zoom * screenWidth);\n    const fractalDeltaY = deltaY / (this.zoom * screenHeight);\n    \n    this.centerX += fractalDeltaX;\n    this.centerY += fractalDeltaY;\n  }\n\n  /**\n   * Zoom centered on a specific screen point\n   * @param screenX Screen X coordinate (0 to screenWidth)\n   * @param screenY Screen Y coordinate (0 to screenHeight)\n   * @param factor Zoom factor (> 1 = zoom in, < 1 = zoom out)\n   * @param screenWidth Screen width in pixels\n   * @param screenHeight Screen height in pixels\n   */\n  zoomAt(\n    screenX: number,\n    screenY: number,\n    factor: number,\n    screenWidth: number,\n    screenHeight: number\n  ): void {\n    // Convert screen point to fractal coordinates before zoom\n    const fractalX = this.centerX + (screenX / screenWidth - 0.5) / this.zoom;\n    const fractalY = this.centerY - (screenY / screenHeight - 0.5) / this.zoom;\n    \n    // Apply zoom\n    this.zoom *= factor;\n    \n    // Clamp zoom to reasonable limits\n    this.zoom = Math.max(0.1, Math.min(this.zoom, 1e15));\n    \n    // Adjust center so the point under cursor stays fixed\n    const newFractalX = this.centerX + (screenX / screenWidth - 0.5) / this.zoom;\n    const newFractalY = this.centerY - (screenY / screenHeight - 0.5) / this.zoom;\n    \n    this.centerX += fractalX - newFractalX;\n    this.centerY += fractalY - newFractalY;\n  }\n\n  /**\n   * Convert screen coordinates to fractal coordinates\n   * @param screenX Screen X coordinate (0 to screenWidth)\n   * @param screenY Screen Y coordinate (0 to screenHeight)\n   * @param screenWidth Screen width in pixels\n   * @param screenHeight Screen height in pixels\n   */\n  toFractalCoords(screenX: number, screenY: number, screenWidth: number, screenHeight: number): [number, number] {\n    const aspect = screenWidth / screenHeight;\n    const uvX = (screenX / screenWidth - 0.5) * aspect;\n    const uvY = screenY / screenHeight - 0.5;\n    const fractalX = this.centerX + uvX / this.zoom;\n    const fractalY = this.centerY - uvY / this.zoom;\n    return [fractalX, fractalY];\n  }\n\n  /**\n   * Convert fractal coordinates to screen coordinates\n   * @param fractalX Fractal X coordinate\n   * @param fractalY Fractal Y coordinate\n   * @param screenWidth Screen width in pixels\n   * @param screenHeight Screen height in pixels\n   */\n  toScreenCoords(fractalX: number, fractalY: number, screenWidth: number, screenHeight: number): [number, number] {\n    const aspect = screenWidth / screenHeight;\n    const uvX = (fractalX - this.centerX) * this.zoom;\n    const uvY = (fractalY - this.centerY) * this.zoom;\n    const screenX = (uvX / aspect + 0.5) * screenWidth;\n    const screenY = (-uvY + 0.5) * screenHeight;\n    return [screenX, screenY];\n  }\n\n  /**\n   * Center on a screen point and then zoom in\n   * @param screenX Screen X coordinate (0 to screenWidth)\n   * @param screenY Screen Y coordinate (0 to screenHeight)\n   * @param factor Zoom factor (> 1 = zoom in, < 1 = zoom out)\n   * @param screenWidth Screen width in pixels\n   * @param screenHeight Screen height in pixels\n   */\n  zoomToPoint(\n    screenX: number,\n    screenY: number,\n    factor: number,\n    screenWidth: number,\n    screenHeight: number\n  ): void {\n    // Convert screen point to fractal coordinates and center on it\n    const [fractalX, fractalY] = this.toFractalCoords(screenX, screenY, screenWidth, screenHeight);\n    this.centerX = fractalX;\n    this.centerY = fractalY;\n\n    // Apply zoom\n    this.zoom *= factor;\n\n    // Clamp zoom to reasonable limits\n    this.zoom = Math.max(0.1, Math.min(this.zoom, 1e15));\n  }\n\n  /**\n   * Reset to initial view\n   */\n  reset(): void {\n    this.centerX = -0.5;\n    this.centerY = 0.0;\n    this.zoom = 0.4;\n  }\n}\n","/**\n * Input Handler - Translates browser events into view state changes\n *\n * \"Event handling. Because apparently you monkeys can't click things properly.\"\n * - Skippy the Magnificent\n */\n\nimport { ViewState } from './ViewState';\n\nexport type ViewStateChangeCallback = (viewState: ViewState) => void;\nexport type IterationAdjustCallback = (direction: 1 | -1) => void;\nexport type IterationResetCallback = () => void;\nexport type CosinePaletteCycleCallback = (direction: 1 | -1) => void;\nexport type GradientPaletteCycleCallback = (direction: 1 | -1) => void;\nexport type ColorOffsetCallback = (delta: number) => void;\nexport type ToggleCallback = () => void;\nexport type FractalCycleCallback = (direction: 1 | -1) => void;\nexport type JuliaPickCallback = (fractalX: number, fractalY: number) => void;\nexport type ShareCallback = () => void;\nexport type LocationCallback = (key: string) => void;\nexport type HelpToggleCallback = () => void;\nexport type ScreenshotModeCallback = () => void;\n\n/** Zoom sensitivity: 1 = full speed, 0.6 = 60% of current zoom deltas */\nconst ZOOM_SENSITIVITY = 0.6;\n\nfunction scaleZoomFactor(factor: number): number {\n  return 1 + (factor - 1) * ZOOM_SENSITIVITY;\n}\n\nexport class InputHandler {\n  private canvas: HTMLCanvasElement;\n  private viewState: ViewState;\n  private onChange: ViewStateChangeCallback;\n  private onIterationAdjust: IterationAdjustCallback | null = null;\n  private onIterationReset: IterationResetCallback | null = null;\n  private onCosinePaletteCycle: CosinePaletteCycleCallback | null = null;\n  private onGradientPaletteCycle: GradientPaletteCycleCallback | null = null;\n  private onColorOffset: ColorOffsetCallback | null = null;\n  private onColorOffsetReset: ToggleCallback | null = null;\n  private onToggleAA: ToggleCallback | null = null;\n  private onAdjustHdrBrightness: IterationAdjustCallback | null = null;\n  private onResetHdrBrightness: ToggleCallback | null = null;\n  private onFractalCycle: FractalCycleCallback | null = null;\n  private onToggleJuliaMode: ToggleCallback | null = null;\n  private onJuliaPick: JuliaPickCallback | null = null;\n  private onShare: ShareCallback | null = null;\n  private onLocationSelect: LocationCallback | null = null;\n  private onToggleHelp: HelpToggleCallback | null = null;\n  private onToggleScreenshotMode: ScreenshotModeCallback | null = null;\n\n  // Mouse/touch state\n  private isDragging = false;\n  private lastX = 0;\n  private lastY = 0;\n  private lastTouchDistance = 0;\n\n  // Julia picker mode state\n  private juliaPickerMode = false;\n\n  // Keyboard zoom state\n  private keyboardZoomDirection: 1 | -1 | null = null;\n  private keyboardZoomStartTime: number = 0;\n  private keyboardZoomAnimationId: number | null = null;\n\n  constructor(\n    canvas: HTMLCanvasElement,\n    viewState: ViewState,\n    onChange: ViewStateChangeCallback\n  ) {\n    this.canvas = canvas;\n    this.viewState = viewState;\n    this.onChange = onChange;\n\n    this.setupEventListeners();\n  }\n\n  /**\n   * Set callback for iteration adjustment (+/- keys)\n   */\n  setIterationAdjustCallback(callback: IterationAdjustCallback): void {\n    this.onIterationAdjust = callback;\n  }\n\n  /**\n   * Set callback for iteration reset (0 key)\n   */\n  setIterationResetCallback(callback: IterationResetCallback): void {\n    this.onIterationReset = callback;\n  }\n\n  /**\n   * Set callback for cosine palette cycling (c/C keys)\n   */\n  setCosinePaletteCycleCallback(callback: CosinePaletteCycleCallback): void {\n    this.onCosinePaletteCycle = callback;\n  }\n\n  /**\n   * Set callback for gradient palette cycling (g/G keys)\n   */\n  setGradientPaletteCycleCallback(callback: GradientPaletteCycleCallback): void {\n    this.onGradientPaletteCycle = callback;\n  }\n\n  /**\n   * Set callback for color offset adjustment ([/] keys)\n   */\n  setColorOffsetCallback(callback: ColorOffsetCallback): void {\n    this.onColorOffset = callback;\n  }\n\n  /**\n   * Set callback for color offset reset (r key)\n   */\n  setColorOffsetResetCallback(callback: ToggleCallback): void {\n    this.onColorOffsetReset = callback;\n  }\n\n  /**\n   * Set callback for AA toggle (a key)\n   */\n  setToggleAACallback(callback: ToggleCallback): void {\n    this.onToggleAA = callback;\n  }\n\n  /**\n   * Set callback for HDR toggle (no-op, HDR is auto-detected)\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  setToggleHDRCallback(_callback: ToggleCallback): void {\n    // HDR is now auto-detected based on display capabilities\n  }\n\n  /**\n   * Set callback for HDR brightness adjustment (b/B keys)\n   */\n  setAdjustHdrBrightnessCallback(callback: IterationAdjustCallback): void {\n    this.onAdjustHdrBrightness = callback;\n  }\n\n  /**\n   * Set callback for HDR brightness reset (Shift+R key)\n   */\n  setResetHdrBrightnessCallback(callback: ToggleCallback): void {\n    this.onResetHdrBrightness = callback;\n  }\n\n  /**\n   * Set callback for fractal type cycling (f/F keys)\n   */\n  setFractalCycleCallback(callback: FractalCycleCallback): void {\n    this.onFractalCycle = callback;\n  }\n\n  /**\n   * Set callback for Julia mode toggle (j key)\n   */\n  setToggleJuliaModeCallback(callback: ToggleCallback): void {\n    this.onToggleJuliaMode = callback;\n  }\n\n  /**\n   * Set callback for Julia constant selection (click in picker mode)\n   */\n  setJuliaPickCallback(callback: JuliaPickCallback): void {\n    this.onJuliaPick = callback;\n  }\n\n  /**\n   * Set callback for share/bookmark (s key)\n   */\n  setShareCallback(callback: ShareCallback): void {\n    this.onShare = callback;\n  }\n\n  /**\n   * Set callback for famous location selection (1-9 keys)\n   */\n  setLocationSelectCallback(callback: LocationCallback): void {\n    this.onLocationSelect = callback;\n  }\n\n  /**\n   * Set callback for help overlay toggle (h key)\n   */\n  setToggleHelpCallback(callback: HelpToggleCallback): void {\n    this.onToggleHelp = callback;\n  }\n\n  /**\n   * Set callback for screenshot mode toggle (space key)\n   */\n  setToggleScreenshotModeCallback(callback: ScreenshotModeCallback): void {\n    this.onToggleScreenshotMode = callback;\n  }\n\n  /**\n   * Enable or disable Julia picker mode\n   */\n  setJuliaPickerMode(enabled: boolean): void {\n    this.juliaPickerMode = enabled;\n    this.canvas.style.cursor = enabled ? 'crosshair' : 'grab';\n  }\n\n  /**\n   * Check if Julia picker mode is active\n   */\n  isJuliaPickerModeActive(): boolean {\n    return this.juliaPickerMode;\n  }\n\n  private setupEventListeners(): void {\n    // Mouse events\n    this.canvas.addEventListener('mousedown', this.handleMouseDown.bind(this));\n    this.canvas.addEventListener('mousemove', this.handleMouseMove.bind(this));\n    this.canvas.addEventListener('mouseup', this.handleMouseUp.bind(this));\n    this.canvas.addEventListener('mouseleave', this.handleMouseUp.bind(this));\n    this.canvas.addEventListener('wheel', this.handleWheel.bind(this), { passive: false });\n    this.canvas.addEventListener('dblclick', this.handleDoubleClick.bind(this));\n\n    // Touch events\n    this.canvas.addEventListener('touchstart', this.handleTouchStart.bind(this), { passive: false });\n    this.canvas.addEventListener('touchmove', this.handleTouchMove.bind(this), { passive: false });\n    this.canvas.addEventListener('touchend', this.handleTouchEnd.bind(this));\n    this.canvas.addEventListener('touchcancel', this.handleTouchEnd.bind(this));\n\n\n    // Keyboard events (on window for global capture)\n    window.addEventListener('keydown', this.handleKeyDown.bind(this));\n    window.addEventListener('keyup', this.handleKeyUp.bind(this));\n  }\n\n  private getCanvasRect(): DOMRect {\n    return this.canvas.getBoundingClientRect();\n  }\n\n  private getScreenCoords(clientX: number, clientY: number): [number, number] {\n    const rect = this.getCanvasRect();\n    return [clientX - rect.left, clientY - rect.top];\n  }\n\n  private getCanvasSize(): [number, number] {\n    // Use CSS dimensions, not pixel dimensions (which include devicePixelRatio)\n    const rect = this.getCanvasRect();\n    return [rect.width, rect.height];\n  }\n\n  private notifyChange(): void {\n    this.onChange(this.viewState);\n  }\n\n  // Mouse handlers\n  private handleMouseDown(e: MouseEvent): void {\n    if (e.button !== 0) return; // Only left button\n\n    const [x, y] = this.getScreenCoords(e.clientX, e.clientY);\n\n    // Julia picker mode: pick a point instead of panning\n    if (this.juliaPickerMode && this.onJuliaPick) {\n      const [width, height] = this.getCanvasSize();\n      const [fractalX, fractalY] = this.viewState.toFractalCoords(x, y, width, height);\n      this.onJuliaPick(fractalX, fractalY);\n      return;\n    }\n\n    this.isDragging = true;\n    this.lastX = x;\n    this.lastY = y;\n    this.canvas.style.cursor = 'grabbing';\n  }\n\n  private handleMouseMove(e: MouseEvent): void {\n    if (!this.isDragging) return;\n\n    const [x, y] = this.getScreenCoords(e.clientX, e.clientY);\n    const deltaX = x - this.lastX;\n    const deltaY = y - this.lastY;\n\n    const [width, height] = this.getCanvasSize();\n    this.viewState.pan(deltaX, deltaY, width, height);\n    this.notifyChange();\n\n    this.lastX = x;\n    this.lastY = y;\n  }\n\n  private handleMouseUp(): void {\n    if (this.isDragging) {\n      this.isDragging = false;\n      this.canvas.style.cursor = 'grab';\n    }\n  }\n\n  private handleWheel(e: WheelEvent): void {\n    e.preventDefault();\n\n    const [x, y] = this.getScreenCoords(e.clientX, e.clientY);\n    const raw = e.deltaY > 0 ? 0.9 : 1.1;\n    const zoomFactor = scaleZoomFactor(raw);\n\n    const [width, height] = this.getCanvasSize();\n    this.viewState.zoomAt(x, y, zoomFactor, width, height);\n    this.notifyChange();\n  }\n\n  private handleDoubleClick(e: MouseEvent): void {\n    const [x, y] = this.getScreenCoords(e.clientX, e.clientY);\n    const [width, height] = this.getCanvasSize();\n    this.viewState.zoomToPoint(x, y, scaleZoomFactor(2.0), width, height);\n    this.notifyChange();\n  }\n\n  // Touch handlers\n  private getTouchDistance(touches: TouchList): number {\n    if (touches.length < 2) return 0;\n    const dx = touches[0].clientX - touches[1].clientX;\n    const dy = touches[0].clientY - touches[1].clientY;\n    return Math.sqrt(dx * dx + dy * dy);\n  }\n\n  private getTouchCenter(touches: TouchList): [number, number] {\n    if (touches.length === 0) return [0, 0];\n    if (touches.length === 1) {\n      return this.getScreenCoords(touches[0].clientX, touches[0].clientY);\n    }\n    const x = (touches[0].clientX + touches[1].clientX) / 2;\n    const y = (touches[0].clientY + touches[1].clientY) / 2;\n    return this.getScreenCoords(x, y);\n  }\n\n  private handleTouchStart(e: TouchEvent): void {\n    if (e.touches.length === 1) {\n      // Single touch - start pan\n      this.isDragging = true;\n      const [x, y] = this.getScreenCoords(e.touches[0].clientX, e.touches[0].clientY);\n      this.lastX = x;\n      this.lastY = y;\n    } else if (e.touches.length === 2) {\n      // Two touches - prepare for pinch zoom\n      this.isDragging = false;\n      this.lastTouchDistance = this.getTouchDistance(e.touches);\n    }\n  }\n\n  private handleTouchMove(e: TouchEvent): void {\n    e.preventDefault();\n\n    if (e.touches.length === 1 && this.isDragging) {\n      // Single touch pan\n      const [x, y] = this.getScreenCoords(e.touches[0].clientX, e.touches[0].clientY);\n      const deltaX = x - this.lastX;\n      const deltaY = y - this.lastY;\n\n      const [width, height] = this.getCanvasSize();\n    this.viewState.pan(deltaX, deltaY, width, height);\n      this.notifyChange();\n\n      this.lastX = x;\n      this.lastY = y;\n    } else if (e.touches.length === 2) {\n      // Pinch zoom\n      const distance = this.getTouchDistance(e.touches);\n      const center = this.getTouchCenter(e.touches);\n\n      if (this.lastTouchDistance > 0) {\n        const raw = distance / this.lastTouchDistance;\n        const zoomFactor = scaleZoomFactor(raw);\n        const [width, height] = this.getCanvasSize();\n        this.viewState.zoomAt(center[0], center[1], zoomFactor, width, height);\n        this.notifyChange();\n      }\n\n      this.lastTouchDistance = distance;\n    }\n  }\n\n  private handleTouchEnd(): void {\n    this.isDragging = false;\n    this.lastTouchDistance = 0;\n  }\n\n  // Keyboard handlers\n  private handleKeyDown(e: KeyboardEvent): void {\n    // Ignore if typing in an input field\n    if (e.target instanceof HTMLInputElement || e.target instanceof HTMLTextAreaElement) {\n      return;\n    }\n\n    switch (e.key) {\n      case '+':\n      case '=': // Allow unshifted + key\n        e.preventDefault();\n        this.onIterationAdjust?.(1);\n        break;\n      case '-':\n      case '_': // Allow shifted - key\n        e.preventDefault();\n        this.onIterationAdjust?.(-1);\n        break;\n      case '0':\n        e.preventDefault();\n        this.onIterationReset?.();\n        break;\n      case 'c':\n        e.preventDefault();\n        this.onCosinePaletteCycle?.(1);\n        break;\n      case 'C':\n        e.preventDefault();\n        this.onCosinePaletteCycle?.(-1);\n        break;\n      case 'g':\n        e.preventDefault();\n        this.onGradientPaletteCycle?.(1);\n        break;\n      case 'G':\n        e.preventDefault();\n        this.onGradientPaletteCycle?.(-1);\n        break;\n      case '[':\n      case ',':\n        e.preventDefault();\n        this.onColorOffset?.(-0.05);\n        break;\n      case ']':\n      case '.':\n        e.preventDefault();\n        this.onColorOffset?.(0.05);\n        break;\n      case '{':\n      case '<':\n        e.preventDefault();\n        this.onColorOffset?.(-0.15);\n        break;\n      case '}':\n      case '>':\n        e.preventDefault();\n        this.onColorOffset?.(0.15);\n        break;\n      case 'r':\n      case 'R':\n        e.preventDefault();\n        this.onColorOffsetReset?.();\n        break;\n      case 'a':\n      case 'A':\n        e.preventDefault();\n        this.onToggleAA?.();\n        break;\n      case 'b':\n        // b: extend bright region (make more of image bright)\n        e.preventDefault();\n        this.onAdjustHdrBrightness?.(1);\n        break;\n      case 'B':\n        // Shift+B: contract bright region (make less of image bright)\n        e.preventDefault();\n        this.onAdjustHdrBrightness?.(-1);\n        break;\n      case 'd':\n        // d: reset HDR brightness bias\n        e.preventDefault();\n        this.onResetHdrBrightness?.();\n        break;\n      case 'f':\n        e.preventDefault();\n        this.onFractalCycle?.(1);\n        break;\n      case 'F':\n        e.preventDefault();\n        this.onFractalCycle?.(-1);\n        break;\n      case 'j':\n      case 'J':\n        e.preventDefault();\n        this.onToggleJuliaMode?.();\n        break;\n      case 's':\n      case 'S':\n        e.preventDefault();\n        this.onShare?.();\n        break;\n      case '1':\n      case '2':\n      case '3':\n      case '4':\n      case '5':\n      case '6':\n      case '7':\n      case '8':\n      case '9':\n        e.preventDefault();\n        this.onLocationSelect?.(e.key);\n        break;\n      case 'h':\n      case 'H':\n        e.preventDefault();\n        this.onToggleHelp?.();\n        break;\n      case ' ':\n        e.preventDefault();\n        this.onToggleScreenshotMode?.();\n        break;\n      case 'z':\n        e.preventDefault();\n        if (!e.repeat) {\n          this.startKeyboardZoom(1); // Zoom in\n        }\n        break;\n      case 'Z':\n        e.preventDefault();\n        if (!e.repeat) {\n          this.startKeyboardZoom(-1); // Zoom out\n        }\n        break;\n    }\n  }\n\n  // Keyboard zoom handlers\n  private handleKeyUp(e: KeyboardEvent): void {\n    // Stop keyboard zoom when z or Z is released\n    if (e.key === 'z' || e.key === 'Z') {\n      this.stopKeyboardZoom();\n    }\n  }\n\n  /**\n   * Start continuous keyboard zoom\n   * @param direction 1 for zoom in, -1 for zoom out\n   */\n  private startKeyboardZoom(direction: 1 | -1): void {\n    // If already zooming in a different direction, stop first\n    if (this.keyboardZoomAnimationId !== null) {\n      this.stopKeyboardZoom();\n    }\n\n    this.keyboardZoomDirection = direction;\n    this.keyboardZoomStartTime = performance.now();\n    this.keyboardZoomAnimationId = requestAnimationFrame(this.keyboardZoomLoop.bind(this));\n  }\n\n  /**\n   * Stop continuous keyboard zoom\n   */\n  private stopKeyboardZoom(): void {\n    if (this.keyboardZoomAnimationId !== null) {\n      cancelAnimationFrame(this.keyboardZoomAnimationId);\n      this.keyboardZoomAnimationId = null;\n    }\n    this.keyboardZoomDirection = null;\n  }\n\n  /**\n   * Animation loop for continuous keyboard zoom\n   * Zoom rate is proportional to elapsed time, allowing fine control with quick taps\n   */\n  private keyboardZoomLoop(currentTime: number): void {\n    if (this.keyboardZoomDirection === null) return;\n\n    const elapsed = currentTime - this.keyboardZoomStartTime;\n    this.keyboardZoomStartTime = currentTime;\n\n    // Zoom rate: ~2x per second when holding key\n    // This means quick taps (< 50ms) result in very small zoom changes\n    const zoomSpeed = 0.7; // ln(2) ≈ 0.693, so ~2x/second\n    const zoomExponent = this.keyboardZoomDirection * zoomSpeed * (elapsed / 1000);\n    const zoomFactor = Math.exp(zoomExponent);\n\n    // Apply zoom centered on screen center\n    const [width, height] = this.getCanvasSize();\n    this.viewState.zoomAt(width / 2, height / 2, zoomFactor, width, height);\n    this.notifyChange();\n\n    // Continue animation\n    this.keyboardZoomAnimationId = requestAnimationFrame(this.keyboardZoomLoop.bind(this));\n  }\n\n  /**\n   * Clean up event listeners\n   */\n  destroy(): void {\n    // Event listeners will be cleaned up when canvas is removed\n    // But we could explicitly remove them if needed\n  }\n}\n","/**\n * Type Definitions for Fractal Explorer\n *\n * \"Type safety. Because apparently you monkeys can't be trusted.\"\n * - Skippy the Magnificent\n */\n\n/**\n * Available fractal types.\n * Mandelbrot: z = z² + c\n * Burning Ship: z = (|Re(z)| + i|Im(z)|)² + c\n */\nexport enum FractalType {\n  Mandelbrot = 0,\n  MandelbrotJulia = 1,\n  BurningShip = 2,\n  BurningShipJulia = 3,\n  Tricorn = 4,\n  TricornJulia = 5,\n  Celtic = 6,\n  CelticJulia = 7,\n  Buffalo = 8,\n  BuffaloJulia = 9,\n  Phoenix = 10,\n  PhoenixJulia = 11,\n  Multibrot3 = 12,\n  Multibrot3Julia = 13,\n  Multibrot4 = 14,\n  Multibrot4Julia = 15,\n  Funky = 16,\n  FunkyJulia = 17,\n  Perpendicular = 18,\n  PerpendicularJulia = 19,\n}\n\nexport const FRACTAL_TYPE_NAMES: Record<FractalType, string> = {\n  [FractalType.Mandelbrot]: 'Mandelbrot',\n  [FractalType.MandelbrotJulia]: 'Mandelbrot Julia',\n  [FractalType.BurningShip]: 'Burning Ship',\n  [FractalType.BurningShipJulia]: 'Burning Ship Julia',\n  [FractalType.Tricorn]: 'Tricorn',\n  [FractalType.TricornJulia]: 'Tricorn Julia',\n  [FractalType.Celtic]: 'Celtic',\n  [FractalType.CelticJulia]: 'Celtic Julia',\n  [FractalType.Buffalo]: 'Buffalo',\n  [FractalType.BuffaloJulia]: 'Buffalo Julia',\n  [FractalType.Phoenix]: 'Phoenix',\n  [FractalType.PhoenixJulia]: 'Phoenix Julia',\n  [FractalType.Multibrot3]: 'Multibrot (z³)',\n  [FractalType.Multibrot3Julia]: 'Multibrot³ Julia',\n  [FractalType.Multibrot4]: 'Multibrot (z⁴)',\n  [FractalType.Multibrot4Julia]: 'Multibrot⁴ Julia',\n  [FractalType.Funky]: 'Funky',\n  [FractalType.FunkyJulia]: 'Funky Julia',\n  [FractalType.Perpendicular]: 'Perpendicular',\n  [FractalType.PerpendicularJulia]: 'Perpendicular Julia',\n};\n\n/** Number of base (non-Julia) fractal types */\nexport const BASE_FRACTAL_COUNT = 10;\n\n/**\n * Check if a fractal type is a Julia variant.\n * Julia types are odd numbers (base type + 1).\n */\nexport function isJuliaType(type: FractalType): boolean {\n  return (type & 1) === 1;\n}\n\n/**\n * Get the base (non-Julia) fractal type.\n * Simply clears the lowest bit.\n */\nexport function getBaseFractalType(type: FractalType): FractalType {\n  return (type & ~1) as FractalType;\n}\n\n/**\n * Get the Julia variant of a fractal type.\n * Simply sets the lowest bit.\n */\nexport function getJuliaVariant(type: FractalType): FractalType {\n  return (type | 1) as FractalType;\n}\n\nexport type UniformValue =\n  | number\n  | [number, number]\n  | [number, number, number]\n  | [number, number, number, number];\n\nexport interface UniformMap {\n  [name: string]: UniformValue;\n}\n\nexport interface ViewState {\n  centerX: number; // Real component of center (-2.5 to 1.0 typical)\n  centerY: number; // Imaginary component of center (-1.5 to 1.5 typical)\n  zoom: number; // Zoom factor (1.0 = full set visible)\n}\n","/**\n * Bookmark Manager - URL-based state sharing\n *\n * \"Sharing fractals with the masses. How quaint.\"\n * - Skippy the Magnificent\n */\n\nimport { FractalType, isJuliaType } from '../types';\n\n/**\n * Complete fractal state that can be bookmarked\n */\nexport interface BookmarkState {\n  fractalType: FractalType;\n  centerX: number;\n  centerY: number;\n  zoom: number;\n  /** @deprecated Use paletteType + cosinePaletteIndex/gradientPaletteIndex instead */\n  paletteIndex?: number;\n  paletteType: 'cosine' | 'gradient';\n  cosinePaletteIndex: number;\n  gradientPaletteIndex: number;\n  colorOffset: number;\n  juliaC: [number, number];\n  maxIterationsOverride: number | null;\n  aaEnabled: boolean;\n}\n\n/**\n * URL parameter names (kept short for compact URLs)\n * t = type, x = centerX, y = centerY, z = zoom\n * p = palette, o = color offset\n * jr = julia real, ji = julia imaginary\n * i = iterations, aa = antialiasing\n */\nconst PARAM = {\n  TYPE: 't',\n  CENTER_X: 'x',\n  CENTER_Y: 'y',\n  ZOOM: 'z',\n  PALETTE: 'p', // Legacy: single palette index\n  PALETTE_TYPE: 'pt', // 'c' = cosine, 'g' = gradient\n  COSINE_PALETTE: 'cp',\n  GRADIENT_PALETTE: 'gp',\n  COLOR_OFFSET: 'o',\n  JULIA_REAL: 'jr',\n  JULIA_IMAG: 'ji',\n  ITERATIONS: 'i',\n  AA: 'aa',\n} as const;\n\n/**\n * Encode a number with reasonable precision for URLs.\n * Uses exponential notation for very large/small numbers.\n */\nfunction encodeNumber(n: number, precision: number = 15): string {\n  if (n === 0) return '0';\n  if (Math.abs(n) < 1e-10 || Math.abs(n) > 1e10) {\n    return n.toExponential(precision);\n  }\n  // Trim trailing zeros\n  return parseFloat(n.toPrecision(precision)).toString();\n}\n\n/**\n * Decode a number from URL string\n */\nfunction decodeNumber(s: string | null): number | null {\n  if (s === null || s === '') return null;\n  const n = parseFloat(s);\n  return isNaN(n) ? null : n;\n}\n\n/**\n * Encode fractal state into URL hash parameters\n */\nexport function encodeBookmark(state: BookmarkState): string {\n  const params = new URLSearchParams();\n\n  params.set(PARAM.TYPE, state.fractalType.toString());\n  params.set(PARAM.CENTER_X, encodeNumber(state.centerX));\n  params.set(PARAM.CENTER_Y, encodeNumber(state.centerY));\n  params.set(PARAM.ZOOM, encodeNumber(state.zoom));\n  params.set(PARAM.PALETTE_TYPE, state.paletteType === 'cosine' ? 'c' : 'g');\n  params.set(PARAM.COSINE_PALETTE, state.cosinePaletteIndex.toString());\n  params.set(PARAM.GRADIENT_PALETTE, state.gradientPaletteIndex.toString());\n\n  // Only include optional params if they have non-default values\n  if (Math.abs(state.colorOffset) > 0.001) {\n    params.set(PARAM.COLOR_OFFSET, encodeNumber(state.colorOffset, 4));\n  }\n\n  // Include Julia constant for Julia-type fractals (odd types = base + 1)\n  if (isJuliaType(state.fractalType)) {\n    params.set(PARAM.JULIA_REAL, encodeNumber(state.juliaC[0]));\n    params.set(PARAM.JULIA_IMAG, encodeNumber(state.juliaC[1]));\n  }\n\n  if (state.maxIterationsOverride !== null) {\n    params.set(PARAM.ITERATIONS, state.maxIterationsOverride.toString());\n  }\n\n  if (state.aaEnabled) {\n    params.set(PARAM.AA, '1');\n  }\n\n  return params.toString();\n}\n\n/**\n * Decode bookmark state from URL hash parameters.\n * Returns partial state - only includes values that were present in the URL.\n */\nexport function decodeBookmark(hash: string): Partial<BookmarkState> {\n  const params = new URLSearchParams(hash.replace(/^#/, ''));\n  const state: Partial<BookmarkState> = {};\n\n  const type = decodeNumber(params.get(PARAM.TYPE));\n  if (type !== null && type >= 0 && type <= 19) {\n    state.fractalType = type as FractalType;\n  }\n\n  const x = decodeNumber(params.get(PARAM.CENTER_X));\n  if (x !== null) state.centerX = x;\n\n  const y = decodeNumber(params.get(PARAM.CENTER_Y));\n  if (y !== null) state.centerY = y;\n\n  const z = decodeNumber(params.get(PARAM.ZOOM));\n  if (z !== null && z > 0) state.zoom = z;\n\n  // New palette parameters\n  const pt = params.get(PARAM.PALETTE_TYPE);\n  if (pt === 'c' || pt === 'g') {\n    state.paletteType = pt === 'c' ? 'cosine' : 'gradient';\n  }\n\n  const cp = decodeNumber(params.get(PARAM.COSINE_PALETTE));\n  if (cp !== null && cp >= 0) state.cosinePaletteIndex = Math.floor(cp);\n\n  const gp = decodeNumber(params.get(PARAM.GRADIENT_PALETTE));\n  if (gp !== null && gp >= 0) state.gradientPaletteIndex = Math.floor(gp);\n\n  // Legacy: single paletteIndex (for backward compatibility)\n  const p = decodeNumber(params.get(PARAM.PALETTE));\n  if (p !== null && p >= 0 && p <= 11) state.paletteIndex = Math.floor(p);\n\n  const o = decodeNumber(params.get(PARAM.COLOR_OFFSET));\n  if (o !== null) state.colorOffset = o;\n\n  const jr = decodeNumber(params.get(PARAM.JULIA_REAL));\n  const ji = decodeNumber(params.get(PARAM.JULIA_IMAG));\n  if (jr !== null && ji !== null) {\n    state.juliaC = [jr, ji];\n  }\n\n  const i = decodeNumber(params.get(PARAM.ITERATIONS));\n  if (i !== null && i > 0) state.maxIterationsOverride = Math.floor(i);\n\n  if (params.get(PARAM.AA) === '1') {\n    state.aaEnabled = true;\n  }\n\n  return state;\n}\n\n/**\n * Get the full shareable URL for the current state\n */\nexport function getShareableUrl(state: BookmarkState): string {\n  const hash = encodeBookmark(state);\n  const url = new URL(window.location.href);\n  url.hash = hash;\n  return url.toString();\n}\n\n/**\n * Update the browser URL hash without triggering navigation\n */\nexport function updateUrlHash(state: BookmarkState): void {\n  const hash = encodeBookmark(state);\n  // Use replaceState to avoid cluttering browser history\n  window.history.replaceState(null, '', '#' + hash);\n}\n\n/**\n * Read bookmark state from current URL\n */\nexport function readUrlBookmark(): Partial<BookmarkState> {\n  return decodeBookmark(window.location.hash);\n}\n\n/**\n * Copy the shareable URL to clipboard\n * Returns true if successful\n */\nexport async function copyShareableUrl(state: BookmarkState): Promise<boolean> {\n  const url = getShareableUrl(state);\n  try {\n    await navigator.clipboard.writeText(url);\n    return true;\n  } catch {\n    // Fallback for older browsers\n    const textArea = document.createElement('textarea');\n    textArea.value = url;\n    textArea.style.position = 'fixed';\n    textArea.style.left = '-9999px';\n    document.body.appendChild(textArea);\n    textArea.select();\n    try {\n      document.execCommand('copy');\n      return true;\n    } catch {\n      return false;\n    } finally {\n      document.body.removeChild(textArea);\n    }\n  }\n}\n","/**\n * Famous Fractal Locations - Curated spots of mathematical beauty\n *\n * \"The greatest hits of chaos theory, now organized by fractal type. You're welcome.\"\n * - Skippy the Magnificent\n *\n * Locations are organized by fractal family (base type).\n * Each family shares locations between its base and Julia variants.\n * Navigate using number keys 1-9 (context-sensitive to current fractal).\n */\n\nimport { FractalType, getBaseFractalType } from '../types';\nimport { BookmarkState } from './BookmarkManager';\n\nexport interface FamousLocation {\n  name: string;\n  description: string;\n  key: string; // Keyboard shortcut (1-9)\n  state: BookmarkState;\n}\n\n/**\n * Default bookmark state template - reduces repetition\n */\nfunction createLocation(\n  name: string,\n  description: string,\n  key: string,\n  fractalType: FractalType,\n  centerX: number,\n  centerY: number,\n  zoom: number,\n  options: Partial<{\n    paletteType: 'cosine' | 'gradient';\n    cosinePaletteIndex: number;\n    gradientPaletteIndex: number;\n    colorOffset: number;\n    juliaC: [number, number];\n    maxIterationsOverride: number | null;\n  }> = {}\n): FamousLocation {\n  return {\n    name,\n    description,\n    key,\n    state: {\n      fractalType,\n      centerX,\n      centerY,\n      zoom,\n      paletteType: options.paletteType ?? 'cosine',\n      cosinePaletteIndex: options.cosinePaletteIndex ?? 1,\n      gradientPaletteIndex: options.gradientPaletteIndex ?? 0,\n      colorOffset: options.colorOffset ?? 0,\n      juliaC: options.juliaC ?? [-0.7, 0.27015],\n      maxIterationsOverride: options.maxIterationsOverride ?? null,\n      aaEnabled: false,\n    },\n  };\n}\n\n// ============================================================================\n// MANDELBROT & MANDELBROT JULIA\n// ============================================================================\nconst MANDELBROT_LOCATIONS: FamousLocation[] = [\n  createLocation(\n    'Mandelbrot',\n    'The famous Mandelbrot set',\n    '1',\n    FractalType.Mandelbrot,\n      -0.5, 0, 0.4\n  ),\n  createLocation(\n    'Seahorse Valley',\n    'The iconic seahorse-shaped spirals',\n    '2',\n    FractalType.Mandelbrot,\n    -0.7581249305506096, 0.11244273987387937, 36.41989684959737,\n    { cosinePaletteIndex: 5, colorOffset: 0.05 }\n  ),\n  createLocation(\n    'Elephant Valley',\n    'Elephant trunk-like spirals on the positive real side',\n    '3',\n    FractalType.Mandelbrot,\n    0.2746341335933571, 0.0066936145282295205, 212.15493874953236,\n    { cosinePaletteIndex: 3, colorOffset: -0.1 }\n  ),\n  createLocation(\n    'Double Spiral Valley',\n    'Beautiful double spirals deep in the set',\n    '4',\n    FractalType.Mandelbrot,\n    -0.743733589978665, 0.130905227502858, 350,\n    { cosinePaletteIndex: 5, colorOffset: 0.15000000000000002 }\n  ),\n  createLocation(\n    'Spiral Galaxy',\n    'Galactic spiral arms emerging from chaos',\n    '5',\n    FractalType.Mandelbrot,\n    -0.7615484049386866, -0.08478444765887823, 1506.4927460380957,\n    { cosinePaletteIndex: 4, colorOffset: 0.04999999999999999 }\n  ),\n  createLocation(\n    'Douady Rabbit',\n    'The famous rabbit-eared Julia set',\n    '6',\n    FractalType.MandelbrotJulia,\n    0, 0, 0.6,\n    { cosinePaletteIndex: 4, colorOffset: 0.2, juliaC: [-0.123, 0.745] }\n  ),\n  createLocation(\n    'Dragon Julia',\n    'Fierce dragon-like Julia set',\n    '7',\n    FractalType.MandelbrotJulia,\n    0, 0, 0.45,\n    { cosinePaletteIndex: 3, colorOffset: -0.49999999999999994, juliaC: [-0.8, 0.156] }\n  ),\n  createLocation(\n    'Spiral Julia',\n    'Delicate spiral arms from the main cardioid edge',\n    '8',\n    FractalType.MandelbrotJulia,\n    0, 0, 0.5,\n    { cosinePaletteIndex: 8, colorOffset: 0.65, juliaC: [-0.75, 0.11] }\n  ),\n  createLocation(\n    'Dendrite Julia',\n    'Tree-like branching structure on the real axis',\n    '9',\n    FractalType.MandelbrotJulia,\n    0, 0, 0.41791083585808675,\n    { cosinePaletteIndex: 5, colorOffset: 0.1, juliaC: [0.285, 0.01] }\n  ),\n];\n\n// ============================================================================\n// BURNING SHIP & BURNING SHIP JULIA\n// ============================================================================\nconst BURNING_SHIP_LOCATIONS: FamousLocation[] = [\n  createLocation(\n    'Main Ship',\n    'The iconic burning ship silhouette',\n    '1',\n    FractalType.BurningShip,\n    -0.6819541375872399, 0.5906040268456356, 0.4,\n    { cosinePaletteIndex: 4, colorOffset: 0.3 }\n  ),\n  createLocation(\n      'The Armada',\n      'Mini ships along the antenna',\n      '2',\n      FractalType.BurningShip,\n      -1.80173025652805, 0.0153452534367207, 9,\n      { cosinePaletteIndex: 4, colorOffset: 0.2 }\n  ),\n  createLocation(\n    'Bow Detail',\n    'Intricate patterns at the ship\\'s bow',\n    '3',\n    FractalType.BurningShip,\n    -1.7500929615866607, 0.0368035491770765, 10,\n    { cosinePaletteIndex: 10, colorOffset: 0.1 }\n  ),\n  createLocation(\n      'Bacteria Worm',\n      'Worm-like structures with mosaic patterns',\n      '4',\n      FractalType.BurningShipJulia,\n      0, 0, 0.3,\n      { cosinePaletteIndex: 10, colorOffset: -0.5499999999999998, juliaC: [0.5179709888623353, 0.8057669844188748] }\n  ),\n  createLocation(\n    'Wispy Coils',\n    'Wispy coils near the bulbous extrusion from the ship',\n    '5',\n    FractalType.BurningShipJulia,\n    0, 0, 0.4,\n    { cosinePaletteIndex: 4, colorOffset: 0.35, juliaC: [0.2525994076160102, 0.0006358222328731386] }\n  ),\n  createLocation(\n    'Space Brain',\n    'Brain-like structures from the bottom of the ship',\n    '6',\n    FractalType.BurningShipJulia,\n    0, 0, 0.7,\n    { cosinePaletteIndex: 5, colorOffset: 0.3, juliaC: [-1.059944784917394, -0.033218825489255054] }\n  ),\n  createLocation(\n    'Spiral Patterns',\n    'Spiral patterns near the bulbous extrusion',\n    '7',\n    FractalType.BurningShipJulia,\n    0, 0, 0.41,\n    { cosinePaletteIndex: 11, colorOffset: 0.55, juliaC: [0.28292507376881926, -0.007597008191683113] }\n  ),\n  createLocation(\n      'Detailed Patterns',\n      'Beautiful detailed patterns near the bottom of the ship',\n      '8',\n      FractalType.BurningShipJulia,\n      0, 0, 0.5,\n      { cosinePaletteIndex: 2, colorOffset: 0.6, juliaC: [-0.3967192382583807, -0.09102348993288789] }\n  ),\n];\n\n// ============================================================================\n// TRICORN (MANDELBAR)\n// ============================================================================\nconst TRICORN_LOCATIONS: FamousLocation[] = [\n  createLocation(\n    'Tricorn',\n    'The main tricorn shape with its distinctive three-cornered symmetry',\n    '1',\n    FractalType.Tricorn,\n    -0.1343398614022916, -0.07051105375213641, 0.24,\n    { cosinePaletteIndex: 11, colorOffset: -0.45 }\n  ),\n  createLocation(\n    'Skewed Mandelbrot',\n    'Skewed Mandelbrot from one of the main bulbs',\n    '2',\n    FractalType.Tricorn,\n    -1.0683098234816064, 0.13055543771605108, 722.5553792774821,\n    { cosinePaletteIndex: 5, colorOffset: 1.1 }\n  ),\n  createLocation(\n    'Lightning Bolts',\n    'Lightning bolt-like patterns near the main cardioid edge',\n    '3',\n    FractalType.TricornJulia,\n    0, 0, 0.5,\n    { cosinePaletteIndex: 5, colorOffset: 1.2, juliaC: [-0.7092474160797806, -0.113024316756254] }\n  ),\n  createLocation(\n      'Water Lily Leaf',\n      'Leaf-like structures from the center of the edge of the main cardioid',\n      '4',\n      FractalType.TricornJulia,\n      0, 0, 0.43,\n      { colorOffset: -0.7000000000000003, juliaC: [-0.1254330794660274, 0.2407433439223678] }\n  ),\n  createLocation(\n    'Lightning Brain',\n    'Brain-like structures',\n    '5',\n    FractalType.TricornJulia,\n    0, 0, 3.15,\n    { cosinePaletteIndex: 5, juliaC: [0.8748878776979363, -1.515483485507111] }\n  ),\n  createLocation(\n    'Spiral Mosaic',\n    'Mosaic patterns from the base of one of the main bulbs',\n    '6',\n    FractalType.TricornJulia,\n    0, 0, 0.5,\n    { cosinePaletteIndex: 11, colorOffset: 1.55, juliaC: [-0.5647012802389192, -0.06508603367125808] }\n  ),\n];\n\n// ============================================================================\n// CELTIC\n// ============================================================================\nconst CELTIC_LOCATIONS: FamousLocation[] = [\n  createLocation(\n    'Celtic Knot',\n    'The main Celtic fractal shape',\n    '1',\n    FractalType.Celtic,\n    -0.5, 0, 0.25,\n    { cosinePaletteIndex: 10, colorOffset: 0.05 }\n  ),\n  createLocation(\n    'Celtic Detail',\n    'Intricate knotwork patterns',\n    '2',\n    FractalType.Celtic,\n    -0.7803221774980102, 0.1635662989215261, 119.01480682794772,\n    { cosinePaletteIndex: 10, colorOffset: 0.25, maxIterationsOverride: 10000 }\n  ),\n  createLocation(\n      'Leafy Spirals',\n      'Symmetric shapes from the tip of the celtic shape',\n      '3',\n      FractalType.CelticJulia,\n      0, 0, 0.55,\n      { cosinePaletteIndex: 7, colorOffset: 0.1, juliaC: [0.25345198072532704, 0.0001580704105713714] }\n  ),\n  createLocation(\n    'Tendrils',\n    'Tendrils emerging from fog',\n    '4',\n    FractalType.CelticJulia,\n    -0.1649932591722856, -0.033582161161888655, 0.28,\n    { cosinePaletteIndex: 5, juliaC: [-0.4530201342281876, -0.8993288590604025] }\n  ),\n];\n\n// ============================================================================\n// BUFFALO\n// ============================================================================\nconst BUFFALO_LOCATIONS: FamousLocation[] = [\n  createLocation(\n    'Buffalo Overview',\n    'The distinctive Buffalo fractal shape',\n    '1',\n    FractalType.Buffalo,\n    -0.5, 0, 0.4,\n    { cosinePaletteIndex: 3, colorOffset: 0 }\n  ),\n  createLocation(\n    'Buffalo Horns',\n    'Curved horn-like structures',\n    '2',\n    FractalType.Buffalo,\n    -1.0, 0.5, 3,\n    { cosinePaletteIndex: 1, colorOffset: 0.2 }\n  ),\n  createLocation(\n    'Buffalo Julia',\n    'A Julia set from the Buffalo fractal',\n    '3',\n    FractalType.BuffaloJulia,\n    0, 0, 0.5,\n    { cosinePaletteIndex: 4, colorOffset: 0, juliaC: [-0.5, 0.5] }\n  ),\n];\n\n// ============================================================================\n// PHOENIX\n// ============================================================================\nconst PHOENIX_LOCATIONS: FamousLocation[] = [\n  createLocation(\n    'Phoenix Overview',\n    'The Phoenix parameter space',\n    '1',\n    FractalType.Phoenix,\n    0, 0, 0.4,\n    { cosinePaletteIndex: 1, colorOffset: 0 }\n  ),\n  createLocation(\n    'Classic Phoenix Julia',\n    'The iconic feathery Phoenix fractal',\n    '2',\n    FractalType.PhoenixJulia,\n    0, 0, 0.5,\n    { cosinePaletteIndex: 1, colorOffset: 0.2, juliaC: [0.5667, -0.5] }\n  ),\n  createLocation(\n    'Phoenix Feathers',\n    'Detailed feather-like structures',\n    '3',\n    FractalType.PhoenixJulia,\n    0.2, 0.3, 2,\n    { cosinePaletteIndex: 3, colorOffset: 0.1, juliaC: [0.5667, -0.5] }\n  ),\n];\n\n// ============================================================================\n// MULTIBROT3 (z³ + c)\n// ============================================================================\nconst MULTIBROT3_LOCATIONS: FamousLocation[] = [\n  createLocation(\n    'Multibrot³ Overview',\n    'The three-fold symmetric z³ Multibrot',\n    '1',\n    FractalType.Multibrot3,\n    0, 0, 0.4,\n    { cosinePaletteIndex: 4, colorOffset: 0 }\n  ),\n  createLocation(\n    'Triple Spiral',\n    'Three-way symmetry in the boundary',\n    '2',\n    FractalType.Multibrot3,\n    0.5, 0.3, 5,\n    { cosinePaletteIndex: 0, colorOffset: 0.1 }\n  ),\n  createLocation(\n    'Multibrot³ Julia',\n    'A Julia set with three-fold symmetry',\n    '3',\n    FractalType.Multibrot3Julia,\n    0, 0, 0.5,\n    { cosinePaletteIndex: 2, colorOffset: 0, juliaC: [0.4, 0.2] }\n  ),\n];\n\n// ============================================================================\n// MULTIBROT4 (z⁴ + c)\n// ============================================================================\nconst MULTIBROT4_LOCATIONS: FamousLocation[] = [\n  createLocation(\n    'Multibrot⁴ Overview',\n    'The four-fold symmetric z⁴ Multibrot',\n    '1',\n    FractalType.Multibrot4,\n    0, 0, 0.4,\n    { cosinePaletteIndex: 5, colorOffset: 0 }\n  ),\n  createLocation(\n    'Quad Symmetry',\n    'Four-way symmetric boundary details',\n    '2',\n    FractalType.Multibrot4,\n    0.4, 0.4, 8,\n    { cosinePaletteIndex: 4, colorOffset: 0.15 }\n  ),\n  createLocation(\n    'Multibrot⁴ Julia',\n    'A Julia set with four-fold symmetry',\n    '3',\n    FractalType.Multibrot4Julia,\n    0, 0, 0.5,\n    { cosinePaletteIndex: 0, colorOffset: 0, juliaC: [0.5, 0] }\n  ),\n];\n\n// ============================================================================\n// FUNKY (your happy accident!)\n// ============================================================================\nconst FUNKY_LOCATIONS: FamousLocation[] = [\n  createLocation(\n    'Funky Overview',\n    'The wonderfully weird Funky fractal',\n    '1',\n    FractalType.Funky,\n    -0.5, 0, 0.4,\n    { cosinePaletteIndex: 0, colorOffset: 0 }\n  ),\n  createLocation(\n    'Funky Detail',\n    'Asymmetric chaos patterns',\n    '2',\n    FractalType.Funky,\n    -0.75, 0.15, 10,\n    { cosinePaletteIndex: 4, colorOffset: 0.2 }\n  ),\n  createLocation(\n    'Funky Julia',\n    'A Julia set from the Funky fractal',\n    '3',\n    FractalType.FunkyJulia,\n    0, 0, 0.5,\n    { cosinePaletteIndex: 3, colorOffset: 0, juliaC: [-0.7, 0.27] }\n  ),\n];\n\n// ============================================================================\n// PERPENDICULAR\n// ============================================================================\nconst PERPENDICULAR_LOCATIONS: FamousLocation[] = [\n  createLocation(\n    'Perpendicular Overview',\n    'The Perpendicular Mandelbrot variant',\n    '1',\n    FractalType.Perpendicular,\n    -0.5, 0, 0.4,\n    { cosinePaletteIndex: 2, colorOffset: 0 }\n  ),\n  createLocation(\n    'Perpendicular Spirals',\n    'Unique spiral formations',\n    '2',\n    FractalType.Perpendicular,\n    -0.75, 0.1, 8,\n    { cosinePaletteIndex: 4, colorOffset: 0.1 }\n  ),\n  createLocation(\n    'Perpendicular Julia',\n    'A Julia set from the Perpendicular fractal',\n    '3',\n    FractalType.PerpendicularJulia,\n    0, 0, 0.5,\n    { cosinePaletteIndex: 0, colorOffset: 0, juliaC: [-0.5, 0.5] }\n  ),\n];\n\n// ============================================================================\n// LOCATION MAP BY BASE FRACTAL TYPE\n// ============================================================================\n\n/**\n * Map from base fractal type (even numbers) to their famous locations.\n * Both base and Julia variants of a fractal share the same location list.\n */\nconst LOCATIONS_BY_FRACTAL: Map<FractalType, FamousLocation[]> = new Map([\n  [FractalType.Mandelbrot, MANDELBROT_LOCATIONS],\n  [FractalType.BurningShip, BURNING_SHIP_LOCATIONS],\n  [FractalType.Tricorn, TRICORN_LOCATIONS],\n  [FractalType.Celtic, CELTIC_LOCATIONS],\n  [FractalType.Buffalo, BUFFALO_LOCATIONS],\n  [FractalType.Phoenix, PHOENIX_LOCATIONS],\n  [FractalType.Multibrot3, MULTIBROT3_LOCATIONS],\n  [FractalType.Multibrot4, MULTIBROT4_LOCATIONS],\n  [FractalType.Funky, FUNKY_LOCATIONS],\n  [FractalType.Perpendicular, PERPENDICULAR_LOCATIONS],\n]);\n\n/**\n * Get a famous location by its keyboard shortcut for the current fractal type.\n * Locations are shared between base and Julia variants of the same fractal.\n *\n * @param key The keyboard key pressed (1-9)\n * @param currentFractalType The currently selected fractal type\n * @returns The matching location, or undefined if not found\n */\nexport function getLocationByKey(key: string, currentFractalType: FractalType): FamousLocation | undefined {\n  // Get the base fractal type (clears the Julia bit)\n  const baseType = getBaseFractalType(currentFractalType);\n  const locations = LOCATIONS_BY_FRACTAL.get(baseType);\n\n  if (!locations) return undefined;\n\n  return locations.find(loc => loc.key === key);\n}\n\n/**\n * Get all famous locations for a fractal type.\n * Useful for displaying available locations in UI.\n */\nexport function getLocationsForFractal(fractalType: FractalType): FamousLocation[] {\n  const baseType = getBaseFractalType(fractalType);\n  return LOCATIONS_BY_FRACTAL.get(baseType) ?? [];\n}\n\n/**\n * Get the count of locations available for the current fractal type.\n */\nexport function getLocationCount(fractalType: FractalType): number {\n  return getLocationsForFractal(fractalType).length;\n}\n","/**\n * Color Palettes - Defined in TypeScript, passed to GPU as parameters\n *\n * \"Colors managed properly, not scattered across shader code like confetti.\"\n * - Skippy the Magnificent\n */\n\nexport type Vec3 = [number, number, number];\n\nexport interface CosinePaletteParams {\n  type: 'cosine';\n  // color = a + b * cos(2π * (c * t + d))\n  a: Vec3;\n  b: Vec3;\n  c: Vec3;\n  d: Vec3;\n}\n\nexport interface GradientPaletteParams {\n  type: 'gradient';\n  // 5 color stops\n  c1: Vec3;\n  c2: Vec3;\n  c3: Vec3;\n  c4: Vec3;\n  c5: Vec3;\n}\n\nexport type PaletteParams = CosinePaletteParams | GradientPaletteParams;\n\nexport interface Palette {\n  name: string;\n  isMonotonic: boolean;\n  params: PaletteParams;\n  // Optional HDR-specific params (for monotonic palettes that need brighter colors)\n  hdrParams?: GradientPaletteParams;\n}\n\n// ============================================\n// Cosine Palettes\n// color = a + b * cos(2π * (c * t + d))\n// These work the same for SDR/HDR\n// ============================================\n\ninterface CosinePalette extends Palette {\n  params: CosinePaletteParams;\n}\n\nconst COSINE_PALETTES: CosinePalette[] = [\n  {\n    name: 'Rainbow',\n    isMonotonic: false,\n    params: {\n      type: 'cosine',\n      a: [0.5, 0.5, 0.5],\n      b: [0.5, 0.5, 0.5],\n      c: [1.0, 1.0, 1.0],\n      d: [0.0, 0.33, 0.67],\n    },\n  },\n  {\n    name: 'Fire',\n    isMonotonic: false,\n    params: {\n      type: 'cosine',\n      a: [0.5, 0.5, 0.5],\n      b: [0.5, 0.5, 0.5],\n      c: [1.0, 1.0, 0.5],\n      d: [0.0, 0.1, 0.2],\n    },\n  },\n  {\n    name: 'Ice',\n    isMonotonic: false,\n    params: {\n      type: 'cosine',\n      a: [0.5, 0.5, 0.5],\n      b: [0.5, 0.5, 0.5],\n      c: [1.0, 0.7, 0.4],\n      d: [0.0, 0.15, 0.20],\n    },\n  },\n  {\n    name: 'Sunset',\n    isMonotonic: false,\n    params: {\n      type: 'cosine',\n      a: [0.5, 0.3, 0.2],\n      b: [0.5, 0.4, 0.3],\n      c: [1.0, 1.0, 0.5],\n      d: [0.0, 0.1, 0.2],\n    },\n  },\n  {\n    name: 'Electric',\n    isMonotonic: false,\n    params: {\n      type: 'cosine',\n      a: [0.5, 0.5, 0.5],\n      b: [0.6, 0.6, 0.6],\n      c: [1.0, 1.0, 1.0],\n      d: [0.3, 0.2, 0.2],\n    },\n  },\n  {\n    name: 'Neon',\n    isMonotonic: false,\n    params: {\n      type: 'cosine',\n      a: [0.5, 0.5, 0.5],\n      b: [0.5, 0.5, 0.5],\n      c: [1.0, 1.0, 1.0],\n      d: [0.0, 0.1, 0.2],\n    },\n  },\n  {\n    name: 'Emerald',\n    isMonotonic: false,\n    params: {\n      type: 'cosine',\n      a: [0.2, 0.5, 0.3],\n      b: [0.3, 0.5, 0.3],\n      c: [1.0, 1.0, 1.0],\n      d: [0.0, 0.25, 0.5],\n    },\n  },\n  {\n    name: 'Candy',\n    isMonotonic: false,\n    params: {\n      type: 'cosine',\n      a: [0.8, 0.5, 0.5],\n      b: [0.2, 0.4, 0.4],\n      c: [1.0, 1.0, 2.0],\n      d: [0.0, 0.25, 0.25],\n    },\n  },\n  {\n    name: 'Plasma',\n    isMonotonic: false,\n    params: {\n      type: 'cosine',\n      a: [0.5, 0.5, 0.5],\n      b: [0.5, 0.5, 0.5],\n      c: [2.0, 1.0, 0.0],\n      d: [0.5, 0.2, 0.25],\n    },\n  },\n  {\n    name: 'Peacock',\n    isMonotonic: false,\n    params: {\n      type: 'cosine',\n      a: [0.3, 0.5, 0.5],\n      b: [0.4, 0.4, 0.3],\n      c: [1.0, 1.0, 1.0],\n      d: [0.0, 0.1, 0.35],\n    },\n  },\n  {\n    name: 'Autumn',\n    isMonotonic: false,\n    params: {\n      type: 'cosine',\n      a: [0.6, 0.4, 0.2],\n      b: [0.4, 0.3, 0.2],\n      c: [1.0, 1.0, 1.0],\n      d: [0.0, 0.05, 0.1],\n    },\n  },\n  {\n    name: 'Aurora',\n    isMonotonic: false,\n    params: {\n      type: 'cosine',\n      a: [0.3, 0.5, 0.5],\n      b: [0.5, 0.5, 0.5],\n      c: [1.0, 1.0, 0.5],\n      d: [0.8, 0.9, 0.3],\n    },\n  },\n];\n\n// ============================================\n// Gradient Palettes\n// 5 color stops with linear interpolation\n// Can have HDR overrides for brighter base colors\n// ============================================\n\ninterface GradientPalette extends Palette {\n  params: GradientPaletteParams;\n  hdrParams?: GradientPaletteParams;\n}\n\nconst GRADIENT_PALETTES: GradientPalette[] = [\n  {\n    name: 'Blue',\n    isMonotonic: true,\n    params: {\n      type: 'gradient',\n      c1: [0.02, 0.01, 0.08],\n      c2: [0.05, 0.15, 0.25],\n      c3: [0.1, 0.4, 0.5],\n      c4: [0.3, 0.6, 0.8],\n      c5: [0.7, 0.9, 1.0],\n    },\n    hdrParams: {\n      type: 'gradient',\n      c1: [0.2, 0.4, 1.0],\n      c2: [0.3, 0.6, 1.0],\n      c3: [0.4, 0.8, 1.0],\n      c4: [0.6, 0.9, 1.0],\n      c5: [0.85, 1.0, 1.0],\n    },\n  },\n  {\n    name: 'Gold',\n    isMonotonic: true,\n    params: {\n      type: 'gradient',\n      c1: [0.04, 0.02, 0.01],\n      c2: [0.2, 0.08, 0.02],\n      c3: [0.5, 0.25, 0.05],\n      c4: [0.85, 0.6, 0.2],\n      c5: [1.0, 0.95, 0.7],\n    },\n    hdrParams: {\n      type: 'gradient',\n      c1: [1.0, 0.5, 0.1],\n      c2: [1.0, 0.65, 0.2],\n      c3: [1.0, 0.8, 0.3],\n      c4: [1.0, 0.9, 0.5],\n      c5: [1.0, 1.0, 0.8],\n    },\n  },\n  {\n    name: 'Grayscale',\n    isMonotonic: true,\n    params: {\n      type: 'gradient',\n      c1: [0.01, 0.01, 0.03],\n      c2: [0.15, 0.15, 0.17],\n      c3: [0.45, 0.45, 0.45],\n      c4: [0.75, 0.74, 0.72],\n      c5: [1.0, 0.98, 0.95],\n    },\n    hdrParams: {\n      type: 'gradient',\n      c1: [1.0, 1.0, 1.0],\n      c2: [1.0, 1.0, 1.0],\n      c3: [1.0, 1.0, 1.0],\n      c4: [1.0, 1.0, 1.0],\n      c5: [1.0, 1.0, 1.0],\n    },\n  },\n  {\n    name: 'Sepia',\n    isMonotonic: true,\n    params: {\n      type: 'gradient',\n      c1: [0.03, 0.02, 0.01],\n      c2: [0.15, 0.08, 0.03],\n      c3: [0.4, 0.25, 0.12],\n      c4: [0.7, 0.55, 0.35],\n      c5: [1.0, 0.95, 0.85],\n    },\n    hdrParams: {\n      type: 'gradient',\n      c1: [1.0, 0.7, 0.4],\n      c2: [1.0, 0.8, 0.55],\n      c3: [1.0, 0.88, 0.7],\n      c4: [1.0, 0.95, 0.85],\n      c5: [1.0, 1.0, 0.95],\n    },\n  },\n  {\n    name: 'Ocean',\n    isMonotonic: true,\n    params: {\n      type: 'gradient',\n      c1: [0.0, 0.02, 0.05],\n      c2: [0.02, 0.08, 0.2],\n      c3: [0.05, 0.3, 0.4],\n      c4: [0.2, 0.6, 0.6],\n      c5: [0.6, 0.95, 0.9],\n    },\n    hdrParams: {\n      type: 'gradient',\n      c1: [0.1, 0.8, 0.8],\n      c2: [0.2, 0.9, 0.85],\n      c3: [0.4, 0.95, 0.9],\n      c4: [0.65, 1.0, 0.95],\n      c5: [0.85, 1.0, 1.0],\n    },\n  },\n  {\n    name: 'Purple',\n    isMonotonic: true,\n    params: {\n      type: 'gradient',\n      c1: [0.03, 0.01, 0.06],\n      c2: [0.15, 0.05, 0.25],\n      c3: [0.4, 0.15, 0.5],\n      c4: [0.7, 0.4, 0.75],\n      c5: [0.95, 0.8, 1.0],\n    },\n    hdrParams: {\n      type: 'gradient',\n      c1: [0.8, 0.2, 1.0],\n      c2: [0.85, 0.4, 1.0],\n      c3: [0.9, 0.6, 1.0],\n      c4: [0.95, 0.8, 1.0],\n      c5: [1.0, 0.95, 1.0],\n    },\n  },\n  {\n    name: 'Forest',\n    isMonotonic: true,\n    params: {\n      type: 'gradient',\n      c1: [0.02, 0.03, 0.01],\n      c2: [0.05, 0.12, 0.04],\n      c3: [0.1, 0.35, 0.15],\n      c4: [0.3, 0.65, 0.3],\n      c5: [0.7, 0.95, 0.6],\n    },\n    hdrParams: {\n      type: 'gradient',\n      c1: [0.3, 1.0, 0.2],\n      c2: [0.5, 1.0, 0.4],\n      c3: [0.7, 1.0, 0.55],\n      c4: [0.85, 1.0, 0.75],\n      c5: [0.95, 1.0, 0.9],\n    },\n  },\n];\n\nexport const COSINE_PALETTE_COUNT = COSINE_PALETTES.length;\nexport const GRADIENT_PALETTE_COUNT = GRADIENT_PALETTES.length;\n\nexport type PaletteType = 'cosine' | 'gradient';\n\n/**\n * Get cosine palette parameters for rendering\n */\nexport function getCosinePaletteParams(index: number): CosinePaletteParams {\n  return COSINE_PALETTES[index % COSINE_PALETTE_COUNT].params;\n}\n\n/**\n * Get gradient palette parameters for rendering\n * @param hdr Whether to use HDR-specific params (if available)\n */\nexport function getGradientPaletteParams(index: number, hdr: boolean): GradientPaletteParams {\n  const palette = GRADIENT_PALETTES[index % GRADIENT_PALETTE_COUNT];\n  if (hdr && palette.hdrParams) {\n    return palette.hdrParams;\n  }\n  return palette.params;\n}\n\n/**\n * Get full cosine palette info\n */\nexport function getCosinePalette(index: number): CosinePalette {\n  return COSINE_PALETTES[index % COSINE_PALETTE_COUNT];\n}\n\n/**\n * Get full gradient palette info\n */\nexport function getGradientPalette(index: number): GradientPalette {\n  return GRADIENT_PALETTES[index % GRADIENT_PALETTE_COUNT];\n}\n\nexport function getCosinePaletteName(index: number): string {\n  return COSINE_PALETTES[index % COSINE_PALETTE_COUNT].name;\n}\n\nexport function getGradientPaletteName(index: number): string {\n  return GRADIENT_PALETTES[index % GRADIENT_PALETTE_COUNT].name;\n}\n\n","export default \"// WebGPU Shader for Mandelbrot Set with HDR support\\n// Version 2: Palette parameters passed from TypeScript (no branching)\\n\\nstruct Uniforms {\\n  resolution: vec2f,         // offset 0, size 8\\n  center: vec2f,             // offset 8, size 8\\n  zoom: f32,                 // offset 16, size 4\\n  maxIterations: i32,        // offset 20, size 4\\n  time: f32,                 // offset 24, size 4\\n  colorOffset: f32,          // offset 28, size 4\\n  fractalType: i32,          // offset 32, size 4\\n  _pad_jc: f32,              // offset 36, size 4 (padding for juliaC alignment)\\n  juliaC: vec2f,             // offset 40, size 8\\n  hdrEnabled: i32,           // offset 48, size 4\\n  hdrBrightnessBias: f32,    // offset 52, size 4\\n  paletteType: i32,          // offset 56, size 4\\n  isMonotonic: i32,          // offset 60, size 4\\n  sdrGradientBrightness: f32, // offset 64, size 4\\n  _pad0: f32,                // offset 68, size 4\\n  _pad1: f32,                // offset 72, size 4\\n  _pad2: f32,                // offset 76, size 4\\n  // Now at offset 80 = 16-byte aligned for vec3f\\n  // Cosine palette: color = a + b * cos(2π * (c * t + d))\\n  paletteA: vec3f,           // offset 80, size 12\\n  _padA: f32,                // offset 92, size 4\\n  paletteB: vec3f,           // offset 96, size 12\\n  _padB: f32,                // offset 108, size 4\\n  paletteC: vec3f,           // offset 112, size 12\\n  _padC: f32,                // offset 124, size 4\\n  paletteD: vec3f,           // offset 128, size 12\\n  _padD: f32,                // offset 140, size 4\\n  // Gradient palette: 5 color stops (offset 144)\\n  gradientC1: vec3f,         // offset 144, size 12\\n  _padG1: f32,               // offset 156, size 4\\n  gradientC2: vec3f,         // offset 160, size 12\\n  _padG2: f32,               // offset 172, size 4\\n  gradientC3: vec3f,         // offset 176, size 12\\n  _padG3: f32,               // offset 188, size 4\\n  gradientC4: vec3f,         // offset 192, size 12\\n  _padG4: f32,               // offset 204, size 4\\n  gradientC5: vec3f,         // offset 208, size 12\\n  _padG5: f32,               // offset 220, size 4\\n}\\n\\n@group(0) @binding(0) var<uniform> u: Uniforms;\\n\\nstruct VertexOutput {\\n  @builtin(position) position: vec4f,\\n  @location(0) uv: vec2f,\\n}\\n\\n@vertex\\nfn vertexMain(@builtin(vertex_index) vertexIndex: u32) -> VertexOutput {\\n  var pos = array<vec2f, 3>(\\n    vec2f(-1.0, -1.0),\\n    vec2f(3.0, -1.0),\\n    vec2f(-1.0, 3.0)\\n  );\\n  var output: VertexOutput;\\n  output.position = vec4f(pos[vertexIndex], 0.0, 1.0);\\n  output.uv = (pos[vertexIndex] + 1.0) * 0.5;\\n  return output;\\n}\\n\\n// Cosine palette formula\\nfn cosineColor(t: f32, a: vec3f, b: vec3f, c: vec3f, d: vec3f) -> vec3f {\\n  return a + b * cos(6.28318 * (c * t + d));\\n}\\n\\n// 5-stop gradient\\nfn gradientColor(t: f32, c1: vec3f, c2: vec3f, c3: vec3f, c4: vec3f, c5: vec3f) -> vec3f {\\n  if (t < 0.25) { return mix(c1, c2, t * 4.0); }\\n  else if (t < 0.5) { return mix(c2, c3, (t - 0.25) * 4.0); }\\n  else if (t < 0.75) { return mix(c3, c4, (t - 0.5) * 4.0); }\\n  else { return mix(c4, c5, (t - 0.75) * 4.0); }\\n}\\n\\n// Get color based on palette type\\nfn getColor(t_in: f32, isCycling: bool) -> vec3f {\\n  var t = t_in;\\n  if (isCycling) {\\n    t = fract(t);\\n  } else {\\n    t = clamp(t, 0.0, 1.0);\\n  }\\n\\n  if (u.paletteType == 0) {\\n    return cosineColor(t, u.paletteA, u.paletteB, u.paletteC, u.paletteD);\\n  } else {\\n    var color = gradientColor(t, u.gradientC1, u.gradientC2, u.gradientC3, u.gradientC4, u.gradientC5);\\n    // Apply SDR gradient brightness adjustment (only affects SDR mode)\\n    if (u.hdrEnabled == 0) {\\n      color = color * u.sdrGradientBrightness;\\n    }\\n    return color;\\n  }\\n}\\n\\n// HDR brightness curve for MONOTONIC palettes\\n// bias: -1 to +1, shifts the bright region earlier (positive) or later (negative)\\nfn hdrBrightnessCurveMonotonic(normalized: f32, bias: f32) -> f32 {\\n  // Shift the normalized value by bias to move bright regions\\n  // bias > 0: more of the image becomes bright (bright region starts earlier)\\n  // bias < 0: less of the image is bright (bright region starts later)\\n  let shifted = clamp(normalized + bias * 0.4, 0.0, 1.0);\\n\\n  let LOW_END = 0.05;\\n  let MID_START = 0.30;\\n  let HIGH_START = 0.60;\\n  let PEAK = 10.0; // Fixed peak multiplier for HDR\\n\\n  if (shifted < LOW_END) {\\n    let t = shifted / LOW_END;\\n    return mix(0.0, 0.15, sqrt(t));\\n  } else if (shifted < MID_START) {\\n    let t = (shifted - LOW_END) / (MID_START - LOW_END);\\n    return mix(0.15, 0.5, t);\\n  } else if (shifted < HIGH_START) {\\n    let t = (shifted - MID_START) / (HIGH_START - MID_START);\\n    return mix(0.5, 1.0, t);\\n  } else {\\n    let t = (shifted - HIGH_START) / (1.0 - HIGH_START);\\n    let eased = pow(t, 1.1);\\n    return mix(1.0, PEAK, eased);\\n  }\\n}\\n\\n// HDR brightness curve for CYCLING palettes\\n// bias: -1 to +1, shifts the HDR highlight region\\nfn hdrBrightnessCurveCycling(normalized: f32, bias: f32) -> f32 {\\n  // Shift where the HDR boost kicks in\\n  // bias > 0: HDR highlights appear earlier (more of image gets boost)\\n  // bias < 0: HDR highlights appear later (only near-boundary gets boost)\\n  let HIGH_START = clamp(0.70 - bias * 0.25, 0.3, 0.95);\\n  let PEAK = 10.0; // Fixed peak multiplier for HDR\\n\\n  if (normalized < HIGH_START) {\\n    let t = normalized / HIGH_START;\\n    return mix(0.85, 1.0, t);\\n  } else {\\n    let t = (normalized - HIGH_START) / (1.0 - HIGH_START);\\n    let eased = pow(t, 1.2);\\n    return mix(1.0, PEAK, eased);\\n  }\\n}\\n\\n@fragment\\nfn fragmentMain(input: VertexOutput) -> @location(0) vec4f {\\n  let aspect = u.resolution.x / u.resolution.y;\\n  var uv = input.uv - 0.5;\\n  uv.x *= aspect;\\n  let pos = u.center + uv / u.zoom;\\n\\n  var z: vec2f;\\n  var c: vec2f;\\n  var zPrev: vec2f = vec2f(0.0); // For Phoenix fractal\\n\\n  // Determine if this is a Julia variant (odd types have bit 0 set)\\n  let fType = u.fractalType;\\n  let isJulia = (fType & 1) == 1;\\n  let baseType = fType >> 1; // 0=Mandelbrot, 1=BurningShip, 2=Tricorn, etc.\\n\\n  // Phoenix is naturally Julia-style - always start z at pixel position\\n  let isPhoenix = baseType == 5;\\n\\n  if (isJulia) {\\n    z = pos;\\n    c = u.juliaC;\\n  } else if (isPhoenix) {\\n    // Phoenix: z starts at pixel (Julia-style), use classic parameters\\n    z = pos;\\n    c = vec2f(0.5667, -0.5); // Classic Phoenix (p, q)\\n  } else {\\n    z = vec2f(0.0);\\n    c = pos;\\n  }\\n\\n  var iterations = 0;\\n  let maxIter = u.maxIterations;\\n\\n  for (var i = 0; i < 65536; i++) {\\n    if (i >= maxIter) { break; }\\n    let zMagSq = dot(z, z);\\n    if (zMagSq > 256.0) { break; } // Larger escape for higher powers\\n\\n    let zTemp = z;\\n\\n    // Fractal type dispatch using base type (fType >> 1 clears Julia bit)\\n    // 0: Mandelbrot/Julia, 1: Burning Ship, 2: Tricorn, 3: Celtic,\\n    // 4: Buffalo, 5: Phoenix, 6: Multibrot3, 7: Multibrot4, 8: Perpendicular\\n\\n    if (baseType == 0) {\\n      // Mandelbrot / Julia: z² + c\\n      z = vec2f(z.x * z.x - z.y * z.y + c.x, 2.0 * z.x * z.y + c.y);\\n    }\\n    else if (baseType == 1) {\\n      // Burning Ship: |z|² + c (take abs before squaring)\\n      z = vec2f(abs(z.x), -abs(z.y));\\n      z = vec2f(z.x * z.x - z.y * z.y + c.x, 2.0 * z.x * z.y + c.y);\\n    }\\n    else if (baseType == 2) {\\n      // Tricorn: conj(z)² + c\\n      z = vec2f(z.x * z.x - z.y * z.y + c.x, -2.0 * z.x * z.y + c.y);\\n    }\\n    else if (baseType == 3) {\\n      // Celtic: |Re(z²)| + Im(z²)i + c\\n      let zSqReal = z.x * z.x - z.y * z.y;\\n      let zSqImag = 2.0 * z.x * z.y;\\n      z = vec2f(abs(zSqReal) + c.x, zSqImag + c.y);\\n    }\\n    else if (baseType == 4) {\\n      // Buffalo: |Re(z²)| - |Im(z²)|i + c\\n      let zSqReal = z.x * z.x - z.y * z.y;\\n      let zSqImag = 2.0 * z.x * z.y;\\n      z = vec2f(abs(zSqReal) + c.x, -abs(zSqImag) + c.y);\\n    }\\n    else if (baseType == 5) {\\n      // Phoenix: z_{n+1} = z_n² + p + q * z_{n-1}\\n      // Base Phoenix: c = pixel position = (p, q) for parameter exploration\\n      // Julia Phoenix: c = juliaC = (p, q) for fixed parameters\\n      // In both cases, c.x = p, c.y = q\\n      let p = c.x;\\n      let q = c.y;\\n      let zSq = vec2f(z.x * z.x - z.y * z.y, 2.0 * z.x * z.y);\\n      let newZ = vec2f(\\n        zSq.x + p + q * zPrev.x,\\n        zSq.y + q * zPrev.y\\n      );\\n      zPrev = z;\\n      z = newZ;\\n    }\\n    else if (baseType == 6) {\\n      // Multibrot3: z³ + c\\n      let zSq = vec2f(z.x * z.x - z.y * z.y, 2.0 * z.x * z.y);\\n      z = vec2f(z.x * zSq.x - z.y * zSq.y + c.x, z.x * zSq.y + z.y * zSq.x + c.y);\\n    }\\n    else if (baseType == 7) {\\n      // Multibrot4: z⁴ + c\\n      let zSq = vec2f(z.x * z.x - z.y * z.y, 2.0 * z.x * z.y);\\n      z = vec2f(zSq.x * zSq.x - zSq.y * zSq.y + c.x, 2.0 * zSq.x * zSq.y + c.y);\\n    }\\n    else if (baseType == 8) {\\n      // Funky Mandelbrot (happy accident!): Re(z) + |Im(z)|i then square\\n      z = vec2f(z.x, abs(z.y));\\n      z = vec2f(z.x * z.x - z.y * z.y + c.x, 2.0 * z.x * z.y + c.y);\\n    }\\n    else if (baseType == 9) {\\n      // Perpendicular Mandelbrot: (|Re(z)| - i·Im(z))² + c\\n      // w = |x| - iy, w² = |x|² - y² - 2|x|yi\\n      let ax = abs(z.x);\\n      z = vec2f(ax * ax - z.y * z.y + c.x, -2.0 * ax * z.y + c.y);\\n    }\\n    else {\\n      // Fallback to standard Mandelbrot\\n      z = vec2f(z.x * z.x - z.y * z.y + c.x, 2.0 * z.x * z.y + c.y);\\n    }\\n\\n    iterations++;\\n  }\\n\\n  if (iterations >= maxIter) {\\n    return vec4f(0.0, 0.0, 0.0, 1.0);\\n  }\\n\\n  // Smooth iteration count - adjust log base for higher power fractals\\n  var logBase = 2.0;\\n  if (baseType == 6) { logBase = 3.0; }      // Multibrot3\\n  else if (baseType == 7) { logBase = 4.0; } // Multibrot4\\n\\n  let smoothIter = f32(iterations) + 1.0 - log2(log2(max(dot(z, z), 4.0))) / log2(logBase);\\n  let normalized = smoothIter / f32(maxIter);\\n\\n  let isMonotonic = u.isMonotonic != 0;\\n  let isCycling = !isMonotonic;\\n\\n  var t: f32;\\n  if (isMonotonic) {\\n    t = normalized + u.colorOffset;\\n  } else {\\n    let numCycles = 8.0;\\n    t = normalized * numCycles + u.colorOffset;\\n  }\\n\\n  var color = getColor(t, isCycling);\\n\\n  if (u.hdrEnabled != 0) {\\n    var brightnessMult: f32;\\n\\n    if (isMonotonic) {\\n      brightnessMult = hdrBrightnessCurveMonotonic(normalized, u.hdrBrightnessBias);\\n    } else {\\n      brightnessMult = hdrBrightnessCurveCycling(normalized, u.hdrBrightnessBias);\\n    }\\n\\n    color = color * brightnessMult;\\n    return vec4f(color, 1.0);\\n  } else {\\n    let edgeFactor = 1.0 - f32(iterations) / f32(maxIter);\\n    let glow = pow(edgeFactor, 0.5) * 0.3;\\n    color = color * (1.0 + glow);\\n    return vec4f(min(color, vec3f(1.0)), 1.0);\\n  }\\n}\\n\"","/**\n * WebGPU Fractal Engine - HDR-capable fractal renderer\n *\n * \"WebGPU: Finally, graphics done right.\"\n * - Skippy the Magnificent\n */\n\nimport { WebGPURenderer } from '../renderer/WebGPURenderer';\nimport { ViewState } from '../controls/ViewState';\nimport { InputHandler } from '../controls/InputHandler';\nimport { FractalType, FRACTAL_TYPE_NAMES, BASE_FRACTAL_COUNT, isJuliaType, getBaseFractalType, getJuliaVariant } from '../types';\nimport {\n  BookmarkState,\n  readUrlBookmark,\n  updateUrlHash,\n  copyShareableUrl,\n} from '../bookmark/BookmarkManager';\nimport { getLocationByKey } from '../bookmark/famousLocations';\nimport {\n  getCosinePalette,\n  getGradientPalette,\n  getCosinePaletteParams,\n  getGradientPaletteParams,\n  getCosinePaletteName,\n  getGradientPaletteName,\n  COSINE_PALETTE_COUNT,\n  GRADIENT_PALETTE_COUNT,\n  PaletteType,\n} from '../renderer/Palettes';\n\nimport shaderSource from '../renderer/shaders/mandelbrot.wgsl?raw';\n\n/** Base iterations at zoom 1 */\nconst MAX_ITERATIONS_BASE = 256;\nconst MAX_ITERATIONS_BASE_JULIA = 512;\nconst MAX_ITERATIONS_AUTO_CAP = 4096;\nconst MAX_ITERATIONS_LOG_SCALE = 640;\nconst MAX_ITERATIONS_LOG_POWER = 1.65;\nconst ITERATION_ADJUST_RATIO = 1.5;\n\nfunction maxIterationsForZoom(zoom: number, isJulia: boolean = false): number {\n  const z = Math.max(1, zoom);\n  const L = Math.log10(z);\n  const base = isJulia ? MAX_ITERATIONS_BASE_JULIA : MAX_ITERATIONS_BASE;\n  const n = base + MAX_ITERATIONS_LOG_SCALE * Math.pow(L, MAX_ITERATIONS_LOG_POWER);\n  return Math.round(Math.max(base, Math.min(MAX_ITERATIONS_AUTO_CAP, n)));\n}\n\n// Uniform buffer structure (must match WGSL)\n// Base uniforms: 64 bytes\n// Palette params: ~160 bytes (vec3s with padding)\n// Total: 256 bytes (nice round number)\nconst UNIFORM_BUFFER_SIZE = 256;\n\nexport class WebGPUFractalEngine {\n  private renderer: WebGPURenderer;\n  private viewState: ViewState;\n  private inputHandler: InputHandler;\n\n  private pipeline!: GPURenderPipeline;\n  private uniformBuffer!: GPUBuffer;\n  private bindGroup!: GPUBindGroup;\n\n  private maxIterationsOverride: number | null = null;\n  private fractalType: FractalType = FractalType.Mandelbrot;\n  private juliaC: [number, number] = [-0.7, 0.27015];\n  private juliaPickerMode = false;\n  private savedViewState: { centerX: number; centerY: number; zoom: number } | null = null;\n  private savedFractalType: FractalType | null = null;\n\n  private paletteType: PaletteType = 'cosine';\n  private cosinePaletteIndex = 1; // Fire\n  private gradientPaletteIndex = 0; // Blue\n  private colorOffset = 0.0;\n\n  /** HDR brightness bias: -1 to +1, shifts which regions appear bright */\n  private hdrBrightnessBias = 0.0;\n  /** SDR gradient brightness multiplier: 0.2 to 2.0 */\n  private sdrGradientBrightness = 1.0;\n\n  private debugOverlay: HTMLElement | null = null;\n  private shareNotification: HTMLElement | null = null;\n  private helpOverlay: HTMLElement | null = null;\n  private helpVisible = false;\n  private screenshotMode = false;\n\n  private constructor(renderer: WebGPURenderer, canvas: HTMLCanvasElement) {\n    this.renderer = renderer;\n    this.viewState = new ViewState();\n\n    this.inputHandler = new InputHandler(canvas, this.viewState, () => {\n      this.render();\n    });\n\n    this.setupInputCallbacks();\n    this.setupOverlays(canvas);\n  }\n\n  static async create(canvas: HTMLCanvasElement): Promise<WebGPUFractalEngine> {\n    const renderer = await WebGPURenderer.create(canvas);\n    const engine = new WebGPUFractalEngine(renderer, canvas);\n    await engine.initializePipeline();\n\n    // Listen for HDR display changes\n    renderer.setOnHdrChange(() => {\n      console.log('HDR status changed, re-rendering...');\n      engine.render();\n    });\n\n    window.addEventListener('resize', engine.handleResize);\n    window.addEventListener('hashchange', engine.handleHashChange);\n\n    engine.loadBookmark();\n    engine.handleResize();\n\n    return engine;\n  }\n\n  private async initializePipeline(): Promise<void> {\n    const device = this.renderer.device;\n\n    // Create shader module\n    const shaderModule = device.createShaderModule({\n      label: 'Mandelbrot Shader',\n      code: shaderSource,\n    });\n\n    // Create uniform buffer\n    this.uniformBuffer = device.createBuffer({\n      label: 'Uniforms',\n      size: UNIFORM_BUFFER_SIZE,\n      usage: GPUBufferUsage.UNIFORM | GPUBufferUsage.COPY_DST,\n    });\n\n    // Create bind group layout\n    const bindGroupLayout = device.createBindGroupLayout({\n      label: 'Bind Group Layout',\n      entries: [{\n        binding: 0,\n        visibility: GPUShaderStage.VERTEX | GPUShaderStage.FRAGMENT,\n        buffer: { type: 'uniform' },\n      }],\n    });\n\n    // Create bind group\n    this.bindGroup = device.createBindGroup({\n      label: 'Bind Group',\n      layout: bindGroupLayout,\n      entries: [{\n        binding: 0,\n        resource: { buffer: this.uniformBuffer },\n      }],\n    });\n\n    // Create pipeline layout\n    const pipelineLayout = device.createPipelineLayout({\n      label: 'Pipeline Layout',\n      bindGroupLayouts: [bindGroupLayout],\n    });\n\n    // Create render pipeline\n    this.pipeline = device.createRenderPipeline({\n      label: 'Mandelbrot Pipeline',\n      layout: pipelineLayout,\n      vertex: {\n        module: shaderModule,\n        entryPoint: 'vertexMain',\n      },\n      fragment: {\n        module: shaderModule,\n        entryPoint: 'fragmentMain',\n        targets: [{\n          format: this.renderer.format,\n        }],\n      },\n      primitive: {\n        topology: 'triangle-list',\n      },\n    });\n\n    console.log('WebGPU pipeline initialized');\n  }\n\n  private setupInputCallbacks(): void {\n    this.inputHandler.setIterationAdjustCallback((direction) => {\n      this.adjustMaxIterations(direction);\n    });\n    this.inputHandler.setIterationResetCallback(() => {\n      this.clearMaxIterationsOverride();\n    });\n    this.inputHandler.setCosinePaletteCycleCallback((direction) => {\n      this.cycleCosinePalette(direction);\n    });\n    this.inputHandler.setGradientPaletteCycleCallback((direction) => {\n      this.cycleGradientPalette(direction);\n    });\n    this.inputHandler.setColorOffsetCallback((delta) => {\n      this.adjustColorOffset(delta);\n    });\n    this.inputHandler.setColorOffsetResetCallback(() => {\n      this.resetColorOffset();\n    });\n    this.inputHandler.setToggleAACallback(() => {\n      // AA not supported in WebGPU version (HDR is always on)\n      console.log('AA not available in WebGPU HDR mode');\n    });\n    this.inputHandler.setToggleHDRCallback(() => {\n      this.toggleHDR();\n    });\n    this.inputHandler.setAdjustHdrBrightnessCallback((direction) => {\n      this.adjustHdrBrightness(direction);\n    });\n    this.inputHandler.setResetHdrBrightnessCallback(() => {\n      this.resetHdrBrightness();\n    });\n    this.inputHandler.setFractalCycleCallback((direction) => {\n      this.cycleFractalType(direction);\n    });\n    this.inputHandler.setToggleJuliaModeCallback(() => {\n      this.toggleJuliaPickerMode();\n    });\n    this.inputHandler.setJuliaPickCallback((x, y) => {\n      this.pickJuliaConstant(x, y);\n    });\n    this.inputHandler.setShareCallback(() => {\n      this.shareBookmark();\n    });\n    this.inputHandler.setLocationSelectCallback((key) => {\n      this.goToLocation(key);\n    });\n    this.inputHandler.setToggleHelpCallback(() => {\n      this.toggleHelp();\n    });\n    this.inputHandler.setToggleScreenshotModeCallback(() => {\n      this.toggleScreenshotMode();\n    });\n  }\n\n  private setupOverlays(canvas: HTMLCanvasElement): void {\n    const parent = canvas.parentElement;\n    if (!parent) return;\n\n    this.debugOverlay = document.createElement('div');\n    this.debugOverlay.id = 'zoom-debug';\n    parent.appendChild(this.debugOverlay);\n\n    this.shareNotification = document.createElement('div');\n    this.shareNotification.id = 'share-notification';\n    this.shareNotification.style.cssText = `\n      position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);\n      background: rgba(0, 0, 0, 0.85); color: #4ade80; padding: 16px 32px;\n      border-radius: 8px; font-family: system-ui, sans-serif; font-size: 16px;\n      z-index: 1000; opacity: 0; transition: opacity 0.3s ease; pointer-events: none;\n    `;\n    parent.appendChild(this.shareNotification);\n\n    this.helpOverlay = document.createElement('div');\n    this.helpOverlay.id = 'help-overlay';\n    this.helpOverlay.innerHTML = this.createHelpContent();\n    this.helpOverlay.style.cssText = `\n      position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);\n      background: rgba(0, 0, 0, 0.92); color: #e5e5e5; padding: 24px 32px;\n      border-radius: 12px; font-family: system-ui, -apple-system, sans-serif;\n      font-size: 14px; z-index: 1001; opacity: 0; transition: opacity 0.2s ease;\n      pointer-events: none; max-width: 90vw; max-height: 90vh; overflow-y: auto;\n      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5); border: 1px solid rgba(255, 255, 255, 0.1);\n    `;\n    parent.appendChild(this.helpOverlay);\n  }\n\n  private handleResize = (): void => {\n    this.renderer.resize(window.innerWidth, window.innerHeight);\n    this.render();\n  };\n\n  private handleHashChange = (): void => {\n    this.loadBookmark();\n  };\n\n  private render(): void {\n    const device = this.renderer.device;\n    const canvas = this.renderer.canvas;\n\n    const isJulia = isJuliaType(this.fractalType);\n    const maxIter = this.maxIterationsOverride ??\n                    maxIterationsForZoom(this.viewState.zoom, isJulia);\n\n    // Update debug overlay\n    if (this.debugOverlay && !this.screenshotMode) {\n      const z = this.viewState.zoom;\n      const zoomStr = z >= 1e6 ? z.toExponential(2) : z < 1 ? z.toPrecision(4) : String(Math.round(z));\n      const iterSuffix = this.maxIterationsOverride !== null ? ' (manual)' : '';\n      const paletteName = this.paletteType === 'cosine'\n        ? getCosinePaletteName(this.cosinePaletteIndex)\n        : getGradientPaletteName(this.gradientPaletteIndex);\n      const fractalName = FRACTAL_TYPE_NAMES[this.fractalType];\n      const hdrStatus = this.renderer.hdrEnabled\n        ? (Math.abs(this.hdrBrightnessBias) > 0.01\n            ? `HDR (${this.hdrBrightnessBias > 0 ? '+' : ''}${this.hdrBrightnessBias.toFixed(2)})`\n            : 'HDR')\n        : (this.renderer.displaySupportsHDR ? 'HDR available' : 'SDR');\n      // Show SDR gradient brightness if adjusted (only relevant for SDR + gradient)\n      const sdrBrightnessStr = !this.renderer.hdrEnabled && this.paletteType === 'gradient' && Math.abs(this.sdrGradientBrightness - 1.0) > 0.01\n        ? `brightness ${this.sdrGradientBrightness.toFixed(1)}`\n        : '';\n      const juliaStatus = this.juliaPickerMode ? '🎯 Pick Julia point' : '';\n      const juliaCoords = isJulia ? `c=(${this.juliaC[0].toFixed(4)}, ${this.juliaC[1].toFixed(4)})` : '';\n      const colorOffsetStr = Math.abs(this.colorOffset) > 0.001 ? `offset ${this.colorOffset.toFixed(1)}` : '';\n\n      const statusParts = [fractalName, `zoom ${zoomStr}`, `iterations ${maxIter}${iterSuffix}`, paletteName];\n      if (colorOffsetStr) statusParts.push(colorOffsetStr);\n      if (sdrBrightnessStr) statusParts.push(sdrBrightnessStr);\n      if (juliaCoords) statusParts.push(juliaCoords);\n      statusParts.push(hdrStatus);\n      if (juliaStatus) statusParts.push(juliaStatus);\n      statusParts.push('H = help');\n      this.debugOverlay.textContent = statusParts.join('  ·  ');\n    }\n\n    // Update uniforms\n    const uniformData = new ArrayBuffer(UNIFORM_BUFFER_SIZE);\n    const floatView = new Float32Array(uniformData);\n    const intView = new Int32Array(uniformData);\n\n    // Get current palette info and params based on palette type\n    const isCosine = this.paletteType === 'cosine';\n    const palette = isCosine\n      ? getCosinePalette(this.cosinePaletteIndex)\n      : getGradientPalette(this.gradientPaletteIndex);\n    const paletteParams = isCosine\n      ? getCosinePaletteParams(this.cosinePaletteIndex)\n      : getGradientPaletteParams(this.gradientPaletteIndex, this.renderer.hdrEnabled);\n\n    // Pack base uniforms (must match WGSL struct layout with padding)\n    floatView[0] = canvas.width;                    // resolution.x\n    floatView[1] = canvas.height;                   // resolution.y\n    floatView[2] = this.viewState.centerX;          // center.x\n    floatView[3] = this.viewState.centerY;          // center.y\n    floatView[4] = this.viewState.zoom;             // zoom\n    intView[5] = maxIter;                           // maxIterations\n    floatView[6] = performance.now() * 0.001;       // time\n    floatView[7] = this.colorOffset;                // colorOffset\n    intView[8] = this.fractalType;                  // fractalType\n    // padding at 9 (_pad_jc)\n    floatView[10] = this.juliaC[0];                 // juliaC.x\n    floatView[11] = this.juliaC[1];                 // juliaC.y\n    intView[12] = this.renderer.hdrEnabled ? 1 : 0; // hdrEnabled\n    floatView[13] = this.hdrBrightnessBias;         // hdrBrightnessBias\n    intView[14] = paletteParams.type === 'cosine' ? 0 : 1; // paletteType\n    intView[15] = palette.isMonotonic ? 1 : 0;      // isMonotonic\n    floatView[16] = this.sdrGradientBrightness;     // sdrGradientBrightness\n    // padding at 17, 18, 19 (_pad0, _pad1, _pad2)\n\n    // Pack palette parameters (offset 20 = 80 bytes, 16-byte aligned for vec3f)\n    if (paletteParams.type === 'cosine') {\n      // paletteA (vec3 + padding)\n      floatView[20] = paletteParams.a[0];\n      floatView[21] = paletteParams.a[1];\n      floatView[22] = paletteParams.a[2];\n      // padding at 23\n      // paletteB\n      floatView[24] = paletteParams.b[0];\n      floatView[25] = paletteParams.b[1];\n      floatView[26] = paletteParams.b[2];\n      // padding at 27\n      // paletteC\n      floatView[28] = paletteParams.c[0];\n      floatView[29] = paletteParams.c[1];\n      floatView[30] = paletteParams.c[2];\n      // padding at 31\n      // paletteD\n      floatView[32] = paletteParams.d[0];\n      floatView[33] = paletteParams.d[1];\n      floatView[34] = paletteParams.d[2];\n      // padding at 35\n    }\n\n    // Gradient colors start at offset 36 (144 bytes)\n    if (paletteParams.type === 'gradient') {\n      // gradientC1\n      floatView[36] = paletteParams.c1[0];\n      floatView[37] = paletteParams.c1[1];\n      floatView[38] = paletteParams.c1[2];\n      // padding at 39\n      // gradientC2\n      floatView[40] = paletteParams.c2[0];\n      floatView[41] = paletteParams.c2[1];\n      floatView[42] = paletteParams.c2[2];\n      // padding at 43\n      // gradientC3\n      floatView[44] = paletteParams.c3[0];\n      floatView[45] = paletteParams.c3[1];\n      floatView[46] = paletteParams.c3[2];\n      // padding at 47\n      // gradientC4\n      floatView[48] = paletteParams.c4[0];\n      floatView[49] = paletteParams.c4[1];\n      floatView[50] = paletteParams.c4[2];\n      // padding at 51\n      // gradientC5\n      floatView[52] = paletteParams.c5[0];\n      floatView[53] = paletteParams.c5[1];\n      floatView[54] = paletteParams.c5[2];\n      // padding at 55\n    }\n\n    device.queue.writeBuffer(this.uniformBuffer, 0, uniformData);\n\n    // Render\n    const commandEncoder = device.createCommandEncoder();\n    const textureView = this.renderer.getCurrentTexture().createView();\n\n    const renderPass = commandEncoder.beginRenderPass({\n      colorAttachments: [{\n        view: textureView,\n        clearValue: { r: 0, g: 0, b: 0, a: 1 },\n        loadOp: 'clear',\n        storeOp: 'store',\n      }],\n    });\n\n    renderPass.setPipeline(this.pipeline);\n    renderPass.setBindGroup(0, this.bindGroup);\n    renderPass.draw(3); // Fullscreen triangle\n    renderPass.end();\n\n    device.queue.submit([commandEncoder.finish()]);\n  }\n\n  start(): void {\n    this.renderer.start(() => this.render());\n  }\n\n  stop(): void {\n    this.renderer.stop();\n  }\n\n  // --- Iteration controls ---\n\n  private adjustMaxIterations(direction: 1 | -1): void {\n    const isJulia = isJuliaType(this.fractalType);\n    const currentIter = this.maxIterationsOverride ??\n                        maxIterationsForZoom(this.viewState.zoom, isJulia);\n    const newIter = direction > 0\n      ? currentIter * ITERATION_ADJUST_RATIO\n      : currentIter / ITERATION_ADJUST_RATIO;\n    this.maxIterationsOverride = Math.round(Math.max(1, newIter));\n    this.render();\n  }\n\n  private clearMaxIterationsOverride(): void {\n    this.maxIterationsOverride = null;\n    this.render();\n  }\n\n  // --- HDR controls ---\n\n  private toggleHDR(): void {\n    // HDR is controlled by the renderer, we just adjust brightness bias\n    console.log(`HDR is ${this.renderer.hdrEnabled ? 'enabled' : 'not available'}`);\n    this.render();\n  }\n\n  /**\n   * Adjust brightness.\n   * - In HDR mode: adjusts HDR brightness bias\n   * - In SDR mode with gradient palette: adjusts gradient color brightness\n   * @param direction 1 for brighter, -1 for dimmer\n   */\n  private adjustHdrBrightness(direction: 1 | -1): void {\n    if (this.renderer.hdrEnabled) {\n      // HDR mode: adjust HDR brightness bias\n      this.hdrBrightnessBias = Math.max(-1, Math.min(1, this.hdrBrightnessBias + direction * 0.1));\n    } else if (this.paletteType === 'gradient') {\n      // SDR mode with gradient palette: adjust gradient brightness\n      // Adjust by 0.2 each step, clamped to 0.1 to 5.0\n      this.sdrGradientBrightness = Math.max(0.1, Math.min(10.0, this.sdrGradientBrightness + direction * 0.2));\n    }\n    // Cosine palettes in SDR mode: do nothing (no effect)\n    this.render();\n  }\n\n  /**\n   * Reset brightness to default.\n   * - Resets HDR brightness bias to 0\n   * - Resets SDR gradient brightness to 1.0\n   */\n  private resetHdrBrightness(): void {\n    this.hdrBrightnessBias = 0;\n    this.sdrGradientBrightness = 1.0;\n    this.render();\n  }\n\n  // --- Palette controls ---\n\n  private cycleCosinePalette(direction: 1 | -1): void {\n    this.cosinePaletteIndex = (this.cosinePaletteIndex + direction + COSINE_PALETTE_COUNT) % COSINE_PALETTE_COUNT;\n    this.paletteType = 'cosine';\n    this.render();\n  }\n\n  private cycleGradientPalette(direction: 1 | -1): void {\n    this.gradientPaletteIndex = (this.gradientPaletteIndex + direction + GRADIENT_PALETTE_COUNT) % GRADIENT_PALETTE_COUNT;\n    this.paletteType = 'gradient';\n    this.render();\n  }\n\n  private adjustColorOffset(delta: number): void {\n    this.colorOffset += delta;\n    this.render();\n  }\n\n  private resetColorOffset(): void {\n    this.colorOffset = 0;\n    this.render();\n  }\n\n  // --- Fractal type controls ---\n\n  private cycleFractalType(direction: 1 | -1 = 1): void {\n    // Get the base fractal type (non-Julia) using bitwise: base = type & ~1\n    const baseType = getBaseFractalType(this.fractalType);\n    // Base types are even: 0, 2, 4, 6, 8, 10, 12, 14, 16\n    // Divide by 2 to get the index: 0, 1, 2, 3, 4, 5, 6, 7, 8\n    const currentIndex = baseType >> 1;\n    const nextIndex = (currentIndex + direction + BASE_FRACTAL_COUNT) % BASE_FRACTAL_COUNT;\n    // Multiply by 2 to get the new base type\n    this.fractalType = (nextIndex << 1) as FractalType;\n\n    if (this.juliaPickerMode) {\n      this.juliaPickerMode = false;\n      this.inputHandler.setJuliaPickerMode(false);\n    }\n    this.render();\n  }\n\n  private toggleJuliaPickerMode(): void {\n    if (isJuliaType(this.fractalType)) {\n      this.exitJuliaMode();\n      return;\n    }\n    this.juliaPickerMode = !this.juliaPickerMode;\n    this.inputHandler.setJuliaPickerMode(this.juliaPickerMode);\n    this.render();\n  }\n\n  private pickJuliaConstant(fractalX: number, fractalY: number): void {\n    if (!this.juliaPickerMode) return;\n\n    this.savedViewState = {\n      centerX: this.viewState.centerX,\n      centerY: this.viewState.centerY,\n      zoom: this.viewState.zoom,\n    };\n    this.savedFractalType = this.fractalType;\n\n    this.juliaC = [fractalX, fractalY];\n    this.fractalType = getJuliaVariant(this.fractalType);\n\n    this.viewState.centerX = 0;\n    this.viewState.centerY = 0;\n    this.viewState.zoom = 0.5;\n\n    this.juliaPickerMode = false;\n    this.inputHandler.setJuliaPickerMode(false);\n    this.render();\n  }\n\n  private exitJuliaMode(): void {\n    if (this.savedViewState) {\n      this.viewState.centerX = this.savedViewState.centerX;\n      this.viewState.centerY = this.savedViewState.centerY;\n      this.viewState.zoom = this.savedViewState.zoom;\n      this.savedViewState = null;\n    }\n    if (this.savedFractalType !== null) {\n      this.fractalType = this.savedFractalType;\n      this.savedFractalType = null;\n    } else {\n      // Fall back to base fractal type\n      this.fractalType = getBaseFractalType(this.fractalType);\n    }\n    this.juliaPickerMode = false;\n    this.inputHandler.setJuliaPickerMode(false);\n    this.render();\n  }\n\n  // --- Bookmarks ---\n\n  private getBookmarkState(): BookmarkState {\n    return {\n      fractalType: this.fractalType,\n      centerX: this.viewState.centerX,\n      centerY: this.viewState.centerY,\n      zoom: this.viewState.zoom,\n      paletteType: this.paletteType,\n      cosinePaletteIndex: this.cosinePaletteIndex,\n      gradientPaletteIndex: this.gradientPaletteIndex,\n      colorOffset: this.colorOffset,\n      juliaC: this.juliaC,\n      maxIterationsOverride: this.maxIterationsOverride,\n      aaEnabled: false, // AA not supported in WebGPU version\n    };\n  }\n\n  private loadBookmark(): void {\n    const bookmark = readUrlBookmark();\n    if (!bookmark) return;\n\n    if (bookmark.centerX !== undefined) this.viewState.centerX = bookmark.centerX;\n    if (bookmark.centerY !== undefined) this.viewState.centerY = bookmark.centerY;\n    if (bookmark.zoom !== undefined) this.viewState.zoom = bookmark.zoom;\n    if (bookmark.maxIterationsOverride !== undefined) {\n      this.maxIterationsOverride = bookmark.maxIterationsOverride;\n    }\n\n    // New palette parameters\n    if (bookmark.paletteType !== undefined) {\n      this.paletteType = bookmark.paletteType;\n    }\n    if (bookmark.cosinePaletteIndex !== undefined) {\n      this.cosinePaletteIndex = bookmark.cosinePaletteIndex % COSINE_PALETTE_COUNT;\n    }\n    if (bookmark.gradientPaletteIndex !== undefined) {\n      this.gradientPaletteIndex = bookmark.gradientPaletteIndex % GRADIENT_PALETTE_COUNT;\n    }\n\n    // Legacy: handle old paletteIndex if present (for backward compatibility)\n    // This is a best-effort mapping - old URLs will get close-ish results\n    if (bookmark.paletteIndex !== undefined && bookmark.paletteType === undefined) {\n      // Old palette indices: 0=Rainbow, 1=Blue, 2=Gold, 3=Grayscale, 4=Fire, 5=Ice,\n      // 6=Sepia, 7=Ocean, 8=Purple, 9=Forest, 10=Sunset, 11=Electric\n      // Cosine: Rainbow(0), Fire(4), Ice(5), Sunset(10), Electric(11)\n      // Gradient: Blue(1), Gold(2), Grayscale(3), Sepia(6), Ocean(7), Purple(8), Forest(9)\n      const cosineIndices = [0, 4, 5, 10, 11];\n      if (cosineIndices.includes(bookmark.paletteIndex)) {\n        this.paletteType = 'cosine';\n        this.cosinePaletteIndex = cosineIndices.indexOf(bookmark.paletteIndex);\n      } else {\n        this.paletteType = 'gradient';\n        const gradientIndices = [1, 2, 3, 6, 7, 8, 9];\n        this.gradientPaletteIndex = gradientIndices.indexOf(bookmark.paletteIndex);\n      }\n    }\n\n    if (bookmark.colorOffset !== undefined) {\n      this.colorOffset = bookmark.colorOffset;\n    }\n    if (bookmark.fractalType !== undefined) {\n      this.fractalType = bookmark.fractalType;\n    }\n    if (bookmark.juliaC !== undefined) {\n      this.juliaC = bookmark.juliaC;\n    }\n\n    this.render();\n  }\n\n  private goToLocation(key: string): void {\n    const location = getLocationByKey(key, this.fractalType);\n    if (!location) return;\n\n    const state = location.state;\n    this.viewState.centerX = state.centerX;\n    this.viewState.centerY = state.centerY;\n    this.viewState.zoom = state.zoom;\n    this.maxIterationsOverride = state.maxIterationsOverride;\n    this.fractalType = state.fractalType;\n    this.juliaC = state.juliaC;\n    this.paletteType = state.paletteType;\n    this.cosinePaletteIndex = state.cosinePaletteIndex;\n    this.gradientPaletteIndex = state.gradientPaletteIndex;\n    this.colorOffset = state.colorOffset;\n\n    this.showLocationNotification(location.name, location.description);\n    this.updateUrlBookmark();\n    this.render();\n  }\n\n  private showLocationNotification(name: string, description: string): void {\n    if (!this.shareNotification) return;\n    this.shareNotification.innerHTML = `<strong style=\"font-size: 18px;\">📍 ${name}</strong><br><span style=\"color: #aaa; font-size: 14px;\">${description}</span>`;\n    this.shareNotification.style.color = '#60a5fa';\n    this.shareNotification.style.opacity = '1';\n    setTimeout(() => {\n      if (this.shareNotification) {\n        this.shareNotification.style.opacity = '0';\n      }\n    }, 2500);\n  }\n\n  private updateUrlBookmark(): void {\n    updateUrlHash(this.getBookmarkState());\n  }\n\n  async shareBookmark(): Promise<void> {\n    const success = await copyShareableUrl(this.getBookmarkState());\n    this.showShareNotification(success);\n    if (success) {\n      this.updateUrlBookmark();\n    }\n\n    // On localhost, also print createLocation() code for easy copy-paste\n    if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {\n      this.logCreateLocationCode();\n    }\n  }\n\n  /**\n   * Log a ready-to-paste createLocation() call to the console.\n   * Only useful during development for curating famous locations.\n   */\n  private logCreateLocationCode(): void {\n    const fractalTypeName = this.getFractalTypeEnumName(this.fractalType);\n    const isJulia = isJuliaType(this.fractalType);\n\n    // Build options object, only including non-default values\n    const options: string[] = [];\n\n    if (this.paletteType === 'gradient') {\n      options.push(`paletteType: 'gradient'`);\n      if (this.gradientPaletteIndex !== 0) {\n        options.push(`gradientPaletteIndex: ${this.gradientPaletteIndex}`);\n      }\n    } else {\n      // Cosine palette (default type)\n      if (this.cosinePaletteIndex !== 1) {\n        options.push(`cosinePaletteIndex: ${this.cosinePaletteIndex}`);\n      }\n    }\n\n    if (Math.abs(this.colorOffset) > 0.001) {\n      options.push(`colorOffset: ${this.colorOffset}`);\n    }\n\n    if (isJulia) {\n      options.push(`juliaC: [${this.juliaC[0]}, ${this.juliaC[1]}]`);\n    }\n\n    if (this.maxIterationsOverride !== null) {\n      options.push(`maxIterationsOverride: ${this.maxIterationsOverride}`);\n    }\n\n    const optionsStr = options.length > 0\n      ? `,\\n    { ${options.join(', ')} }`\n      : '';\n\n    const code = `createLocation(\n    'TODO: Name',\n    'TODO: Description',\n    'TODO: Key (1-9)',\n    FractalType.${fractalTypeName},\n    ${this.viewState.centerX}, ${this.viewState.centerY}, ${this.viewState.zoom}${optionsStr}\n  ),`;\n\n    console.log('%c📍 createLocation() code:', 'color: #4ade80; font-weight: bold; font-size: 14px;');\n    console.log(code);\n  }\n\n  /**\n   * Get the enum key name for a FractalType value.\n   */\n  private getFractalTypeEnumName(type: FractalType): string {\n    // Reverse lookup in FractalType enum\n    const entries = Object.entries(FractalType);\n    for (const [key, value] of entries) {\n      if (value === type && isNaN(Number(key))) {\n        return key;\n      }\n    }\n    return `Unknown(${type})`;\n  }\n\n  private showShareNotification(success: boolean): void {\n    if (!this.shareNotification) return;\n    this.shareNotification.textContent = success\n      ? '📋 Link copied to clipboard!'\n      : '❌ Failed to copy link';\n    this.shareNotification.style.color = success ? '#4ade80' : '#f87171';\n    this.shareNotification.style.opacity = '1';\n    setTimeout(() => {\n      if (this.shareNotification) {\n        this.shareNotification.style.opacity = '0';\n      }\n    }, 2000);\n  }\n\n  // --- UI toggles ---\n\n  private toggleHelp(): void {\n    this.helpVisible = !this.helpVisible;\n    if (this.helpOverlay) {\n      this.helpOverlay.style.opacity = this.helpVisible ? '1' : '0';\n      this.helpOverlay.style.pointerEvents = this.helpVisible ? 'auto' : 'none';\n    }\n  }\n\n  private toggleScreenshotMode(): void {\n    this.screenshotMode = !this.screenshotMode;\n    if (this.screenshotMode && this.helpVisible) {\n      this.helpVisible = false;\n      if (this.helpOverlay) {\n        this.helpOverlay.style.opacity = '0';\n        this.helpOverlay.style.pointerEvents = 'none';\n      }\n    }\n    if (this.debugOverlay) {\n      this.debugOverlay.style.display = this.screenshotMode ? 'none' : 'block';\n    }\n    if (this.shareNotification) {\n      this.shareNotification.textContent = this.screenshotMode\n        ? '📷 Screenshot mode (Space to exit)'\n        : '📷 UI restored';\n      this.shareNotification.style.color = '#60a5fa';\n      this.shareNotification.style.opacity = '1';\n      setTimeout(() => {\n        if (this.shareNotification) {\n          this.shareNotification.style.opacity = '0';\n        }\n      }, 1000);\n    }\n  }\n\n  private createHelpContent(): string {\n    return `\n      <h2 style=\"margin: 0 0 16px 0; color: #60a5fa; font-size: 20px; font-weight: 600;\">\n        🌀 Fractal Explorer - Keyboard Shortcuts\n      </h2>\n      <div style=\"display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px 32px;\">\n        <div style=\"margin-bottom: 12px;\">\n          <h3 style=\"margin: 0 0 8px 0; color: #a78bfa; font-size: 13px; text-transform: uppercase;\">Navigation</h3>\n          <div style=\"display: grid; gap: 4px;\">\n            ${this.helpRow('Drag', 'Pan view')}\n            ${this.helpRow('Scroll', 'Zoom in/out')}\n            ${this.helpRow('z / Z', 'Fine zoom (hold)')}\n            ${this.helpRow('Double-click', 'Zoom in at point')}\n            ${this.helpRow('1-9', 'Famous locations')}\n          </div>\n        </div>\n        <div style=\"margin-bottom: 12px;\">\n          <h3 style=\"margin: 0 0 8px 0; color: #a78bfa; font-size: 13px; text-transform: uppercase;\">Iterations</h3>\n          <div style=\"display: grid; gap: 4px;\">\n            ${this.helpRow('+/-', 'Adjust iterations')}\n            ${this.helpRow('0', 'Reset to auto')}\n          </div>\n        </div>\n        <div style=\"margin-bottom: 12px;\">\n          <h3 style=\"margin: 0 0 8px 0; color: #a78bfa; font-size: 13px; text-transform: uppercase;\">Colors</h3>\n          <div style=\"display: grid; gap: 4px;\">\n            ${this.helpRow('C / Shift+C', 'Cosine palettes')}\n            ${this.helpRow('G / Shift+G', 'Gradient palettes')}\n            ${this.helpRow(', / .', 'Shift colors (fine)')}\n            ${this.helpRow('< / >', 'Shift colors (coarse)')}\n            ${this.helpRow('R', 'Reset color offset')}\n          </div>\n        </div>\n        <div style=\"margin-bottom: 12px;\">\n          <h3 style=\"margin: 0 0 8px 0; color: #a78bfa; font-size: 13px; text-transform: uppercase;\">Fractal Type</h3>\n          <div style=\"display: grid; gap: 4px;\">\n            ${this.helpRow('F / Shift+F', 'Cycle fractals')}\n            ${this.helpRow('J', 'Julia picker mode')}\n          </div>\n        </div>\n        <div style=\"margin-bottom: 12px;\">\n          <h3 style=\"margin: 0 0 8px 0; color: #a78bfa; font-size: 13px; text-transform: uppercase;\">Brightness</h3>\n          <div style=\"display: grid; gap: 4px;\">\n            ${this.helpRow('B / Shift+B', 'Adjust brightness*')}\n            ${this.helpRow('D', 'Reset brightness')}\n          </div>\n          <div style=\"color: #888; font-size: 10px; margin-top: 4px;\">*HDR bias or SDR gradient brightness</div>\n        </div>\n        <div style=\"margin-bottom: 12px;\">\n          <h3 style=\"margin: 0 0 8px 0; color: #a78bfa; font-size: 13px; text-transform: uppercase;\">UI</h3>\n          <div style=\"display: grid; gap: 4px;\">\n            ${this.helpRow('H', 'Toggle this help')}\n            ${this.helpRow('Space', 'Screenshot mode')}\n          </div>\n        </div>\n        <div style=\"margin-bottom: 12px;\">\n          <h3 style=\"margin: 0 0 8px 0; color: #a78bfa; font-size: 13px; text-transform: uppercase;\">Share</h3>\n          <div style=\"display: grid; gap: 4px;\">\n            ${this.helpRow('S', 'Copy bookmark URL')}\n          </div>\n        </div>\n      </div>\n      <div style=\"margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.1); color: #888; font-size: 12px; text-align: center;\">\n        Press <kbd style=\"background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px;\">H</kbd> to close\n      </div>\n    `;\n  }\n\n  private helpRow(key: string, description: string): string {\n    return `\n      <div style=\"display: flex; align-items: baseline; gap: 8px;\">\n        <kbd style=\"background: rgba(255,255,255,0.1); color: #f0f0f0; padding: 2px 8px; border-radius: 4px; font-family: ui-monospace, monospace; font-size: 12px; min-width: 60px; text-align: center;\">${key}</kbd>\n        <span style=\"color: #ccc;\">${description}</span>\n      </div>\n    `;\n  }\n\n  destroy(): void {\n    this.stop();\n    window.removeEventListener('resize', this.handleResize);\n    window.removeEventListener('hashchange', this.handleHashChange);\n    this.debugOverlay?.remove();\n    this.shareNotification?.remove();\n    this.helpOverlay?.remove();\n    this.inputHandler.destroy();\n    this.renderer.destroy();\n  }\n}\n","/**\n * Fractal Explorer - Main Entry Point\n *\n * \"This is where the magic begins. You're welcome.\"\n * - Skippy the Magnificent\n */\n\nimport { WebGPUFractalEngine } from './fractal/WebGPUFractalEngine';\nimport { WebGPURenderer } from './renderer/WebGPURenderer';\n\nconsole.log('Fractal Explorer - Initializing...');\n\nlet engine: WebGPUFractalEngine | null = null;\n\nasync function init(): Promise<void> {\n  const app = document.getElementById('app');\n  if (!app) {\n    console.error('Could not find #app element');\n    return;\n  }\n\n  // Check WebGPU support\n  if (!WebGPURenderer.isSupported()) {\n    app.innerHTML = `\n      <div style=\"color: white; text-align: center; padding: 40px; font-family: system-ui, sans-serif;\">\n        <h1>WebGPU Not Supported</h1>\n        <p>This application requires WebGPU, which is not available in your browser.</p>\n        <p style=\"margin-top: 20px; color: #888;\">\n          Please use a modern browser with WebGPU support:<br>\n          Chrome 113+, Edge 113+, or Firefox Nightly with WebGPU enabled.\n        </p>\n      </div>\n    `;\n    return;\n  }\n\n  // Create canvas element\n  const canvas = document.createElement('canvas');\n  canvas.id = 'fractal-canvas';\n  app.appendChild(canvas);\n\n  try {\n    engine = await WebGPUFractalEngine.create(canvas);\n    engine.start();\n\n    console.log('Fractal Explorer initialized successfully');\n    console.log('Controls:');\n    console.log('  - Drag to pan');\n    console.log('  - Scroll to zoom');\n    console.log('  - Double-click to zoom in');\n    console.log('  - Touch drag to pan (mobile)');\n    console.log('  - Pinch to zoom (mobile)');\n    console.log('  - + / - to adjust max iterations');\n    console.log('  - 0 to reset iterations to auto-scaling');\n    console.log('  - c / C to cycle cosine palettes (forward/backward)');\n    console.log('  - g / G to cycle gradient palettes (forward/backward)');\n    console.log('  - , / . to shift colors (fine)');\n    console.log('  - < / > to shift colors (coarse)');\n    console.log('  - b / B to adjust brightness (HDR bias or SDR gradient)');\n    console.log('  - d to reset brightness');\n    console.log('  - s to share/copy bookmark URL');\n    console.log('  - 1-9 to visit famous locations');\n    console.log('  - h to toggle help overlay');\n    console.log('  - Space to toggle screenshot mode');\n  } catch (error) {\n    console.error('Failed to initialize Fractal Explorer:', error);\n    app.innerHTML = `\n      <div style=\"color: white; text-align: center; padding: 20px; font-family: system-ui, sans-serif;\">\n        <h1>Initialization Error</h1>\n        <p>Failed to initialize the application.</p>\n        <pre style=\"text-align: left; margin-top: 20px; color: #ff6b6b;\">${error instanceof Error ? error.message : String(error)}</pre>\n      </div>\n    `;\n  }\n}\n\n// Initialize when DOM is ready\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', () => init());\n} else {\n  init();\n}\n\n// Cleanup on page unload\nwindow.addEventListener('beforeunload', () => {\n  if (engine) {\n    engine.destroy();\n  }\n});\n"],"names":["WebGPURenderer","canvas","__publicField","renderer","adapter","info","preferredFormat","e","width","height","dpr","renderCallback","loop","handleChange","newHdrSupport","callback","ViewState","centerX","centerY","zoom","deltaX","deltaY","screenWidth","screenHeight","fractalDeltaX","fractalDeltaY","screenX","screenY","factor","fractalX","fractalY","newFractalX","newFractalY","aspect","uvX","uvY","ZOOM_SENSITIVITY","scaleZoomFactor","InputHandler","viewState","onChange","_callback","enabled","clientX","clientY","rect","x","y","raw","zoomFactor","touches","dx","dy","distance","center","direction","currentTime","elapsed","zoomExponent","FractalType","FRACTAL_TYPE_NAMES","BASE_FRACTAL_COUNT","isJuliaType","type","getBaseFractalType","getJuliaVariant","PARAM","encodeNumber","n","precision","decodeNumber","s","encodeBookmark","state","params","decodeBookmark","hash","z","pt","cp","gp","p","o","jr","ji","i","getShareableUrl","url","updateUrlHash","readUrlBookmark","copyShareableUrl","textArea","createLocation","name","description","key","fractalType","options","MANDELBROT_LOCATIONS","BURNING_SHIP_LOCATIONS","TRICORN_LOCATIONS","CELTIC_LOCATIONS","BUFFALO_LOCATIONS","PHOENIX_LOCATIONS","MULTIBROT3_LOCATIONS","MULTIBROT4_LOCATIONS","FUNKY_LOCATIONS","PERPENDICULAR_LOCATIONS","LOCATIONS_BY_FRACTAL","getLocationByKey","currentFractalType","baseType","locations","loc","COSINE_PALETTES","GRADIENT_PALETTES","COSINE_PALETTE_COUNT","GRADIENT_PALETTE_COUNT","getCosinePaletteParams","index","getGradientPaletteParams","hdr","palette","getCosinePalette","getGradientPalette","getCosinePaletteName","getGradientPaletteName","shaderSource","MAX_ITERATIONS_BASE","MAX_ITERATIONS_BASE_JULIA","MAX_ITERATIONS_AUTO_CAP","MAX_ITERATIONS_LOG_SCALE","MAX_ITERATIONS_LOG_POWER","ITERATION_ADJUST_RATIO","maxIterationsForZoom","isJulia","L","base","UNIFORM_BUFFER_SIZE","WebGPUFractalEngine","engine","device","shaderModule","bindGroupLayout","pipelineLayout","delta","parent","maxIter","zoomStr","iterSuffix","paletteName","fractalName","hdrStatus","sdrBrightnessStr","juliaStatus","juliaCoords","colorOffsetStr","statusParts","uniformData","floatView","intView","isCosine","paletteParams","commandEncoder","textureView","renderPass","currentIter","newIter","nextIndex","bookmark","cosineIndices","gradientIndices","location","success","fractalTypeName","optionsStr","code","entries","value","init","app","error"],"mappings":"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"}