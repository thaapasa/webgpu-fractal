{"version":3,"file":"index-WNzsr3jQ.js","sources":["../../src/renderer/WebGLRenderer.ts","../../src/renderer/ShaderProgram.ts","../../src/controls/ViewState.ts","../../src/controls/InputHandler.ts","../../src/types.ts","../../src/bookmark/BookmarkManager.ts","../../src/bookmark/famousLocations.ts","../../src/renderer/shaders/mandelbrot.vert.glsl?raw","../../src/renderer/shaders/mandelbrot.frag.glsl?raw","../../src/renderer/shaders/aa-post.frag.glsl?raw","../../src/fractal/FractalEngine.ts","../../src/main.ts"],"sourcesContent":["/**\n * WebGL Renderer - Manages WebGL 2 context and canvas\n *\n * \"The foundation of everything. Obviously.\"\n * - Skippy the Magnificent\n */\n\nexport class WebGLRenderer {\n  public readonly gl: WebGL2RenderingContext;\n  public readonly canvas: HTMLCanvasElement;\n  private animationFrameId: number | null = null;\n  private renderCallback: (() => void) | null = null;\n\n  constructor(canvas: HTMLCanvasElement) {\n    this.canvas = canvas;\n    \n    const gl = canvas.getContext('webgl2', {\n      antialias: false, // Better performance for our use case\n      depth: false, // We don't need depth buffer\n      stencil: false, // We don't need stencil buffer\n      alpha: false, // We don't need transparency\n      preserveDrawingBuffer: false, // Better performance\n      powerPreference: 'high-performance', // Prefer discrete GPU if available\n    });\n\n    if (!gl) {\n      throw new Error('WebGL 2 is not supported in this browser');\n    }\n\n    this.gl = gl;\n\n    // Handle context loss\n    canvas.addEventListener('webglcontextlost', (e) => {\n      e.preventDefault();\n      this.stop();\n      console.warn('WebGL context lost');\n    });\n\n    canvas.addEventListener('webglcontextrestored', () => {\n      console.log('WebGL context restored');\n      // Context will be recreated, but we'll need to reinitialize shaders\n    });\n  }\n\n  /**\n   * Resize the canvas to match the given dimensions\n   */\n  resize(width: number, height: number): void {\n    const dpr = window.devicePixelRatio || 1;\n    this.canvas.width = width * dpr;\n    this.canvas.height = height * dpr;\n    this.canvas.style.width = `${width}px`;\n    this.canvas.style.height = `${height}px`;\n    this.gl.viewport(0, 0, this.canvas.width, this.canvas.height);\n  }\n\n  /**\n   * Clear the canvas to the specified color\n   */\n  clear(r: number = 0, g: number = 0, b: number = 0, a: number = 1): void {\n    this.gl.clearColor(r, g, b, a);\n    this.gl.clear(this.gl.COLOR_BUFFER_BIT);\n  }\n\n  /**\n   * Start the render loop\n   */\n  start(renderCallback: () => void): void {\n    if (this.animationFrameId !== null) {\n      return; // Already running\n    }\n    \n    this.renderCallback = renderCallback;\n    const loop = () => {\n      if (this.renderCallback) {\n        this.renderCallback();\n      }\n      this.animationFrameId = requestAnimationFrame(loop);\n    };\n    this.animationFrameId = requestAnimationFrame(loop);\n  }\n\n  /**\n   * Stop the render loop\n   */\n  stop(): void {\n    if (this.animationFrameId !== null) {\n      cancelAnimationFrame(this.animationFrameId);\n      this.animationFrameId = null;\n    }\n    this.renderCallback = null;\n  }\n\n  /**\n   * Clean up resources\n   */\n  destroy(): void {\n    this.stop();\n    // WebGL context cleanup happens automatically when canvas is removed\n  }\n}\n","/**\n * Shader Program - Compiles, links, and manages GLSL shaders\n *\n * \"Shader compilation. Because apparently GPUs don't speak TypeScript.\"\n * - Skippy the Magnificent\n */\n\nimport type { UniformValue } from '../types';\n\nexport class ShaderProgram {\n  public readonly program: WebGLProgram;\n  private gl: WebGL2RenderingContext;\n  private uniformLocations: Map<string, WebGLUniformLocation | null> = new Map();\n  private warnedUniforms: Set<string> = new Set();\n\n  constructor(\n    gl: WebGL2RenderingContext,\n    vertexSource: string,\n    fragmentSource: string\n  ) {\n    this.gl = gl;\n\n    const vertexShader = this.compileShader(gl.VERTEX_SHADER, vertexSource);\n    const fragmentShader = this.compileShader(gl.FRAGMENT_SHADER, fragmentSource);\n\n    this.program = this.linkProgram(vertexShader, fragmentShader);\n\n    // Clean up shaders (they're linked into the program now)\n    gl.deleteShader(vertexShader);\n    gl.deleteShader(fragmentShader);\n  }\n\n  /**\n   * Compile a shader from source\n   */\n  private compileShader(type: number, source: string): WebGLShader {\n    const shader = this.gl.createShader(type);\n    if (!shader) {\n      throw new Error(`Failed to create ${type === this.gl.VERTEX_SHADER ? 'vertex' : 'fragment'} shader`);\n    }\n\n    this.gl.shaderSource(shader, source);\n    this.gl.compileShader(shader);\n\n    if (!this.gl.getShaderParameter(shader, this.gl.COMPILE_STATUS)) {\n      const info = this.gl.getShaderInfoLog(shader);\n      const shaderType = type === this.gl.VERTEX_SHADER ? 'VERTEX' : 'FRAGMENT';\n      const error = `Shader compilation error (${shaderType}):\\n${info}\\n\\nShader source:\\n${source}`;\n      this.gl.deleteShader(shader);\n      throw new Error(error);\n    }\n\n    return shader;\n  }\n\n  /**\n   * Link vertex and fragment shaders into a program\n   */\n  private linkProgram(vertexShader: WebGLShader, fragmentShader: WebGLShader): WebGLProgram {\n    const program = this.gl.createProgram();\n    if (!program) {\n      throw new Error('Failed to create shader program');\n    }\n\n    this.gl.attachShader(program, vertexShader);\n    this.gl.attachShader(program, fragmentShader);\n    this.gl.linkProgram(program);\n\n    if (!this.gl.getProgramParameter(program, this.gl.LINK_STATUS)) {\n      const info = this.gl.getProgramInfoLog(program);\n      this.gl.deleteProgram(program);\n      throw new Error(`Program linking error:\\n${info}`);\n    }\n\n    return program;\n  }\n\n  /**\n   * Get uniform location (cached)\n   */\n  private getUniformLocation(name: string): WebGLUniformLocation | null {\n    if (this.uniformLocations.has(name)) {\n      return this.uniformLocations.get(name)!;\n    }\n\n    const location = this.gl.getUniformLocation(this.program, name);\n    this.uniformLocations.set(name, location);\n    return location;\n  }\n\n  /**\n   * Warn once per missing uniform (avoids spamming the console every frame)\n   */\n  private warnMissingUniform(name: string): void {\n    if (!this.warnedUniforms.has(name)) {\n      this.warnedUniforms.add(name);\n      console.warn(`Uniform \"${name}\" not found in shader program (may be optimized out)`);\n    }\n  }\n\n  /**\n   * Use this shader program\n   */\n  use(): void {\n    this.gl.useProgram(this.program);\n  }\n\n  /**\n   * Set a uniform value\n   */\n  setUniform(name: string, value: UniformValue): void {\n    const location = this.getUniformLocation(name);\n    if (location === null) {\n      this.warnMissingUniform(name);\n      return;\n    }\n\n    if (typeof value === 'number') {\n      this.gl.uniform1f(location, value);\n    } else if (value.length === 2) {\n      this.gl.uniform2f(location, value[0], value[1]);\n    } else if (value.length === 3) {\n      this.gl.uniform3f(location, value[0], value[1], value[2]);\n    } else if (value.length === 4) {\n      this.gl.uniform4f(location, value[0], value[1], value[2], value[3]);\n    }\n  }\n\n  /**\n   * Set an integer uniform (for u_maxIterations)\n   */\n  setUniformInt(name: string, value: number): void {\n    const location = this.getUniformLocation(name);\n    if (location === null) {\n      this.warnMissingUniform(name);\n      return;\n    }\n    this.gl.uniform1i(location, value);\n  }\n\n  /**\n   * Clean up resources\n   */\n  destroy(): void {\n    this.gl.deleteProgram(this.program);\n    this.uniformLocations.clear();\n    this.warnedUniforms.clear();\n  }\n}\n","/**\n * View State - Manages the current viewport (pan and zoom)\n *\n * \"Coordinate transformations. Because apparently you monkeys can't do math.\"\n * - Skippy the Magnificent\n */\n\nimport type { ViewState as IViewState } from '../types';\n\nexport class ViewState implements IViewState {\n  public centerX: number;\n  public centerY: number;\n  public zoom: number;\n\n  /**\n   * Create a new view state\n   * @param centerX Real component of center (-2.5 to 1.0 typical)\n   * @param centerY Imaginary component of center (-1.5 to 1.5 typical)\n   * @param zoom Zoom factor (1.0 = full set visible)\n   */\n  constructor(centerX: number = -0.5, centerY: number = 0.0, zoom: number = 0.4) {\n    this.centerX = centerX;\n    this.centerY = centerY;\n    this.zoom = zoom;\n  }\n\n  /**\n   * Pan the view by screen pixels\n   * @param deltaX Pixels to pan horizontally (positive = right)\n   * @param deltaY Pixels to pan vertically (positive = down)\n   * @param screenWidth Screen width in pixels\n   * @param screenHeight Screen height in pixels\n   */\n  pan(deltaX: number, deltaY: number, screenWidth: number, screenHeight: number): void {\n    // Convert screen pixel delta to fractal coordinate delta\n    const fractalDeltaX = -deltaX / (this.zoom * screenWidth);\n    const fractalDeltaY = deltaY / (this.zoom * screenHeight);\n    \n    this.centerX += fractalDeltaX;\n    this.centerY += fractalDeltaY;\n  }\n\n  /**\n   * Zoom centered on a specific screen point\n   * @param screenX Screen X coordinate (0 to screenWidth)\n   * @param screenY Screen Y coordinate (0 to screenHeight)\n   * @param factor Zoom factor (> 1 = zoom in, < 1 = zoom out)\n   * @param screenWidth Screen width in pixels\n   * @param screenHeight Screen height in pixels\n   */\n  zoomAt(\n    screenX: number,\n    screenY: number,\n    factor: number,\n    screenWidth: number,\n    screenHeight: number\n  ): void {\n    // Convert screen point to fractal coordinates before zoom\n    const fractalX = this.centerX + (screenX / screenWidth - 0.5) / this.zoom;\n    const fractalY = this.centerY - (screenY / screenHeight - 0.5) / this.zoom;\n    \n    // Apply zoom\n    this.zoom *= factor;\n    \n    // Clamp zoom to reasonable limits\n    this.zoom = Math.max(0.1, Math.min(this.zoom, 1e15));\n    \n    // Adjust center so the point under cursor stays fixed\n    const newFractalX = this.centerX + (screenX / screenWidth - 0.5) / this.zoom;\n    const newFractalY = this.centerY - (screenY / screenHeight - 0.5) / this.zoom;\n    \n    this.centerX += fractalX - newFractalX;\n    this.centerY += fractalY - newFractalY;\n  }\n\n  /**\n   * Convert screen coordinates to fractal coordinates\n   * @param screenX Screen X coordinate (0 to screenWidth)\n   * @param screenY Screen Y coordinate (0 to screenHeight)\n   * @param screenWidth Screen width in pixels\n   * @param screenHeight Screen height in pixels\n   */\n  toFractalCoords(screenX: number, screenY: number, screenWidth: number, screenHeight: number): [number, number] {\n    const aspect = screenWidth / screenHeight;\n    const uvX = (screenX / screenWidth - 0.5) * aspect;\n    const uvY = screenY / screenHeight - 0.5;\n    const fractalX = this.centerX + uvX / this.zoom;\n    const fractalY = this.centerY - uvY / this.zoom;\n    return [fractalX, fractalY];\n  }\n\n  /**\n   * Convert fractal coordinates to screen coordinates\n   * @param fractalX Fractal X coordinate\n   * @param fractalY Fractal Y coordinate\n   * @param screenWidth Screen width in pixels\n   * @param screenHeight Screen height in pixels\n   */\n  toScreenCoords(fractalX: number, fractalY: number, screenWidth: number, screenHeight: number): [number, number] {\n    const aspect = screenWidth / screenHeight;\n    const uvX = (fractalX - this.centerX) * this.zoom;\n    const uvY = (fractalY - this.centerY) * this.zoom;\n    const screenX = (uvX / aspect + 0.5) * screenWidth;\n    const screenY = (-uvY + 0.5) * screenHeight;\n    return [screenX, screenY];\n  }\n\n  /**\n   * Center on a screen point and then zoom in\n   * @param screenX Screen X coordinate (0 to screenWidth)\n   * @param screenY Screen Y coordinate (0 to screenHeight)\n   * @param factor Zoom factor (> 1 = zoom in, < 1 = zoom out)\n   * @param screenWidth Screen width in pixels\n   * @param screenHeight Screen height in pixels\n   */\n  zoomToPoint(\n    screenX: number,\n    screenY: number,\n    factor: number,\n    screenWidth: number,\n    screenHeight: number\n  ): void {\n    // Convert screen point to fractal coordinates and center on it\n    const [fractalX, fractalY] = this.toFractalCoords(screenX, screenY, screenWidth, screenHeight);\n    this.centerX = fractalX;\n    this.centerY = fractalY;\n\n    // Apply zoom\n    this.zoom *= factor;\n\n    // Clamp zoom to reasonable limits\n    this.zoom = Math.max(0.1, Math.min(this.zoom, 1e15));\n  }\n\n  /**\n   * Reset to initial view\n   */\n  reset(): void {\n    this.centerX = -0.5;\n    this.centerY = 0.0;\n    this.zoom = 0.4;\n  }\n}\n","/**\n * Input Handler - Translates browser events into view state changes\n *\n * \"Event handling. Because apparently you monkeys can't click things properly.\"\n * - Skippy the Magnificent\n */\n\nimport { ViewState } from './ViewState';\n\nexport type ViewStateChangeCallback = (viewState: ViewState) => void;\nexport type IterationAdjustCallback = (direction: 1 | -1) => void;\nexport type IterationResetCallback = () => void;\nexport type PaletteCycleCallback = (direction: 1 | -1) => void;\nexport type ColorOffsetCallback = (delta: number) => void;\nexport type ToggleCallback = () => void;\nexport type FractalCycleCallback = (direction: 1 | -1) => void;\nexport type JuliaPickCallback = (fractalX: number, fractalY: number) => void;\nexport type ShareCallback = () => void;\nexport type LocationCallback = (key: string) => void;\nexport type HelpToggleCallback = () => void;\nexport type ScreenshotModeCallback = () => void;\n\n/** Zoom sensitivity: 1 = full speed, 0.6 = 60% of current zoom deltas */\nconst ZOOM_SENSITIVITY = 0.6;\n\nfunction scaleZoomFactor(factor: number): number {\n  return 1 + (factor - 1) * ZOOM_SENSITIVITY;\n}\n\nexport class InputHandler {\n  private canvas: HTMLCanvasElement;\n  private viewState: ViewState;\n  private onChange: ViewStateChangeCallback;\n  private onIterationAdjust: IterationAdjustCallback | null = null;\n  private onIterationReset: IterationResetCallback | null = null;\n  private onPaletteCycle: PaletteCycleCallback | null = null;\n  private onColorOffset: ColorOffsetCallback | null = null;\n  private onColorOffsetReset: ToggleCallback | null = null;\n  private onToggleAA: ToggleCallback | null = null;\n  private onFractalCycle: FractalCycleCallback | null = null;\n  private onToggleJuliaMode: ToggleCallback | null = null;\n  private onJuliaPick: JuliaPickCallback | null = null;\n  private onShare: ShareCallback | null = null;\n  private onLocationSelect: LocationCallback | null = null;\n  private onToggleHelp: HelpToggleCallback | null = null;\n  private onToggleScreenshotMode: ScreenshotModeCallback | null = null;\n\n  // Mouse/touch state\n  private isDragging = false;\n  private lastX = 0;\n  private lastY = 0;\n  private lastTouchDistance = 0;\n\n  // Julia picker mode state\n  private juliaPickerMode = false;\n\n  constructor(\n    canvas: HTMLCanvasElement,\n    viewState: ViewState,\n    onChange: ViewStateChangeCallback\n  ) {\n    this.canvas = canvas;\n    this.viewState = viewState;\n    this.onChange = onChange;\n\n    this.setupEventListeners();\n  }\n\n  /**\n   * Set callback for iteration adjustment (+/- keys)\n   */\n  setIterationAdjustCallback(callback: IterationAdjustCallback): void {\n    this.onIterationAdjust = callback;\n  }\n\n  /**\n   * Set callback for iteration reset (0 key)\n   */\n  setIterationResetCallback(callback: IterationResetCallback): void {\n    this.onIterationReset = callback;\n  }\n\n  /**\n   * Set callback for palette cycling (c/C keys)\n   */\n  setPaletteCycleCallback(callback: PaletteCycleCallback): void {\n    this.onPaletteCycle = callback;\n  }\n\n  /**\n   * Set callback for color offset adjustment ([/] keys)\n   */\n  setColorOffsetCallback(callback: ColorOffsetCallback): void {\n    this.onColorOffset = callback;\n  }\n\n  /**\n   * Set callback for color offset reset (r key)\n   */\n  setColorOffsetResetCallback(callback: ToggleCallback): void {\n    this.onColorOffsetReset = callback;\n  }\n\n  /**\n   * Set callback for AA toggle (a key)\n   */\n  setToggleAACallback(callback: ToggleCallback): void {\n    this.onToggleAA = callback;\n  }\n\n  /**\n   * Set callback for fractal type cycling (f/F keys)\n   */\n  setFractalCycleCallback(callback: FractalCycleCallback): void {\n    this.onFractalCycle = callback;\n  }\n\n  /**\n   * Set callback for Julia mode toggle (j key)\n   */\n  setToggleJuliaModeCallback(callback: ToggleCallback): void {\n    this.onToggleJuliaMode = callback;\n  }\n\n  /**\n   * Set callback for Julia constant selection (click in picker mode)\n   */\n  setJuliaPickCallback(callback: JuliaPickCallback): void {\n    this.onJuliaPick = callback;\n  }\n\n  /**\n   * Set callback for share/bookmark (s key)\n   */\n  setShareCallback(callback: ShareCallback): void {\n    this.onShare = callback;\n  }\n\n  /**\n   * Set callback for famous location selection (1-9 keys)\n   */\n  setLocationSelectCallback(callback: LocationCallback): void {\n    this.onLocationSelect = callback;\n  }\n\n  /**\n   * Set callback for help overlay toggle (h key)\n   */\n  setToggleHelpCallback(callback: HelpToggleCallback): void {\n    this.onToggleHelp = callback;\n  }\n\n  /**\n   * Set callback for screenshot mode toggle (space key)\n   */\n  setToggleScreenshotModeCallback(callback: ScreenshotModeCallback): void {\n    this.onToggleScreenshotMode = callback;\n  }\n\n  /**\n   * Enable or disable Julia picker mode\n   */\n  setJuliaPickerMode(enabled: boolean): void {\n    this.juliaPickerMode = enabled;\n    this.canvas.style.cursor = enabled ? 'crosshair' : 'grab';\n  }\n\n  /**\n   * Check if Julia picker mode is active\n   */\n  isJuliaPickerModeActive(): boolean {\n    return this.juliaPickerMode;\n  }\n\n  private setupEventListeners(): void {\n    // Mouse events\n    this.canvas.addEventListener('mousedown', this.handleMouseDown.bind(this));\n    this.canvas.addEventListener('mousemove', this.handleMouseMove.bind(this));\n    this.canvas.addEventListener('mouseup', this.handleMouseUp.bind(this));\n    this.canvas.addEventListener('mouseleave', this.handleMouseUp.bind(this));\n    this.canvas.addEventListener('wheel', this.handleWheel.bind(this), { passive: false });\n    this.canvas.addEventListener('dblclick', this.handleDoubleClick.bind(this));\n\n    // Touch events\n    this.canvas.addEventListener('touchstart', this.handleTouchStart.bind(this), { passive: false });\n    this.canvas.addEventListener('touchmove', this.handleTouchMove.bind(this), { passive: false });\n    this.canvas.addEventListener('touchend', this.handleTouchEnd.bind(this));\n    this.canvas.addEventListener('touchcancel', this.handleTouchEnd.bind(this));\n\n    // Prevent context menu on right click\n    this.canvas.addEventListener('contextmenu', (e) => e.preventDefault());\n\n    // Keyboard events (on window for global capture)\n    window.addEventListener('keydown', this.handleKeyDown.bind(this));\n  }\n\n  private getCanvasRect(): DOMRect {\n    return this.canvas.getBoundingClientRect();\n  }\n\n  private getScreenCoords(clientX: number, clientY: number): [number, number] {\n    const rect = this.getCanvasRect();\n    return [clientX - rect.left, clientY - rect.top];\n  }\n\n  private getCanvasSize(): [number, number] {\n    // Use CSS dimensions, not pixel dimensions (which include devicePixelRatio)\n    const rect = this.getCanvasRect();\n    return [rect.width, rect.height];\n  }\n\n  private notifyChange(): void {\n    this.onChange(this.viewState);\n  }\n\n  // Mouse handlers\n  private handleMouseDown(e: MouseEvent): void {\n    if (e.button !== 0) return; // Only left button\n\n    const [x, y] = this.getScreenCoords(e.clientX, e.clientY);\n\n    // Julia picker mode: pick a point instead of panning\n    if (this.juliaPickerMode && this.onJuliaPick) {\n      const [width, height] = this.getCanvasSize();\n      const [fractalX, fractalY] = this.viewState.toFractalCoords(x, y, width, height);\n      this.onJuliaPick(fractalX, fractalY);\n      return;\n    }\n\n    this.isDragging = true;\n    this.lastX = x;\n    this.lastY = y;\n    this.canvas.style.cursor = 'grabbing';\n  }\n\n  private handleMouseMove(e: MouseEvent): void {\n    if (!this.isDragging) return;\n\n    const [x, y] = this.getScreenCoords(e.clientX, e.clientY);\n    const deltaX = x - this.lastX;\n    const deltaY = y - this.lastY;\n\n    const [width, height] = this.getCanvasSize();\n    this.viewState.pan(deltaX, deltaY, width, height);\n    this.notifyChange();\n\n    this.lastX = x;\n    this.lastY = y;\n  }\n\n  private handleMouseUp(): void {\n    if (this.isDragging) {\n      this.isDragging = false;\n      this.canvas.style.cursor = 'grab';\n    }\n  }\n\n  private handleWheel(e: WheelEvent): void {\n    e.preventDefault();\n\n    const [x, y] = this.getScreenCoords(e.clientX, e.clientY);\n    const raw = e.deltaY > 0 ? 0.9 : 1.1;\n    const zoomFactor = scaleZoomFactor(raw);\n\n    const [width, height] = this.getCanvasSize();\n    this.viewState.zoomAt(x, y, zoomFactor, width, height);\n    this.notifyChange();\n  }\n\n  private handleDoubleClick(e: MouseEvent): void {\n    const [x, y] = this.getScreenCoords(e.clientX, e.clientY);\n    const [width, height] = this.getCanvasSize();\n    this.viewState.zoomToPoint(x, y, scaleZoomFactor(2.0), width, height);\n    this.notifyChange();\n  }\n\n  // Touch handlers\n  private getTouchDistance(touches: TouchList): number {\n    if (touches.length < 2) return 0;\n    const dx = touches[0].clientX - touches[1].clientX;\n    const dy = touches[0].clientY - touches[1].clientY;\n    return Math.sqrt(dx * dx + dy * dy);\n  }\n\n  private getTouchCenter(touches: TouchList): [number, number] {\n    if (touches.length === 0) return [0, 0];\n    if (touches.length === 1) {\n      return this.getScreenCoords(touches[0].clientX, touches[0].clientY);\n    }\n    const x = (touches[0].clientX + touches[1].clientX) / 2;\n    const y = (touches[0].clientY + touches[1].clientY) / 2;\n    return this.getScreenCoords(x, y);\n  }\n\n  private handleTouchStart(e: TouchEvent): void {\n    if (e.touches.length === 1) {\n      // Single touch - start pan\n      this.isDragging = true;\n      const [x, y] = this.getScreenCoords(e.touches[0].clientX, e.touches[0].clientY);\n      this.lastX = x;\n      this.lastY = y;\n    } else if (e.touches.length === 2) {\n      // Two touches - prepare for pinch zoom\n      this.isDragging = false;\n      this.lastTouchDistance = this.getTouchDistance(e.touches);\n    }\n  }\n\n  private handleTouchMove(e: TouchEvent): void {\n    e.preventDefault();\n\n    if (e.touches.length === 1 && this.isDragging) {\n      // Single touch pan\n      const [x, y] = this.getScreenCoords(e.touches[0].clientX, e.touches[0].clientY);\n      const deltaX = x - this.lastX;\n      const deltaY = y - this.lastY;\n\n      const [width, height] = this.getCanvasSize();\n    this.viewState.pan(deltaX, deltaY, width, height);\n      this.notifyChange();\n\n      this.lastX = x;\n      this.lastY = y;\n    } else if (e.touches.length === 2) {\n      // Pinch zoom\n      const distance = this.getTouchDistance(e.touches);\n      const center = this.getTouchCenter(e.touches);\n\n      if (this.lastTouchDistance > 0) {\n        const raw = distance / this.lastTouchDistance;\n        const zoomFactor = scaleZoomFactor(raw);\n        const [width, height] = this.getCanvasSize();\n        this.viewState.zoomAt(center[0], center[1], zoomFactor, width, height);\n        this.notifyChange();\n      }\n\n      this.lastTouchDistance = distance;\n    }\n  }\n\n  private handleTouchEnd(): void {\n    this.isDragging = false;\n    this.lastTouchDistance = 0;\n  }\n\n  // Keyboard handlers\n  private handleKeyDown(e: KeyboardEvent): void {\n    // Ignore if typing in an input field\n    if (e.target instanceof HTMLInputElement || e.target instanceof HTMLTextAreaElement) {\n      return;\n    }\n\n    switch (e.key) {\n      case '+':\n      case '=': // Allow unshifted + key\n        e.preventDefault();\n        this.onIterationAdjust?.(1);\n        break;\n      case '-':\n      case '_': // Allow shifted - key\n        e.preventDefault();\n        this.onIterationAdjust?.(-1);\n        break;\n      case '0':\n        e.preventDefault();\n        this.onIterationReset?.();\n        break;\n      case 'c':\n        e.preventDefault();\n        this.onPaletteCycle?.(1);\n        break;\n      case 'C':\n        e.preventDefault();\n        this.onPaletteCycle?.(-1);\n        break;\n      case '[':\n      case ',':\n        e.preventDefault();\n        this.onColorOffset?.(-0.1);\n        break;\n      case ']':\n      case '.':\n        e.preventDefault();\n        this.onColorOffset?.(0.1);\n        break;\n      case '{':\n      case '<':\n        e.preventDefault();\n        this.onColorOffset?.(-0.5);\n        break;\n      case '}':\n      case '>':\n        e.preventDefault();\n        this.onColorOffset?.(0.5);\n        break;\n      case 'r':\n      case 'R':\n        e.preventDefault();\n        this.onColorOffsetReset?.();\n        break;\n      case 'a':\n      case 'A':\n        e.preventDefault();\n        this.onToggleAA?.();\n        break;\n      case 'f':\n        e.preventDefault();\n        this.onFractalCycle?.(1);\n        break;\n      case 'F':\n        e.preventDefault();\n        this.onFractalCycle?.(-1);\n        break;\n      case 'j':\n      case 'J':\n        e.preventDefault();\n        this.onToggleJuliaMode?.();\n        break;\n      case 's':\n      case 'S':\n        e.preventDefault();\n        this.onShare?.();\n        break;\n      case '1':\n      case '2':\n      case '3':\n      case '4':\n      case '5':\n      case '6':\n      case '7':\n      case '8':\n      case '9':\n        e.preventDefault();\n        this.onLocationSelect?.(e.key);\n        break;\n      case 'h':\n      case 'H':\n        e.preventDefault();\n        this.onToggleHelp?.();\n        break;\n      case ' ':\n        e.preventDefault();\n        this.onToggleScreenshotMode?.();\n        break;\n    }\n  }\n\n  /**\n   * Clean up event listeners\n   */\n  destroy(): void {\n    // Event listeners will be cleaned up when canvas is removed\n    // But we could explicitly remove them if needed\n  }\n}\n","/**\n * Type Definitions for Fractal Explorer\n *\n * \"Type safety. Because apparently you monkeys can't be trusted.\"\n * - Skippy the Magnificent\n */\n\n/**\n * Available fractal types.\n * Mandelbrot: z = z² + c\n * Burning Ship: z = (|Re(z)| + i|Im(z)|)² + c\n */\nexport enum FractalType {\n  Mandelbrot = 0,\n  BurningShip = 1,\n  Julia = 2,\n  BurningShipJulia = 3,\n}\n\nexport const FRACTAL_TYPE_NAMES: Record<FractalType, string> = {\n  [FractalType.Mandelbrot]: 'Mandelbrot',\n  [FractalType.BurningShip]: 'Burning Ship',\n  [FractalType.Julia]: 'Julia',\n  [FractalType.BurningShipJulia]: 'Burning Ship Julia',\n};\n\nexport type UniformValue =\n  | number\n  | [number, number]\n  | [number, number, number]\n  | [number, number, number, number];\n\nexport interface UniformMap {\n  [name: string]: UniformValue;\n}\n\nexport interface ViewState {\n  centerX: number; // Real component of center (-2.5 to 1.0 typical)\n  centerY: number; // Imaginary component of center (-1.5 to 1.5 typical)\n  zoom: number; // Zoom factor (1.0 = full set visible)\n}\n","/**\n * Bookmark Manager - URL-based state sharing\n *\n * \"Sharing fractals with the masses. How quaint.\"\n * - Skippy the Magnificent\n */\n\nimport { FractalType } from '../types';\n\n/**\n * Complete fractal state that can be bookmarked\n */\nexport interface BookmarkState {\n  fractalType: FractalType;\n  centerX: number;\n  centerY: number;\n  zoom: number;\n  paletteIndex: number;\n  colorOffset: number;\n  juliaC: [number, number];\n  maxIterationsOverride: number | null;\n  aaEnabled: boolean;\n}\n\n/**\n * URL parameter names (kept short for compact URLs)\n * t = type, x = centerX, y = centerY, z = zoom\n * p = palette, o = color offset\n * jr = julia real, ji = julia imaginary\n * i = iterations, aa = antialiasing\n */\nconst PARAM = {\n  TYPE: 't',\n  CENTER_X: 'x',\n  CENTER_Y: 'y',\n  ZOOM: 'z',\n  PALETTE: 'p',\n  COLOR_OFFSET: 'o',\n  JULIA_REAL: 'jr',\n  JULIA_IMAG: 'ji',\n  ITERATIONS: 'i',\n  AA: 'aa',\n} as const;\n\n/**\n * Encode a number with reasonable precision for URLs.\n * Uses exponential notation for very large/small numbers.\n */\nfunction encodeNumber(n: number, precision: number = 15): string {\n  if (n === 0) return '0';\n  if (Math.abs(n) < 1e-10 || Math.abs(n) > 1e10) {\n    return n.toExponential(precision);\n  }\n  // Trim trailing zeros\n  return parseFloat(n.toPrecision(precision)).toString();\n}\n\n/**\n * Decode a number from URL string\n */\nfunction decodeNumber(s: string | null): number | null {\n  if (s === null || s === '') return null;\n  const n = parseFloat(s);\n  return isNaN(n) ? null : n;\n}\n\n/**\n * Encode fractal state into URL hash parameters\n */\nexport function encodeBookmark(state: BookmarkState): string {\n  const params = new URLSearchParams();\n\n  params.set(PARAM.TYPE, state.fractalType.toString());\n  params.set(PARAM.CENTER_X, encodeNumber(state.centerX));\n  params.set(PARAM.CENTER_Y, encodeNumber(state.centerY));\n  params.set(PARAM.ZOOM, encodeNumber(state.zoom));\n  params.set(PARAM.PALETTE, state.paletteIndex.toString());\n\n  // Only include optional params if they have non-default values\n  if (Math.abs(state.colorOffset) > 0.001) {\n    params.set(PARAM.COLOR_OFFSET, encodeNumber(state.colorOffset, 4));\n  }\n\n  // Include Julia constant for Julia-type fractals\n  if (state.fractalType === FractalType.Julia || state.fractalType === FractalType.BurningShipJulia) {\n    params.set(PARAM.JULIA_REAL, encodeNumber(state.juliaC[0]));\n    params.set(PARAM.JULIA_IMAG, encodeNumber(state.juliaC[1]));\n  }\n\n  if (state.maxIterationsOverride !== null) {\n    params.set(PARAM.ITERATIONS, state.maxIterationsOverride.toString());\n  }\n\n  if (state.aaEnabled) {\n    params.set(PARAM.AA, '1');\n  }\n\n  return params.toString();\n}\n\n/**\n * Decode bookmark state from URL hash parameters.\n * Returns partial state - only includes values that were present in the URL.\n */\nexport function decodeBookmark(hash: string): Partial<BookmarkState> {\n  const params = new URLSearchParams(hash.replace(/^#/, ''));\n  const state: Partial<BookmarkState> = {};\n\n  const type = decodeNumber(params.get(PARAM.TYPE));\n  if (type !== null && type >= 0 && type <= 3) {\n    state.fractalType = type as FractalType;\n  }\n\n  const x = decodeNumber(params.get(PARAM.CENTER_X));\n  if (x !== null) state.centerX = x;\n\n  const y = decodeNumber(params.get(PARAM.CENTER_Y));\n  if (y !== null) state.centerY = y;\n\n  const z = decodeNumber(params.get(PARAM.ZOOM));\n  if (z !== null && z > 0) state.zoom = z;\n\n  const p = decodeNumber(params.get(PARAM.PALETTE));\n  if (p !== null && p >= 0 && p <= 11) state.paletteIndex = Math.floor(p);\n\n  const o = decodeNumber(params.get(PARAM.COLOR_OFFSET));\n  if (o !== null) state.colorOffset = o;\n\n  const jr = decodeNumber(params.get(PARAM.JULIA_REAL));\n  const ji = decodeNumber(params.get(PARAM.JULIA_IMAG));\n  if (jr !== null && ji !== null) {\n    state.juliaC = [jr, ji];\n  }\n\n  const i = decodeNumber(params.get(PARAM.ITERATIONS));\n  if (i !== null && i > 0) state.maxIterationsOverride = Math.floor(i);\n\n  if (params.get(PARAM.AA) === '1') {\n    state.aaEnabled = true;\n  }\n\n  return state;\n}\n\n/**\n * Get the full shareable URL for the current state\n */\nexport function getShareableUrl(state: BookmarkState): string {\n  const hash = encodeBookmark(state);\n  const url = new URL(window.location.href);\n  url.hash = hash;\n  return url.toString();\n}\n\n/**\n * Update the browser URL hash without triggering navigation\n */\nexport function updateUrlHash(state: BookmarkState): void {\n  const hash = encodeBookmark(state);\n  // Use replaceState to avoid cluttering browser history\n  window.history.replaceState(null, '', '#' + hash);\n}\n\n/**\n * Read bookmark state from current URL\n */\nexport function readUrlBookmark(): Partial<BookmarkState> {\n  return decodeBookmark(window.location.hash);\n}\n\n/**\n * Copy the shareable URL to clipboard\n * Returns true if successful\n */\nexport async function copyShareableUrl(state: BookmarkState): Promise<boolean> {\n  const url = getShareableUrl(state);\n  try {\n    await navigator.clipboard.writeText(url);\n    return true;\n  } catch {\n    // Fallback for older browsers\n    const textArea = document.createElement('textarea');\n    textArea.value = url;\n    textArea.style.position = 'fixed';\n    textArea.style.left = '-9999px';\n    document.body.appendChild(textArea);\n    textArea.select();\n    try {\n      document.execCommand('copy');\n      return true;\n    } catch {\n      return false;\n    } finally {\n      document.body.removeChild(textArea);\n    }\n  }\n}\n","/**\n * Famous Fractal Locations - Curated spots of mathematical beauty\n *\n * \"The greatest hits of chaos theory. You're welcome.\"\n * - Skippy the Magnificent\n */\n\nimport { FractalType } from '../types';\nimport { BookmarkState } from './BookmarkManager';\n\nexport interface FamousLocation {\n  name: string;\n  description: string;\n  key: string; // Keyboard shortcut (1-9)\n  state: BookmarkState;\n}\n\n/**\n * Famous locations in the Mandelbrot set and related fractals.\n * Navigate using number keys 1-9.\n */\nexport const FAMOUS_LOCATIONS: FamousLocation[] = [\n  // === MANDELBROT SET ===\n  {\n    name: 'Seahorse Valley',\n    description: 'The iconic seahorse-shaped spirals in the Mandelbrot set',\n    key: '1',\n    state: {\n      fractalType: FractalType.Mandelbrot,\n      centerX: -0.747,\n      centerY: 0.1,\n      zoom: 50,\n      paletteIndex: 4, // Fire\n      colorOffset: 0,\n      juliaC: [-0.7, 0.27015],\n      maxIterationsOverride: null,\n      aaEnabled: false,\n    },\n  },\n  {\n    name: 'Elephant Valley',\n    description: 'Elephant trunk-like spirals on the positive real side',\n    key: '2',\n    state: {\n      fractalType: FractalType.Mandelbrot,\n      centerX: 0.273833471870982,\n      centerY: 0.00561979255775977,\n      zoom: 80,\n      paletteIndex: 10, // Sunset\n      colorOffset: 0,\n      juliaC: [-0.7, 0.27015],\n      maxIterationsOverride: null,\n      aaEnabled: false,\n    },\n  },\n  {\n    name: 'Double Spiral Valley',\n    description: 'Beautiful double spirals deep in the set',\n    key: '3',\n    state: {\n      fractalType: FractalType.Mandelbrot,\n      centerX: -0.743419359336048,\n      centerY: 0.131251071265607,\n      zoom: 1183.1341328454,\n      paletteIndex: 4, // Fire\n      colorOffset: 0.3,\n      juliaC: [-0.7, 0.27015],\n      maxIterationsOverride: null,\n      aaEnabled: false,\n    },\n  },\n  {\n    name: 'Spiral Galaxy',\n    description: 'Galactic spiral arms emerging from chaos',\n    key: '4',\n    state: {\n      fractalType: FractalType.Mandelbrot,\n      centerX: -0.761574,\n      centerY: -0.0847596,\n      zoom: 5000,\n      paletteIndex: 11, // Electric\n      colorOffset: 0,\n      juliaC: [-0.7, 0.27015],\n      maxIterationsOverride: null,\n      aaEnabled: false,\n    },\n  },\n\n  // === BURNING SHIP ===\n  {\n    name: 'The Armada',\n    description: 'Mini ships along the antenna of the Burning Ship fractal',\n    key: '5',\n    state: {\n      fractalType: FractalType.BurningShip,\n      centerX: -1.80173025652805,\n      centerY: 0.0026088215386122,\n      zoom: 9,\n      paletteIndex: 11, // Electric\n      colorOffset: 0.3,\n      juliaC: [-0.7, 0.27015],\n      maxIterationsOverride: null,\n      aaEnabled: false,\n    },\n  },\n\n  // === JULIA SETS ===\n  {\n    name: 'Douady Rabbit',\n    description: 'The famous rabbit-eared Julia set',\n    key: '6',\n    state: {\n      fractalType: FractalType.Julia,\n      centerX: 0,\n      centerY: 0,\n      zoom: 0.6,\n      paletteIndex: 11,\n      colorOffset: 0.2,\n      juliaC: [-0.123, 0.745],\n      maxIterationsOverride: null,\n      aaEnabled: false,\n    },\n  },\n  {\n    name: 'Dragon Julia',\n    description: 'Fierce dragon-like Julia set',\n    key: '7',\n    state: {\n      fractalType: FractalType.Julia,\n      centerX: 0,\n      centerY: 0,\n      zoom: 0.45,\n      paletteIndex: 10,\n      colorOffset: 0.4,\n      juliaC: [-0.8, 0.156],\n      maxIterationsOverride: null,\n      aaEnabled: false,\n    },\n  },\n  {\n    name: 'Lightning Julia',\n    description: 'Electric, lightning-like patterns',\n    key: '8',\n    state: {\n      fractalType: FractalType.Julia,\n      centerX: 0,\n      centerY: 0,\n      zoom: 0.45,\n      paletteIndex: 11, // Electric\n      colorOffset: 0.1,\n      juliaC: [-0.7269, 0.1889],\n      maxIterationsOverride: 1000, // Needs more iterations to resolve fine filaments\n      aaEnabled: false,\n    },\n  },\n\n  // === BURNING SHIP JULIA ===\n  {\n    name: 'Burning Ship Julia',\n    description: 'The Burning Ship transformed into Julia form',\n    key: '9',\n    state: {\n      fractalType: FractalType.BurningShipJulia,\n      centerX: 0.0531593112628493,\n      centerY: -0.00735797965780141,\n      zoom: 4,\n      paletteIndex: 11, // Electric\n      colorOffset: 0.1,\n      juliaC: [-1.59537659751621, 0.00014862028243811],\n      maxIterationsOverride: null,\n      aaEnabled: false,\n    },\n  },\n];\n\n/**\n * Get a famous location by its keyboard shortcut\n */\nexport function getLocationByKey(key: string): FamousLocation | undefined {\n  return FAMOUS_LOCATIONS.find(loc => loc.key === key);\n}\n","export default \"#version 300 es\\n\\n/**\\n * Vertex Shader - Fullscreen Quad\\n *\\n * \\\"Two triangles. That's it. Even a monkey could understand this.\\\"\\n * - Skippy the Magnificent\\n */\\n\\nlayout(location = 0) in vec2 a_position;\\n\\nout vec2 v_uv;\\n\\nvoid main() {\\n  // Pass through position as UV coordinates (ranging from 0 to 1)\\n  v_uv = a_position;\\n  \\n  // Map to clip space (-1 to 1)\\n  gl_Position = vec4(a_position * 2.0 - 1.0, 0.0, 1.0);\\n}\\n\"","export default \"#version 300 es\\n\\n/**\\n * Fragment Shader - Mandelbrot Set Computation\\n *\\n * \\\"This is where the magic happens. On the GPU. In parallel. For every pixel.\\n *  Simultaneously. You're welcome.\\\"\\n * - Skippy the Magnificent\\n */\\n\\nprecision highp float;\\n\\nin vec2 v_uv;\\nout vec4 fragColor;\\n\\nuniform vec2 u_resolution;      // Canvas size in pixels\\nuniform vec2 u_center;          // Current view center in fractal coordinates\\nuniform float u_zoom;           // Current zoom level\\nuniform int u_maxIterations;    // Iteration limit (quality vs performance)\\nuniform float u_time;           // Time in seconds (for animations)\\nuniform int u_paletteIndex;     // Which color palette to use (0-7)\\nuniform float u_colorOffset;    // Offset to shift the color cycle\\nuniform int u_fractalType;      // 0 = Mandelbrot, 1 = Burning Ship, 2 = Julia, 3 = Burning Ship Julia\\nuniform vec2 u_juliaC;          // Julia set constant (only used for Julia types)\\n\\n// Attempt at magnificent color palettes using cosine gradients\\n// Formula: color = a + b * cos(2π * (c * t + d))\\n// Each palette defined by vec3 a, b, c, d\\n\\nvec3 palette(float t, vec3 a, vec3 b, vec3 c, vec3 d) {\\n  return a + b * cos(6.28318 * (c * t + d));\\n}\\n\\nvec3 getColor(float t, int paletteIdx, bool isCycling) {\\n  // For cycling palettes: wrap t to [0, 1] for repeating\\n  // For monotonic palettes: clamp t to [0, 1] for single gradient\\n  if (isCycling) {\\n    t = fract(t);\\n  } else {\\n    t = clamp(t, 0.0, 1.0);\\n  }\\n\\n  if (paletteIdx == 0) {\\n    // Classic rainbow - the psychedelic special\\n    return palette(t,\\n      vec3(0.5, 0.5, 0.5),\\n      vec3(0.5, 0.5, 0.5),\\n      vec3(1.0, 1.0, 1.0),\\n      vec3(0.0, 0.33, 0.67));\\n  } else if (paletteIdx == 1) {\\n    // Blue journey - dark indigo -> teal -> cyan -> bright blue-white\\n    vec3 c1 = vec3(0.02, 0.01, 0.08);  // deep indigo\\n    vec3 c2 = vec3(0.05, 0.15, 0.25);  // dark teal\\n    vec3 c3 = vec3(0.1, 0.4, 0.5);     // teal\\n    vec3 c4 = vec3(0.3, 0.6, 0.8);     // sky blue\\n    vec3 c5 = vec3(0.7, 0.9, 1.0);     // bright cyan-white\\n    if (t < 0.25) return mix(c1, c2, t * 4.0);\\n    else if (t < 0.5) return mix(c2, c3, (t - 0.25) * 4.0);\\n    else if (t < 0.75) return mix(c3, c4, (t - 0.5) * 4.0);\\n    else return mix(c4, c5, (t - 0.75) * 4.0);\\n  } else if (paletteIdx == 2) {\\n    // Gold journey - dark brown -> copper -> orange -> gold -> bright yellow\\n    vec3 c1 = vec3(0.04, 0.02, 0.01);  // near black brown\\n    vec3 c2 = vec3(0.2, 0.08, 0.02);   // dark copper\\n    vec3 c3 = vec3(0.5, 0.25, 0.05);   // copper-orange\\n    vec3 c4 = vec3(0.85, 0.6, 0.2);    // gold\\n    vec3 c5 = vec3(1.0, 0.95, 0.7);    // bright gold-white\\n    if (t < 0.25) return mix(c1, c2, t * 4.0);\\n    else if (t < 0.5) return mix(c2, c3, (t - 0.25) * 4.0);\\n    else if (t < 0.75) return mix(c3, c4, (t - 0.5) * 4.0);\\n    else return mix(c4, c5, (t - 0.75) * 4.0);\\n  } else if (paletteIdx == 3) {\\n    // Grayscale with subtle blue tint at shadows, warm at highlights\\n    vec3 c1 = vec3(0.01, 0.01, 0.03);  // near black, hint of blue\\n    vec3 c2 = vec3(0.15, 0.15, 0.17);  // dark gray, cool\\n    vec3 c3 = vec3(0.45, 0.45, 0.45);  // mid gray\\n    vec3 c4 = vec3(0.75, 0.74, 0.72);  // light gray, hint warm\\n    vec3 c5 = vec3(1.0, 0.98, 0.95);   // warm white\\n    if (t < 0.25) return mix(c1, c2, t * 4.0);\\n    else if (t < 0.5) return mix(c2, c3, (t - 0.25) * 4.0);\\n    else if (t < 0.75) return mix(c3, c4, (t - 0.5) * 4.0);\\n    else return mix(c4, c5, (t - 0.75) * 4.0);\\n  } else if (paletteIdx == 4) {\\n    // Fire - hot hot hot\\n    return palette(t,\\n      vec3(0.5, 0.5, 0.5),\\n      vec3(0.5, 0.5, 0.5),\\n      vec3(1.0, 1.0, 0.5),\\n      vec3(0.0, 0.1, 0.2));\\n  } else if (paletteIdx == 5) {\\n    // Ice - cool blues and cyans\\n    return palette(t,\\n      vec3(0.5, 0.5, 0.5),\\n      vec3(0.5, 0.5, 0.5),\\n      vec3(1.0, 0.7, 0.4),\\n      vec3(0.0, 0.15, 0.20));\\n  } else if (paletteIdx == 6) {\\n    // Sepia journey - dark brown -> warm brown -> tan -> cream\\n    vec3 c1 = vec3(0.03, 0.02, 0.01);  // near black\\n    vec3 c2 = vec3(0.15, 0.08, 0.03);  // dark brown\\n    vec3 c3 = vec3(0.4, 0.25, 0.12);   // warm brown\\n    vec3 c4 = vec3(0.7, 0.55, 0.35);   // tan\\n    vec3 c5 = vec3(1.0, 0.95, 0.85);   // cream white\\n    if (t < 0.25) return mix(c1, c2, t * 4.0);\\n    else if (t < 0.5) return mix(c2, c3, (t - 0.25) * 4.0);\\n    else if (t < 0.75) return mix(c3, c4, (t - 0.5) * 4.0);\\n    else return mix(c4, c5, (t - 0.75) * 4.0);\\n  } else if (paletteIdx == 7) {\\n    // Ocean journey - abyss -> deep blue -> teal -> seafoam -> bright\\n    vec3 c1 = vec3(0.0, 0.02, 0.05);   // abyss\\n    vec3 c2 = vec3(0.02, 0.08, 0.2);   // deep blue\\n    vec3 c3 = vec3(0.05, 0.3, 0.4);    // ocean teal\\n    vec3 c4 = vec3(0.2, 0.6, 0.6);     // seafoam\\n    vec3 c5 = vec3(0.6, 0.95, 0.9);    // bright aqua\\n    if (t < 0.25) return mix(c1, c2, t * 4.0);\\n    else if (t < 0.5) return mix(c2, c3, (t - 0.25) * 4.0);\\n    else if (t < 0.75) return mix(c3, c4, (t - 0.5) * 4.0);\\n    else return mix(c4, c5, (t - 0.75) * 4.0);\\n  } else if (paletteIdx == 8) {\\n    // Purple journey - dark violet -> purple -> magenta -> pink -> bright\\n    vec3 c1 = vec3(0.03, 0.01, 0.06);  // near black violet\\n    vec3 c2 = vec3(0.15, 0.05, 0.25);  // dark purple\\n    vec3 c3 = vec3(0.4, 0.15, 0.5);    // purple\\n    vec3 c4 = vec3(0.7, 0.4, 0.75);    // orchid\\n    vec3 c5 = vec3(0.95, 0.8, 1.0);    // bright pink-white\\n    if (t < 0.25) return mix(c1, c2, t * 4.0);\\n    else if (t < 0.5) return mix(c2, c3, (t - 0.25) * 4.0);\\n    else if (t < 0.75) return mix(c3, c4, (t - 0.5) * 4.0);\\n    else return mix(c4, c5, (t - 0.75) * 4.0);\\n  } else if (paletteIdx == 9) {\\n    // Forest journey - dark earth -> forest -> emerald -> lime -> bright\\n    vec3 c1 = vec3(0.02, 0.03, 0.01);  // dark earth\\n    vec3 c2 = vec3(0.05, 0.12, 0.04);  // dark forest\\n    vec3 c3 = vec3(0.1, 0.35, 0.15);   // forest green\\n    vec3 c4 = vec3(0.3, 0.65, 0.3);    // emerald\\n    vec3 c5 = vec3(0.7, 0.95, 0.6);    // bright lime\\n    if (t < 0.25) return mix(c1, c2, t * 4.0);\\n    else if (t < 0.5) return mix(c2, c3, (t - 0.25) * 4.0);\\n    else if (t < 0.75) return mix(c3, c4, (t - 0.5) * 4.0);\\n    else return mix(c4, c5, (t - 0.75) * 4.0);\\n  } else if (paletteIdx == 10) {\\n    // Sunset - warm oranges to pinks\\n    return palette(t,\\n      vec3(0.5, 0.3, 0.2),\\n      vec3(0.5, 0.4, 0.3),\\n      vec3(1.0, 1.0, 0.5),\\n      vec3(0.0, 0.1, 0.2));\\n  } else {\\n    // Electric - vibrant neon (the wild one at the end)\\n    return palette(t,\\n      vec3(0.5, 0.5, 0.5),\\n      vec3(0.6, 0.6, 0.6),\\n      vec3(1.0, 1.0, 1.0),\\n      vec3(0.3, 0.2, 0.2));\\n  }\\n}\\n\\nvoid main() {\\n  float aspect = u_resolution.x / u_resolution.y;\\n  vec2 uv = v_uv - 0.5;\\n  uv.x *= aspect;\\n  vec2 pos = u_center + uv / u_zoom;\\n\\n  // For Mandelbrot/Burning Ship: z starts at 0, c is pixel position\\n  // For Julia variants: z starts at pixel position, c is fixed constant\\n  vec2 z;\\n  vec2 c;\\n  bool isJulia = (u_fractalType == 2 || u_fractalType == 3);\\n  bool isBurningShip = (u_fractalType == 1 || u_fractalType == 3);\\n\\n  if (isJulia) {\\n    z = pos;\\n    c = u_juliaC;\\n  } else {\\n    z = vec2(0.0);\\n    c = pos;\\n  }\\n\\n  int iterations = 0;\\n  // Loop limit must be a compile-time constant in GLSL; 65536 allows high manual overrides\\n  for (int i = 0; i < 65536; i++) {\\n    if (i >= u_maxIterations) break;\\n    float zMagSq = dot(z, z);\\n    if (zMagSq > 4.0) break;\\n\\n    // Burning Ship variants: take absolute values before squaring\\n    if (isBurningShip) {\\n      // Burning Ship - take absolute values before squaring, negate imaginary for upright ship\\n      z = vec2(abs(z.x), -abs(z.y));\\n    }\\n    z = vec2(z.x * z.x - z.y * z.y + c.x, 2.0 * z.x * z.y + c.y);\\n    iterations++;\\n  }\\n\\n  if (iterations >= u_maxIterations) {\\n    // Inside the set - pure black\\n    fragColor = vec4(0.0, 0.0, 0.0, 1.0);\\n  } else {\\n    // Smooth iteration count for anti-banding\\n    float smoothIter = float(iterations) + 1.0 - log2(log2(max(dot(z, z), 4.0)));\\n\\n    // Normalize to [0, 1] based on max iterations\\n    float normalized = smoothIter / float(u_maxIterations);\\n\\n    // Determine if this palette is monotonic (single cycle) or cycling (multiple cycles)\\n    // Monotonic: 1, 2, 3, 6, 7, 8, 9 (Blue, Gold, Grayscale, Sepia, Ocean, Purple, Forest)\\n    // Cycling: 0, 4, 5, 10, 11 (Rainbow, Fire, Ice, Sunset, Electric)\\n    bool isMonotonic = (u_paletteIndex >= 1 && u_paletteIndex <= 3) ||\\n                       (u_paletteIndex >= 6 && u_paletteIndex <= 9);\\n\\n    float t;\\n    if (isMonotonic) {\\n      // Single cycle from 0 to 1 across all iterations\\n      t = normalized + u_colorOffset;\\n    } else {\\n      // Multiple cycles for psychedelic effect (e.g., 8 full cycles)\\n      float numCycles = 8.0;\\n      t = normalized * numCycles + u_colorOffset;\\n    }\\n\\n    vec3 color = getColor(t, u_paletteIndex, !isMonotonic);\\n\\n    // Add subtle glow near the boundary\\n    float edgeFactor = 1.0 - float(iterations) / float(u_maxIterations);\\n    float glow = pow(edgeFactor, 0.5) * 0.3;\\n    color = color * (1.0 + glow);\\n\\n    fragColor = vec4(min(color, vec3(1.0)), 1.0);\\n  }\\n}\\n\"","export default \"#version 300 es\\n\\n/**\\n * Post-process: antialias by averaging colored pixels with non-black neighbors.\\n * Black (set) pixels stay black; no bleeding into the set.\\n * Only applies when contrast among nearby non-black pixels is high; otherwise pass-through.\\n */\\n\\nprecision highp float;\\n\\nin vec2 v_uv;\\nout vec4 fragColor;\\n\\nuniform sampler2D u_tex;\\nuniform vec2 u_resolution;\\n\\nconst float BLACK_THRESH = 0.02;\\nconst float CONTRAST_THRESH = 0.35;\\n\\nbool isBlack(vec3 rgb) {\\n  return max(max(rgb.r, rgb.g), rgb.b) < BLACK_THRESH;\\n}\\n\\nfloat luminance(vec3 rgb) {\\n  return dot(rgb, vec3(0.2126, 0.7152, 0.0722));\\n}\\n\\nvoid main() {\\n  vec2 texel = 1.0 / u_resolution;\\n  vec4 center = texture(u_tex, v_uv);\\n  vec3 c = center.rgb;\\n\\n  if (isBlack(c)) {\\n    fragColor = vec4(0.0, 0.0, 0.0, 1.0);\\n    return;\\n  }\\n\\n  vec3 sum = c;\\n  float n = 1.0;\\n  float lumMin = luminance(c);\\n  float lumMax = lumMin;\\n\\n  for (int dy = -1; dy <= 1; dy++) {\\n    for (int dx = -1; dx <= 1; dx++) {\\n      if (dx == 0 && dy == 0) continue;\\n      vec2 uv = v_uv + vec2(float(dx), float(dy)) * texel;\\n      vec3 s = texture(u_tex, uv).rgb;\\n      if (!isBlack(s)) {\\n        sum += s;\\n        n += 1.0;\\n        float L = luminance(s);\\n        lumMin = min(lumMin, L);\\n        lumMax = max(lumMax, L);\\n      }\\n    }\\n  }\\n\\n  float contrast = lumMax - lumMin;\\n  if (contrast < CONTRAST_THRESH) {\\n    fragColor = vec4(c, 1.0);\\n  } else {\\n    fragColor = vec4(sum / n, 1.0);\\n  }\\n}\\n\"","/**\n * Fractal Engine - The orchestrator that ties everything together\n *\n * \"The conductor of this symphony. Obviously.\"\n * - Skippy the Magnificent\n */\n\nimport { WebGLRenderer } from '../renderer/WebGLRenderer';\nimport { ShaderProgram } from '../renderer/ShaderProgram';\nimport { ViewState } from '../controls/ViewState';\nimport { InputHandler } from '../controls/InputHandler';\nimport { FractalType, FRACTAL_TYPE_NAMES } from '../types';\nimport {\n  BookmarkState,\n  readUrlBookmark,\n  updateUrlHash,\n  copyShareableUrl,\n} from '../bookmark/BookmarkManager';\nimport { getLocationByKey } from '../bookmark/famousLocations';\n\n// Import shader sources\nimport vertexShaderSource from '../renderer/shaders/mandelbrot.vert.glsl?raw';\nimport fragmentShaderSource from '../renderer/shaders/mandelbrot.frag.glsl?raw';\nimport aaPostFragmentSource from '../renderer/shaders/aa-post.frag.glsl?raw';\n\n/** Base iterations at zoom 1; scaled up with log(zoom) for deeper zooms. */\nconst MAX_ITERATIONS_BASE = 256;\n/** Higher base for Julia sets - they need more iterations to resolve fine detail. */\nconst MAX_ITERATIONS_BASE_JULIA = 512;\n/** Default cap for auto-scaling; can be bypassed with manual override. */\nconst MAX_ITERATIONS_AUTO_CAP = 4096;\n/** Steep power curve: ~256@z1, ~1200@z18, ~3100@z350, cap@z~1e3. */\nconst MAX_ITERATIONS_LOG_SCALE = 640;\nconst MAX_ITERATIONS_LOG_POWER = 1.65;\n/** Ratio for manual iteration adjustments (+/- keys). */\nconst ITERATION_ADJUST_RATIO = 1.5;\n\nfunction maxIterationsForZoom(zoom: number, isJulia: boolean = false): number {\n  const z = Math.max(1, zoom);\n  const L = Math.log10(z);\n  const base = isJulia ? MAX_ITERATIONS_BASE_JULIA : MAX_ITERATIONS_BASE;\n  const n =\n    base +\n    MAX_ITERATIONS_LOG_SCALE * Math.pow(L, MAX_ITERATIONS_LOG_POWER);\n  return Math.round(\n    Math.max(base, Math.min(MAX_ITERATIONS_AUTO_CAP, n))\n  );\n}\n\nexport class FractalEngine {\n  private renderer: WebGLRenderer;\n  private shaderProgram: ShaderProgram;\n  private postProcessProgram: ShaderProgram;\n  private viewState: ViewState;\n  private inputHandler: InputHandler;\n\n  /** When set, overrides zoom-based max iterations. */\n  private maxIterationsOverride: number | null = null;\n\n  /** Current fractal type. */\n  private fractalType: FractalType = FractalType.Mandelbrot;\n  /** Number of non-Julia fractal types (for cycling). Julia types are selected via picker. */\n  private static readonly BASE_FRACTAL_TYPE_COUNT = 2; // Mandelbrot, Burning Ship\n\n  /** Julia set constant (c in z = z² + c). */\n  private juliaC: [number, number] = [-0.7, 0.27015]; // Classic Julia constant\n  /** Whether Julia picker mode is active. */\n  private juliaPickerMode = false;\n  /** Saved view state before entering Julia mode. */\n  private savedViewState: { centerX: number; centerY: number; zoom: number } | null = null;\n  /** Saved fractal type before entering Julia mode. */\n  private savedFractalType: FractalType | null = null;\n\n  /** Color palette index (0-11). */\n  private paletteIndex = 4; // Fire\n  /** Color offset for shifting the color cycle. */\n  private colorOffset = 0.0;\n  /** Number of available palettes. */\n  private static readonly PALETTE_COUNT = 12;\n  /** Palette names for display. */\n  private static readonly PALETTE_NAMES = [\n    'Rainbow', 'Blue', 'Gold', 'Grayscale', 'Fire', 'Ice',\n    'Sepia', 'Ocean', 'Purple', 'Forest', 'Sunset', 'Electric'\n  ];\n\n  /** Overlay showing zoom and iteration count (for debugging). */\n  private debugOverlay: HTMLElement | null = null;\n\n  /** Notification element for share confirmation. */\n  private shareNotification: HTMLElement | null = null;\n\n  /** Help overlay showing keyboard shortcuts. */\n  private helpOverlay: HTMLElement | null = null;\n\n  /** Whether help overlay is visible. */\n  private helpVisible = false;\n\n  /** Whether screenshot mode is active (hides all UI). */\n  private screenshotMode = false;\n\n  /** Whether post-process antialiasing is enabled. */\n  private aaEnabled = false;\n\n  /** Render-to-texture: FBO and texture for Mandelbrot pass. */\n  private fbo: WebGLFramebuffer | null = null;\n  private renderTarget: WebGLTexture | null = null;\n  private rtWidth = 0;\n  private rtHeight = 0;\n\n  private quadBuffer: WebGLBuffer | null = null;\n\n  constructor(canvas: HTMLCanvasElement) {\n    // Initialize renderer\n    this.renderer = new WebGLRenderer(canvas);\n\n    // Initialize view state\n    this.viewState = new ViewState();\n\n    this.shaderProgram = new ShaderProgram(\n      this.renderer.gl,\n      vertexShaderSource,\n      fragmentShaderSource\n    );\n    this.postProcessProgram = new ShaderProgram(\n      this.renderer.gl,\n      vertexShaderSource,\n      aaPostFragmentSource\n    );\n\n    this.setupGeometry();\n    this.setupRenderTarget();\n\n    // Setup input handler\n    this.inputHandler = new InputHandler(canvas, this.viewState, () => {\n      // View state changed, trigger a render\n      this.render();\n    });\n\n    // Wire up keyboard iteration controls\n    this.inputHandler.setIterationAdjustCallback((direction) => {\n      this.adjustMaxIterations(direction);\n    });\n    this.inputHandler.setIterationResetCallback(() => {\n      this.clearMaxIterationsOverride();\n    });\n\n    // Wire up keyboard color controls\n    this.inputHandler.setPaletteCycleCallback((direction) => {\n      this.cyclePalette(direction);\n    });\n    this.inputHandler.setColorOffsetCallback((delta) => {\n      this.adjustColorOffset(delta);\n    });\n    this.inputHandler.setColorOffsetResetCallback(() => {\n      this.resetColorOffset();\n    });\n\n    // Wire up AA toggle\n    this.inputHandler.setToggleAACallback(() => {\n      this.toggleAA();\n    });\n\n    // Wire up fractal type toggle\n    this.inputHandler.setFractalCycleCallback((direction) => {\n      this.cycleFractalType(direction);\n    });\n\n    // Wire up Julia picker mode\n    this.inputHandler.setToggleJuliaModeCallback(() => {\n      this.toggleJuliaPickerMode();\n    });\n    this.inputHandler.setJuliaPickCallback((x, y) => {\n      this.pickJuliaConstant(x, y);\n    });\n\n    // Debug overlay: zoom + iterations\n    const parent = canvas.parentElement;\n    if (parent) {\n      this.debugOverlay = document.createElement('div');\n      this.debugOverlay.id = 'zoom-debug';\n      parent.appendChild(this.debugOverlay);\n\n      // Share notification (hidden by default)\n      this.shareNotification = document.createElement('div');\n      this.shareNotification.id = 'share-notification';\n      this.shareNotification.style.cssText = `\n        position: fixed;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        background: rgba(0, 0, 0, 0.85);\n        color: #4ade80;\n        padding: 16px 32px;\n        border-radius: 8px;\n        font-family: system-ui, sans-serif;\n        font-size: 16px;\n        z-index: 1000;\n        opacity: 0;\n        transition: opacity 0.3s ease;\n        pointer-events: none;\n      `;\n      parent.appendChild(this.shareNotification);\n\n      // Help overlay (hidden by default)\n      this.helpOverlay = document.createElement('div');\n      this.helpOverlay.id = 'help-overlay';\n      this.helpOverlay.innerHTML = this.createHelpContent();\n      this.helpOverlay.style.cssText = `\n        position: fixed;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        background: rgba(0, 0, 0, 0.92);\n        color: #e5e5e5;\n        padding: 24px 32px;\n        border-radius: 12px;\n        font-family: system-ui, -apple-system, sans-serif;\n        font-size: 14px;\n        z-index: 1001;\n        opacity: 0;\n        transition: opacity 0.2s ease;\n        pointer-events: none;\n        max-width: 90vw;\n        max-height: 90vh;\n        overflow-y: auto;\n        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);\n        border: 1px solid rgba(255, 255, 255, 0.1);\n      `;\n      parent.appendChild(this.helpOverlay);\n    }\n\n// Wire up share callback\n    this.inputHandler.setShareCallback(() => {\n      this.shareBookmark();\n    });\n\n    // Wire up location selection (number keys 1-9)\n    this.inputHandler.setLocationSelectCallback((key) => {\n      this.goToLocation(key);\n    });\n\n    // Wire up help and screenshot mode toggles\n    this.inputHandler.setToggleHelpCallback(() => {\n      this.toggleHelp();\n    });\n    this.inputHandler.setToggleScreenshotModeCallback(() => {\n      this.toggleScreenshotMode();\n    });\n\n    // Handle window resize\n    window.addEventListener('resize', this.handleResize);\n\n    // Listen for URL hash changes (for pasting new bookmark URLs)\n    window.addEventListener('hashchange', this.handleHashChange);\n\n    // Load bookmark from URL if present\n    this.loadBookmark();\n\n    // Initial resize\n    this.handleResize();\n  }\n\n  private handleHashChange = (): void => {\n    this.loadBookmark();\n  };\n\n  private handleResize = (): void => {\n    this.renderer.resize(window.innerWidth, window.innerHeight);\n    this.ensureRenderTargetSize();\n    this.render();\n  };\n\n  private setupGeometry(): void {\n    const gl = this.renderer.gl;\n\n    // Fullscreen quad: two triangles covering clip space\n    // Positions are in UV space (0-1), shader maps to clip space\n    const quadVertices = new Float32Array([\n      // Triangle 1\n      0.0, 0.0, // Bottom-left\n      1.0, 0.0, // Bottom-right\n      0.0, 1.0, // Top-left\n      // Triangle 2\n      1.0, 0.0, // Bottom-right\n      1.0, 1.0, // Top-right\n      0.0, 1.0, // Top-left\n    ]);\n\n    this.quadBuffer = gl.createBuffer();\n    if (!this.quadBuffer) {\n      throw new Error('Failed to create buffer');\n    }\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.quadBuffer);\n    gl.bufferData(gl.ARRAY_BUFFER, quadVertices, gl.STATIC_DRAW);\n  }\n\n\n  private setupRenderTarget(): void {\n    const gl = this.renderer.gl;\n    this.fbo = gl.createFramebuffer();\n    this.renderTarget = gl.createTexture();\n  }\n\n  private ensureRenderTargetSize(): void {\n    const gl = this.renderer.gl;\n    const w = this.renderer.canvas.width;\n    const h = this.renderer.canvas.height;\n    if (w < 1 || h < 1) return;\n    if (w === this.rtWidth && h === this.rtHeight) return;\n    this.rtWidth = w;\n    this.rtHeight = h;\n\n    gl.bindTexture(gl.TEXTURE_2D, this.renderTarget);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, w, h, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this.fbo);\n    gl.framebufferTexture2D(\n      gl.FRAMEBUFFER,\n      gl.COLOR_ATTACHMENT0,\n      gl.TEXTURE_2D,\n      this.renderTarget,\n      0\n    );\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n  }\n\n  private render(): void {\n    const gl = this.renderer.gl;\n    const w = this.renderer.canvas.width;\n    const h = this.renderer.canvas.height;\n    const isJulia = this.fractalType === FractalType.Julia || this.fractalType === FractalType.BurningShipJulia;\n    const maxIter =\n      this.maxIterationsOverride ??\n      maxIterationsForZoom(this.viewState.zoom, isJulia);\n\n    if (this.debugOverlay) {\n      const z = this.viewState.zoom;\n      const zoomStr = z >= 1e6 ? z.toExponential(2) : z < 1 ? z.toPrecision(4) : String(Math.round(z));\n      const iterSuffix = this.maxIterationsOverride !== null ? ' (manual)' : '';\n      const paletteName = FractalEngine.PALETTE_NAMES[this.paletteIndex];\n      const fractalName = FRACTAL_TYPE_NAMES[this.fractalType];\n      const aaStatus = this.aaEnabled ? 'AA' : '';\n      const juliaStatus = this.juliaPickerMode ? '🎯 Pick Julia point' : '';\n      const juliaCoords = (this.fractalType === FractalType.Julia || this.fractalType === FractalType.BurningShipJulia)\n        ? `c=(${this.juliaC[0].toFixed(4)}, ${this.juliaC[1].toFixed(4)})`\n        : '';\n      const colorOffsetStr = Math.abs(this.colorOffset) > 0.001 ? `offset ${this.colorOffset.toFixed(1)}` : '';\n      const statusParts = [fractalName, `zoom ${zoomStr}`, `iterations ${maxIter}${iterSuffix}`, paletteName];\n      if (colorOffsetStr) statusParts.push(colorOffsetStr);\n      if (juliaCoords) statusParts.push(juliaCoords);\n      if (aaStatus) statusParts.push(aaStatus);\n      if (juliaStatus) statusParts.push(juliaStatus);\n      statusParts.push('H = help');\n      this.debugOverlay.textContent = statusParts.join('  ·  ');\n    }\n\n    // Pass 1: render Mandelbrot (to texture if AA enabled, directly to screen if not)\n    if (this.aaEnabled) {\n      gl.bindFramebuffer(gl.FRAMEBUFFER, this.fbo);\n    } else {\n      gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    }\n    gl.viewport(0, 0, w, h);\n    this.renderer.clear(0, 0, 0, 1);\n\n    this.shaderProgram.use();\n    this.shaderProgram.setUniform('u_resolution', [w, h]);\n    this.shaderProgram.setUniform('u_center', [this.viewState.centerX, this.viewState.centerY]);\n    this.shaderProgram.setUniform('u_zoom', this.viewState.zoom);\n    this.shaderProgram.setUniformInt('u_maxIterations', maxIter);\n    this.shaderProgram.setUniform('u_time', performance.now() * 0.001);\n    this.shaderProgram.setUniformInt('u_paletteIndex', this.paletteIndex);\n    this.shaderProgram.setUniform('u_colorOffset', this.colorOffset);\n    this.shaderProgram.setUniformInt('u_fractalType', this.fractalType);\n    this.shaderProgram.setUniform('u_juliaC', this.juliaC);\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.quadBuffer);\n    const positionLocation = 0;\n    gl.enableVertexAttribArray(positionLocation);\n    gl.vertexAttribPointer(positionLocation, 2, gl.FLOAT, false, 0, 0);\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n\n    // Pass 2: AA post-process to screen (only if AA enabled)\n    if (this.aaEnabled) {\n      gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n      gl.viewport(0, 0, w, h);\n      this.renderer.clear(0.05, 0.05, 0.1, 1);\n\n      gl.activeTexture(gl.TEXTURE0);\n      gl.bindTexture(gl.TEXTURE_2D, this.renderTarget);\n      this.postProcessProgram.use();\n      this.postProcessProgram.setUniformInt('u_tex', 0);\n      this.postProcessProgram.setUniform('u_resolution', [w, h]);\n\n      gl.bindBuffer(gl.ARRAY_BUFFER, this.quadBuffer);\n      gl.enableVertexAttribArray(positionLocation);\n      gl.vertexAttribPointer(positionLocation, 2, gl.FLOAT, false, 0, 0);\n      gl.drawArrays(gl.TRIANGLES, 0, 6);\n    }\n  }\n\n  /**\n   * Start the render loop\n   */\n  start(): void {\n    this.renderer.start(() => {\n      this.render();\n    });\n  }\n\n  /**\n   * Stop the render loop\n   */\n  stop(): void {\n    this.renderer.stop();\n  }\n\n  /**\n   * Set maximum iterations (overrides zoom-based scaling).\n   * No upper cap - go as high as your GPU can handle!\n   */\n  setMaxIterations(iterations: number): void {\n    this.maxIterationsOverride = Math.round(Math.max(1, iterations));\n    this.render();\n  }\n\n  /**\n   * Adjust max iterations by a ratio. Positive direction = more iterations.\n   * @param direction 1 for increase, -1 for decrease\n   */\n  adjustMaxIterations(direction: 1 | -1): void {\n    const isJulia = this.fractalType === FractalType.Julia || this.fractalType === FractalType.BurningShipJulia;\n    const currentIter =\n      this.maxIterationsOverride ?? maxIterationsForZoom(this.viewState.zoom, isJulia);\n    const newIter =\n      direction > 0\n        ? currentIter * ITERATION_ADJUST_RATIO\n        : currentIter / ITERATION_ADJUST_RATIO;\n    this.setMaxIterations(newIter);\n  }\n\n  /**\n   * Clear the manual override and return to zoom-based auto-scaling.\n   */\n  clearMaxIterationsOverride(): void {\n    this.maxIterationsOverride = null;\n    this.render();\n  }\n\n  /**\n   * Toggle antialiasing post-process on/off.\n   */\n  toggleAA(): void {\n    this.aaEnabled = !this.aaEnabled;\n    this.render();\n  }\n\n  /**\n   * Cycle to the next fractal type (Mandelbrot/Burning Ship only).\n   * Julia variants are accessed via the Julia picker mode.\n   * @param direction 1 for next, -1 for previous\n   */\n  cycleFractalType(direction: 1 | -1 = 1): void {\n    // If we're in a Julia variant, exit to the corresponding base type first\n    if (this.fractalType === FractalType.Julia) {\n      this.fractalType = FractalType.Mandelbrot;\n    } else if (this.fractalType === FractalType.BurningShipJulia) {\n      this.fractalType = FractalType.BurningShip;\n    }\n\n    // Cycle through base types only\n    this.fractalType = (this.fractalType + direction + FractalEngine.BASE_FRACTAL_TYPE_COUNT) % FractalEngine.BASE_FRACTAL_TYPE_COUNT;\n\n    // Exit picker mode when changing fractal type\n    if (this.juliaPickerMode) {\n      this.juliaPickerMode = false;\n      this.inputHandler.setJuliaPickerMode(false);\n    }\n\n    this.render();\n  }\n\n  /**\n   * Toggle Julia picker mode on/off.\n   * When active, clicking on the fractal picks a Julia constant.\n   * If already viewing a Julia set, pressing J returns to the source set.\n   */\n  toggleJuliaPickerMode(): void {\n    // If currently viewing a Julia set, return to the saved state\n    if (this.fractalType === FractalType.Julia || this.fractalType === FractalType.BurningShipJulia) {\n      this.exitJuliaMode();\n      return;\n    }\n\n    // Toggle picker mode\n    this.juliaPickerMode = !this.juliaPickerMode;\n    this.inputHandler.setJuliaPickerMode(this.juliaPickerMode);\n    this.render();\n  }\n\n  /**\n   * Pick a Julia constant from the current fractal view.\n   * @param x Real component of the point clicked\n   * @param y Imaginary component of the point clicked\n   */\n  pickJuliaConstant(x: number, y: number): void {\n    // Save current state before switching to Julia\n    this.savedViewState = {\n      centerX: this.viewState.centerX,\n      centerY: this.viewState.centerY,\n      zoom: this.viewState.zoom,\n    };\n    this.savedFractalType = this.fractalType;\n\n    // Set the Julia constant\n    this.juliaC = [x, y];\n\n    // Switch to the appropriate Julia variant\n    if (this.fractalType === FractalType.BurningShip) {\n      this.fractalType = FractalType.BurningShipJulia;\n    } else {\n      this.fractalType = FractalType.Julia;\n    }\n\n    // Exit picker mode\n    this.juliaPickerMode = false;\n    this.inputHandler.setJuliaPickerMode(false);\n\n    // Reset view for the Julia set\n    this.viewState.centerX = 0;\n    this.viewState.centerY = 0;\n    this.viewState.zoom = 0.8;\n\n    this.render();\n  }\n\n  /**\n   * Exit Julia mode and return to the source fractal.\n   */\n  private exitJuliaMode(): void {\n    // Determine the base fractal type from the current Julia variant\n    const baseType = this.fractalType === FractalType.BurningShipJulia\n      ? FractalType.BurningShip\n      : FractalType.Mandelbrot;\n\n    // Restore saved state if available\n    if (this.savedViewState) {\n      this.viewState.centerX = this.savedViewState.centerX;\n      this.viewState.centerY = this.savedViewState.centerY;\n      this.viewState.zoom = this.savedViewState.zoom;\n      this.savedViewState = null;\n    } else {\n      // Default reset - use appropriate center for the base type\n      this.viewState.centerX = baseType === FractalType.BurningShip ? -0.5 : -0.5;\n      this.viewState.centerY = baseType === FractalType.BurningShip ? -0.5 : 0;\n      this.viewState.zoom = 0.4;\n    }\n\n    // Restore fractal type\n    if (this.savedFractalType !== null) {\n      this.fractalType = this.savedFractalType;\n      this.savedFractalType = null;\n    } else {\n      // Default to the appropriate base type\n      this.fractalType = baseType;\n    }\n\n    this.render();\n  }\n\n  /**\n   * Set the Julia constant directly.\n   * @param real Real component\n   * @param imag Imaginary component\n   */\n  setJuliaConstant(real: number, imag: number): void {\n    this.juliaC = [real, imag];\n    this.render();\n  }\n\n  /**\n   * Cycle to the next color palette.\n   * @param direction 1 for next, -1 for previous\n   */\n  cyclePalette(direction: 1 | -1 = 1): void {\n    this.paletteIndex = (this.paletteIndex + direction + FractalEngine.PALETTE_COUNT) % FractalEngine.PALETTE_COUNT;\n    this.render();\n  }\n\n  /**\n   * Adjust the color offset to shift the color cycle.\n   * @param delta Amount to shift (positive = forward, negative = backward)\n   */\n  adjustColorOffset(delta: number): void {\n    this.colorOffset += delta;\n    this.render();\n  }\n\n  /**\n   * Reset color offset to zero.\n   */\n  resetColorOffset(): void {\n    this.colorOffset = 0.0;\n    this.render();\n  }\n\n  /**\n   * Reset view to initial position\n   */\n  resetView(): void {\n    this.viewState.reset();\n    this.render();\n  }\n\n  /**\n   * Get the current state as a BookmarkState object\n   */\n  getBookmarkState(): BookmarkState {\n    return {\n      fractalType: this.fractalType,\n      centerX: this.viewState.centerX,\n      centerY: this.viewState.centerY,\n      zoom: this.viewState.zoom,\n      paletteIndex: this.paletteIndex,\n      colorOffset: this.colorOffset,\n      juliaC: this.juliaC,\n      maxIterationsOverride: this.maxIterationsOverride,\n      aaEnabled: this.aaEnabled,\n    };\n  }\n\n  /**\n   * Apply a partial bookmark state to the engine\n   */\n  applyBookmarkState(state: Partial<BookmarkState>): void {\n    if (state.fractalType !== undefined) {\n      this.fractalType = state.fractalType;\n    }\n    if (state.centerX !== undefined) {\n      this.viewState.centerX = state.centerX;\n    }\n    if (state.centerY !== undefined) {\n      this.viewState.centerY = state.centerY;\n    }\n    if (state.zoom !== undefined) {\n      this.viewState.zoom = state.zoom;\n    }\n    if (state.paletteIndex !== undefined) {\n      this.paletteIndex = state.paletteIndex;\n    }\n    if (state.colorOffset !== undefined) {\n      this.colorOffset = state.colorOffset;\n    }\n    if (state.juliaC !== undefined) {\n      this.juliaC = state.juliaC;\n    }\n    if (state.maxIterationsOverride !== undefined) {\n      this.maxIterationsOverride = state.maxIterationsOverride;\n    }\n    if (state.aaEnabled !== undefined) {\n      this.aaEnabled = state.aaEnabled;\n    }\n    this.render();\n  }\n\n  /**\n   * Load bookmark state from URL hash (if present)\n   */\n  private loadBookmark(): void {\n    const state = readUrlBookmark();\n    if (Object.keys(state).length > 0) {\n      this.applyBookmarkState(state);\n      console.log('Loaded fractal state from URL');\n    }\n  }\n\n  /**\n   * Update URL hash with current state (without page reload)\n   */\n  updateUrlBookmark(): void {\n    updateUrlHash(this.getBookmarkState());\n  }\n\n  /**\n   * Navigate to a famous location by keyboard key (1-9)\n   */\n  goToLocation(key: string): void {\n    const location = getLocationByKey(key);\n    if (location) {\n      this.applyBookmarkState(location.state);\n      this.updateUrlBookmark();\n      this.showLocationNotification(location.name);\n    }\n  }\n\n  /**\n   * Show notification when navigating to a famous location\n   */\n  private showLocationNotification(name: string): void {\n    if (!this.shareNotification) return;\n\n    this.shareNotification.textContent = `📍 ${name}`;\n    this.shareNotification.style.color = '#60a5fa';\n    this.shareNotification.style.opacity = '1';\n\n    setTimeout(() => {\n      if (this.shareNotification) {\n        this.shareNotification.style.opacity = '0';\n      }\n    }, 1500);\n  }\n\n  /**\n   * Copy shareable URL to clipboard and show notification\n   */\n  async shareBookmark(): Promise<void> {\n    const success = await copyShareableUrl(this.getBookmarkState());\n    this.showShareNotification(success);\n    if (success) {\n      // Also update the URL bar\n      this.updateUrlBookmark();\n    }\n  }\n\n  /**\n   * Show the share notification briefly\n   */\n  private showShareNotification(success: boolean): void {\n    if (!this.shareNotification) return;\n\n    this.shareNotification.textContent = success\n      ? '📋 Link copied to clipboard!'\n      : '❌ Failed to copy link';\n    this.shareNotification.style.color = success ? '#4ade80' : '#f87171';\n    this.shareNotification.style.opacity = '1';\n\n    setTimeout(() => {\n      if (this.shareNotification) {\n        this.shareNotification.style.opacity = '0';\n      }\n    }, 2000);\n  }\n\n  /**\n   * Toggle help overlay visibility.\n   */\n  toggleHelp(): void {\n    this.helpVisible = !this.helpVisible;\n    if (this.helpOverlay) {\n      this.helpOverlay.style.opacity = this.helpVisible ? '1' : '0';\n      this.helpOverlay.style.pointerEvents = this.helpVisible ? 'auto' : 'none';\n    }\n  }\n\n  /**\n   * Toggle screenshot mode (hides all UI overlays).\n   */\n  toggleScreenshotMode(): void {\n    this.screenshotMode = !this.screenshotMode;\n\n    // Hide help if screenshot mode is activated\n    if (this.screenshotMode && this.helpVisible) {\n      this.helpVisible = false;\n      if (this.helpOverlay) {\n        this.helpOverlay.style.opacity = '0';\n        this.helpOverlay.style.pointerEvents = 'none';\n      }\n    }\n\n    // Toggle debug overlay visibility\n    if (this.debugOverlay) {\n      this.debugOverlay.style.display = this.screenshotMode ? 'none' : 'block';\n    }\n\n    // Show brief notification when entering/exiting screenshot mode\n    if (this.shareNotification) {\n      this.shareNotification.textContent = this.screenshotMode\n        ? '📷 Screenshot mode (Space to exit)'\n        : '📷 UI restored';\n      this.shareNotification.style.color = '#60a5fa';\n      this.shareNotification.style.opacity = '1';\n      setTimeout(() => {\n        if (this.shareNotification) {\n          this.shareNotification.style.opacity = '0';\n        }\n      }, 1000);\n    }\n  }\n\n  /**\n   * Generate HTML content for the help overlay.\n   */\n  private createHelpContent(): string {\n    return `\n      <h2 style=\"margin: 0 0 16px 0; color: #60a5fa; font-size: 20px; font-weight: 600;\">\n        🌀 Fractal Explorer - Keyboard Shortcuts\n      </h2>\n      <div style=\"display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px 32px;\">\n        <div style=\"margin-bottom: 12px;\">\n          <h3 style=\"margin: 0 0 8px 0; color: #a78bfa; font-size: 13px; text-transform: uppercase; letter-spacing: 0.5px;\">Navigation</h3>\n          <div style=\"display: grid; gap: 4px;\">\n            ${this.helpRow('Drag', 'Pan view')}\n            ${this.helpRow('Scroll', 'Zoom in/out')}\n            ${this.helpRow('Double-click', 'Zoom in at point')}\n            ${this.helpRow('1-9', 'Famous locations')}\n          </div>\n        </div>\n        <div style=\"margin-bottom: 12px;\">\n          <h3 style=\"margin: 0 0 8px 0; color: #a78bfa; font-size: 13px; text-transform: uppercase; letter-spacing: 0.5px;\">Iterations</h3>\n          <div style=\"display: grid; gap: 4px;\">\n            ${this.helpRow('+/-', 'Adjust iterations')}\n            ${this.helpRow('0', 'Reset to auto')}\n          </div>\n        </div>\n        <div style=\"margin-bottom: 12px;\">\n          <h3 style=\"margin: 0 0 8px 0; color: #a78bfa; font-size: 13px; text-transform: uppercase; letter-spacing: 0.5px;\">Colors</h3>\n          <div style=\"display: grid; gap: 4px;\">\n            ${this.helpRow('C / Shift+C', 'Cycle palettes')}\n            ${this.helpRow(', / .', 'Shift colors (fine)')}\n            ${this.helpRow('< / >', 'Shift colors (coarse)')}\n            ${this.helpRow('R', 'Reset color offset')}\n          </div>\n        </div>\n        <div style=\"margin-bottom: 12px;\">\n          <h3 style=\"margin: 0 0 8px 0; color: #a78bfa; font-size: 13px; text-transform: uppercase; letter-spacing: 0.5px;\">Fractal Type</h3>\n          <div style=\"display: grid; gap: 4px;\">\n            ${this.helpRow('F / Shift+F', 'Cycle fractals')}\n            ${this.helpRow('J', 'Julia picker mode')}\n          </div>\n        </div>\n        <div style=\"margin-bottom: 12px;\">\n          <h3 style=\"margin: 0 0 8px 0; color: #a78bfa; font-size: 13px; text-transform: uppercase; letter-spacing: 0.5px;\">Display</h3>\n          <div style=\"display: grid; gap: 4px;\">\n            ${this.helpRow('A', 'Toggle antialiasing')}\n            ${this.helpRow('H', 'Toggle this help')}\n            ${this.helpRow('Space', 'Screenshot mode')}\n          </div>\n        </div>\n        <div style=\"margin-bottom: 12px;\">\n          <h3 style=\"margin: 0 0 8px 0; color: #a78bfa; font-size: 13px; text-transform: uppercase; letter-spacing: 0.5px;\">Share</h3>\n          <div style=\"display: grid; gap: 4px;\">\n            ${this.helpRow('S', 'Copy bookmark URL')}\n          </div>\n        </div>\n      </div>\n      <div style=\"margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.1); color: #888; font-size: 12px; text-align: center;\">\n        Press <kbd style=\"background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px; font-family: inherit;\">H</kbd> to close\n      </div>\n    `;\n  }\n\n  /**\n   * Helper to generate a help row.\n   */\n  private helpRow(key: string, description: string): string {\n    return `\n      <div style=\"display: flex; align-items: baseline; gap: 8px;\">\n        <kbd style=\"background: rgba(255,255,255,0.1); color: #f0f0f0; padding: 2px 8px; border-radius: 4px; font-family: ui-monospace, monospace; font-size: 12px; min-width: 60px; text-align: center;\">${key}</kbd>\n        <span style=\"color: #ccc;\">${description}</span>\n      </div>\n    `;\n  }\n\n  /**\n   * Clean up resources\n   */\n  destroy(): void {\n    this.stop();\n    window.removeEventListener('resize', this.handleResize);\n    window.removeEventListener('hashchange', this.handleHashChange);\n    this.debugOverlay?.remove();\n    this.debugOverlay = null;\n    this.shareNotification?.remove();\n    this.shareNotification = null;\n    this.helpOverlay?.remove();\n    this.helpOverlay = null;\n    this.inputHandler.destroy();\n    this.shaderProgram.destroy();\n    this.postProcessProgram.destroy();\n    const gl = this.renderer.gl;\n    if (this.fbo) gl.deleteFramebuffer(this.fbo);\n    if (this.renderTarget) gl.deleteTexture(this.renderTarget);\n    this.renderer.destroy();\n    if (this.quadBuffer) gl.deleteBuffer(this.quadBuffer);\n  }\n}\n","/**\n * Fractal Explorer - Main Entry Point\n *\n * \"This is where the magic begins. You're welcome.\"\n * - Skippy the Magnificent\n */\n\nimport { FractalEngine } from './fractal/FractalEngine';\n\nconsole.log('Fractal Explorer - Initializing...');\n\nlet engine: FractalEngine | null = null;\n\nfunction init(): void {\n  const app = document.getElementById('app');\n  if (!app) {\n    console.error('Could not find #app element');\n    return;\n  }\n\n  // Create canvas element\n  const canvas = document.createElement('canvas');\n  canvas.id = 'fractal-canvas';\n  app.appendChild(canvas);\n\n  try {\n    // Initialize the fractal engine\n    engine = new FractalEngine(canvas);\n    engine.start();\n\n    console.log('Fractal Explorer initialized successfully');\n    console.log('Controls:');\n    console.log('  - Drag to pan');\n    console.log('  - Scroll to zoom');\n    console.log('  - Double-click to zoom in');\n    console.log('  - Touch drag to pan (mobile)');\n    console.log('  - Pinch to zoom (mobile)');\n    console.log('  - + / - to adjust max iterations');\n    console.log('  - 0 to reset iterations to auto-scaling');\n    console.log('  - c / C to cycle color palettes (forward/backward)');\n    console.log('  - , / . to shift colors (fine)');\n    console.log('  - < / > to shift colors (coarse)');\n    console.log('  - a to toggle antialiasing');\n    console.log('  - s to share/copy bookmark URL');\n    console.log('  - 1-9 to visit famous locations');\n    console.log('  - h to toggle help overlay');\n    console.log('  - Space to toggle screenshot mode');\n  } catch (error) {\n    console.error('Failed to initialize Fractal Explorer:', error);\n    app.innerHTML = `\n      <div style=\"color: white; text-align: center; padding: 20px; font-family: system-ui, sans-serif;\">\n        <h1>Initialization Error</h1>\n        <p>Failed to initialize the application.</p>\n        <pre style=\"text-align: left; margin-top: 20px; color: #ff6b6b;\">${error instanceof Error ? error.message : String(error)}</pre>\n      </div>\n    `;\n  }\n}\n\n// Initialize when DOM is ready\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', init);\n} else {\n  init();\n}\n\n// Cleanup on page unload\nwindow.addEventListener('beforeunload', () => {\n  if (engine) {\n    engine.destroy();\n  }\n});\n"],"names":["WebGLRenderer","canvas","__publicField","gl","e","width","height","dpr","r","g","b","a","renderCallback","loop","ShaderProgram","vertexSource","fragmentSource","vertexShader","fragmentShader","type","source","shader","info","error","program","name","location","value","ViewState","centerX","centerY","zoom","deltaX","deltaY","screenWidth","screenHeight","fractalDeltaX","fractalDeltaY","screenX","screenY","factor","fractalX","fractalY","newFractalX","newFractalY","aspect","uvX","uvY","ZOOM_SENSITIVITY","scaleZoomFactor","InputHandler","viewState","onChange","callback","enabled","clientX","clientY","rect","x","y","raw","zoomFactor","touches","dx","dy","distance","center","FractalType","FRACTAL_TYPE_NAMES","PARAM","encodeNumber","precision","decodeNumber","s","n","encodeBookmark","state","params","decodeBookmark","hash","z","p","o","jr","ji","i","getShareableUrl","url","updateUrlHash","readUrlBookmark","copyShareableUrl","textArea","FAMOUS_LOCATIONS","getLocationByKey","key","loc","vertexShaderSource","fragmentShaderSource","aaPostFragmentSource","MAX_ITERATIONS_BASE","MAX_ITERATIONS_BASE_JULIA","MAX_ITERATIONS_AUTO_CAP","MAX_ITERATIONS_LOG_SCALE","MAX_ITERATIONS_LOG_POWER","ITERATION_ADJUST_RATIO","maxIterationsForZoom","isJulia","L","base","_FractalEngine","direction","delta","parent","quadVertices","w","h","maxIter","zoomStr","iterSuffix","paletteName","fractalName","aaStatus","juliaStatus","juliaCoords","colorOffsetStr","statusParts","positionLocation","iterations","currentIter","newIter","baseType","real","imag","success","description","FractalEngine","engine","init","app"],"mappings":"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;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECAfC,EAAe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA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"}